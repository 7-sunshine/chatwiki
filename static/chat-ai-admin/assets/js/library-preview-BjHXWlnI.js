import{L as n,M as r,V as t,j as v,Q as E,u as Z,a3 as K,a4 as J,ag as ie,X as G,Y as I,F as M,a1 as N,a7 as se,a8 as j,E as re,a0 as ce,r as m,b as z,$ as fe,P as U}from"./vue-chunks-BqR2sv6q.js";import{_ as B,B as ue,M as de,E as me,d as F,c as he}from"../../index-3zhUo7yB.js";import{P as pe}from"./PlusOutlined-C0SjZwHg.js";import{o as ge,p as be,b as ye,q as $e}from"./index-C_GzEAjs.js";import{C as Y}from"./cu-scroll-DKS1fdpT.js";import{U as xe}from"./index-BFCb0iDf.js";import"./index-DD-RdiGP.js";import{I as we}from"./Password-B44zxURS.js";import{_ as Se,T as ke}from"./index-pAgR-zzF.js";import{_ as Ie}from"./TextArea-DzoZEWPA.js";import{_ as Ee}from"./index-Ds1Q0oJ4.js";import{L as Oe}from"./LeftOutlined-BNSG1iTg.js";import{S as Pe}from"./index-vrWa0o1m.js";import"./dayjs-CuJbp_-a.js";import"./axios-Cm0UX6qg.js";import"./qs-B6vlU9Aj.js";import"./crypto-js-Dyh51M5x.js";import"./index-CEML8ldC.js";import"./index-DtZiJi1p.js";import"./CheckOutlined-BEWUgocd.js";import"./useRefs-BBK5dDsO.js";import"./collapseMotion-CZutXYv2.js";import"./FormItemContext-BTP630fU.js";import"./inputProps-C4OjRA3_.js";import"./index-BRrao2Ax.js";import"./slide-ZCl6ZFDX.js";import"./index-iH-Nu7mF.js";import"./Dropdown-dAJ9ZCrS.js";import"./isMobile-D_4OiXLP.js";const qe="/assets/img/empty-oK82-lgD.png",ee=e=>(K("data-v-16e77398"),e=e(),J(),e),Le={class:"empty-box"},Ae=ee(()=>t("img",{src:qe,alt:""},null,-1)),Ce=ee(()=>t("div",{class:"title"},"知识库文档为空，请添加分段",-1)),De=ee(()=>t("span",null,"添加分段",-1)),Me={__name:"empty",props:{detailsInfo:{type:Object}},emits:["openEditSubscription"],setup(e,{emit:a}){const s=a,p=()=>{s("openEditSubscription",{})};return(u,f)=>{const c=ue;return n(),r("div",Le,[Ae,Ce,t("div",null,[v(c,{type:"primary",onClick:p},{icon:E(()=>[v(Z(pe))]),default:E(()=>[De]),_:1})])])}}},ne=B(Me,[["__scopeId","data-v-16e77398"]]),Te=e=>(K("data-v-cdb41e8b"),e=e(),J(),e),Fe={class:"subsection-box"},je={class:"subsection-box-title"},Be=["onClick"],Ve={class:"top-block"},He={class:"title"},Qe={class:"right-opration"},Re=["onClick"],Ue=Te(()=>t("span",{class:"v-line"},null,-1)),ze=["onClick"],Ne={key:0,class:"content-box"},Ke={key:1,class:"content-box"},Je=["innerHTML"],We={class:"fragment-img"},Xe=["src"],Ye={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription"],setup(e,{expose:a,emit:s}){const p=s,u=e,f=g=>{p("openEditSubscription",g)},c=g=>{de.confirm({title:"提示",icon:v(me),content:"确认是否删除该分段?",onOk(){return new Promise((y,w)=>{ge({id:g}).then(i=>{F.success("删除成功"),p("handleDelParagraph",g),y()}).catch(()=>{y()})})},onCancel(){}})},P=g=>{p("handleScrollTargetPage",g)};return a({handleOpenEditModal:f}),(g,y)=>{const w=ie("viewer");return n(),r("div",Fe,[t("div",je,[G(" 分段预览 "),t("span",null,"共"+I(u.total)+"个分段",1)]),(n(!0),r(M,null,N(u.paragraphLists,i=>(n(),r("div",{onClick:x=>P(i.page_num),class:"list-item",key:i.id},[t("div",Ve,[t("div",He,[G(" id："+I(i.id)+" "+I(i.title)+" ",1),t("span",null,"共"+I(i.word_total)+"个字符",1),t("span",null,"状态："+I(i.status_text),1)]),t("div",Qe,[t("a",{onClick:se(x=>f(i),["stop"])},"编辑",8,Re),Ue,t("a",{onClick:se(x=>c(i.id),["stop"])},"删除",8,ze)])]),i.question?(n(),r("div",Ne,"Q："+I(i.question),1)):j("",!0),i.answer?(n(),r("div",Ke,"A："+I(i.answer),1)):j("",!0),t("div",{class:"content-box",innerHTML:i.content},null,8,Je),re((n(),r("div",We,[(n(!0),r(M,null,N(i.images,(x,S)=>(n(),r("img",{key:S,src:x,alt:""},null,8,Xe))),128))])),[[w]])],8,Be))),128))])}}},ae=B(Ye,[["__scopeId","data-v-cdb41e8b"]]);var l={},te;Object.defineProperty(l,"__esModule",{value:!0});l.controlDefaultValue=l.capitalize=l.camelize=l.cacheStringFunction=void 0;l.getDataAndAriaProps=it;l.isSymbol=l.isString=l.isOn=l.isObject=l.isFunction=te=l.isArray=l.hyphenate=void 0;l.renderHelper=ct;l.resolvePropValue=lt;l.toPx=rt;l.wrapPromiseFn=ut;const _e=e=>typeof e=="function";l.isFunction=_e;l.controlDefaultValue=Symbol("controlDefaultValue");te=l.isArray=Array.isArray;const Ze=e=>typeof e=="string";l.isString=Ze;const Ge=e=>typeof e=="symbol";l.isSymbol=Ge;const et=e=>e!==null&&typeof e=="object";l.isObject=et;const tt=/^on[^a-z]/,ot=e=>tt.test(e);l.isOn=ot;const W=e=>{const a=Object.create(null);return s=>a[s]||(a[s]=e(s))};l.cacheStringFunction=W;const st=/-(\w)/g;l.camelize=W(e=>e.replace(st,(a,s)=>s?s.toUpperCase():""));const nt=/\B([A-Z])/g;l.hyphenate=W(e=>e.replace(nt,"-$1").toLowerCase());l.capitalize=W(e=>e.charAt(0).toUpperCase()+e.slice(1));const at=Object.prototype.hasOwnProperty,le=(e,a)=>at.call(e,a);function lt(e,a,s,p){const u=e[s];if(u!=null){const f=le(u,"default");if(f&&p===void 0){const c=u.default;p=u.type!==Function&&_e(c)?c():c}u.type===Boolean&&(!le(a,s)&&!f?p=!1:p===""&&(p=!0))}return p}function it(e){return Object.keys(e).reduce((a,s)=>((s.startsWith("data-")||s.startsWith("aria-"))&&(a[s]=e[s]),a),{})}function rt(e){return typeof e=="number"?`${e}px`:e}function ct(e){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return typeof e=="function"?e(a):e??s}function ut(e){let a;const s=new Promise(u=>{a=e(()=>{u(!0)})}),p=()=>{a==null||a()};return p.then=(u,f)=>s.then(u,f),p.promise=s,p}const V=e=>(K("data-v-bc21f471"),e=e(),J(),e),dt={class:"form-box-wrapper"},pt={class:"form-item"},_t=V(()=>t("div",{class:"form-label"},"分段标题：",-1)),vt={class:"form-content"},ft={class:"form-item"},mt=V(()=>t("div",{class:"form-label required"},"分段问题：",-1)),ht={class:"form-content"},gt={class:"form-item"},bt=V(()=>t("div",{class:"form-label required"},"分段答案：",-1)),yt={class:"form-content"},$t={key:1,class:"form-item"},xt=V(()=>t("div",{class:"form-label required"},"分段内容：",-1)),wt={class:"form-content"},St={class:"form-item"},kt=V(()=>t("div",{class:"form-label"},"附件",-1)),It={class:"form-content"},Et={class:"upload-box-wrapper"},Ot={key:0},Pt={__name:"edit-subsection",props:{detailsInfo:{type:Object}},emits:["handleEdit"],setup(e,{expose:a,emit:s}){const p=ce(),u=e,f=s,c=m("1"),P=m(!1),g=m(""),y=m(""),w=m(""),i=m(""),x=m([]),S=m(""),A=m(!1),b=h=>{g.value=h.title||"",y.value=h.content||"",S.value=h.id||"",w.value=h.answer||"",x.value=h.images||[],i.value=h.question||"",A.value=u.detailsInfo.is_qa_doc=="1",P.value=!0},q=()=>{if(!y.value&&!A.value)return F.error("请输入分段内容");if(!i.value&&A.value)return F.error("请输入分段问题");if(!w.value&&A.value)return F.error("请输入分段答案");let h={title:g.value,content:y.value,question:i.value,answer:w.value,images:x.value};S.value?h.id=S.value:h.file_id=p.query.id;let _=new FormData;for(let k in h)te(h[k])?h[k].forEach(C=>{_.append(k,C)}):_.append(k,h[k]);be(_).then(k=>{F.success(h.id?"修改成功":"添加成功"),P.value=!1,f("handleEdit",{...h})})};return a({showModal:b}),(h,_)=>{const k=we,C=Ie,X=he,H=Se,Q=ke,D=de;return n(),r("div",null,[v(D,{open:P.value,"onUpdate:open":_[6]||(_[6]=o=>P.value=o),title:"编辑分段",onOk:q,width:"746px"},{default:E(()=>[t("div",dt,[t("div",pt,[_t,t("div",vt,[v(k,{value:g.value,"onUpdate:value":_[0]||(_[0]=o=>g.value=o),placeholder:"请输入分段标题"},null,8,["value"])])]),A.value?(n(),r(M,{key:0},[t("div",ft,[mt,t("div",ht,[v(C,{placeholder:"请输入分段问题",value:i.value,"onUpdate:value":_[1]||(_[1]=o=>i.value=o),style:{height:"100px"}},null,8,["value"])])]),t("div",gt,[bt,t("div",yt,[v(C,{placeholder:"请输入分段答案",value:w.value,"onUpdate:value":_[2]||(_[2]=o=>w.value=o),style:{height:"150px"}},null,8,["value"])])])],64)):(n(),r("div",$t,[xt,t("div",wt,[v(C,{style:{height:"150px"},value:y.value,"onUpdate:value":_[3]||(_[3]=o=>y.value=o),placeholder:"请输入分段内容"},null,8,["value"])])])),t("div",St,[kt,t("div",It,[t("div",Et,[v(Q,{activeKey:c.value,"onUpdate:activeKey":_[4]||(_[4]=o=>c.value=o),size:"small"},{default:E(()=>[v(H,{key:"1"},{tab:E(()=>[t("span",null,[v(X,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),G(" 图片 "),x.value.length?(n(),r("span",Ot,"("+I(x.value.length)+")",1)):j("",!0)])]),_:1})]),_:1},8,["activeKey"]),v(xe,{value:x.value,"onUpdate:value":_[5]||(_[5]=o=>x.value=o)},null,8,["value"])])])])])]),_:1},8,["open"])])}}},qt=B(Pt,[["__scopeId","data-v-bc21f471"]]),Lt={class:"mode-box"},At=["innerHTML"],Ct={class:"tag-item"},Dt={__name:"segmentation-mode",props:{detailsInfo:{type:Object}},setup(e){const a=e,s=m(""),p=z(()=>{const{is_table_file:u,is_qa_doc:f,is_diy_split:c,question_lable:P,answer_lable:g,separators:y,chunk_size:w,chunk_overlap:i,question_column:x,answer_column:S,qa_index_type:A,doc_type:b}=a.detailsInfo;if(u!=1&&f!=1&&c!=1)return b==3?(s.value=`分段模式：手动分段
文档类型：普通文档`,"自定义：普通文档"):(s.value=`分段模式：智能分段
文档类型：普通文档`,"智能分段：普通文档");if(u!=1&&f==1)return b==3?(s.value=`分段模式：手动分段
文档类型：QA文档`,"自定义：QA文档"):(s.value=`分段模式：智能分段
文档类型：QA文档
问题开始标识符："${P}"
答案开始标识符："${g}"`,"智能分段：QA文档");if(u!=1&&f!=1&&c==1)return s.value=`分段模式：自定义分段
文档标识符：${y}
分段最大长度：${w}字符
文段重叠长度：${i}字符`,"自定义分段";if(u==1&&f!=1)return s.value=`分段模式：智能分段
文档类型：普通表格`,"智能分段：普通表格";if(u==1&&f==1){let q=A==1?"问题与答案一起生成索引":"仅对问题生成索引";return s.value=`分段模式：智能分段
文档类型：QA文档
问题所在列："${x}"
答案所在列："${S}"
索引方式：${q}`,"智能分段：QA文档"}});return(u,f)=>{const c=Ee;return n(),r("div",Lt,[v(c,null,{title:E(()=>[t("div",{class:"tooltip-text-box",innerHTML:s.value},null,8,At)]),default:E(()=>[t("div",Ct,I(p.value),1)]),_:1})])}}},Mt=B(Dt,[["__scopeId","data-v-6ee0b31f"]]),Tt=e=>(K("data-v-d41bd24b"),e=e(),J(),e),Ft={class:"library-preview-page"},jt={class:"document-title-block"},Bt={class:"title"},Vt=Tt(()=>t("span",null,"添加分段",-1)),Ht={key:0,class:"page-loading-box"},Qt={class:"content-block"},Rt={key:1,class:"pdf-view-box"},Ut={class:"view-content-wrap"},zt={class:"view-content-box"},Nt=["onClick"],Kt={key:0,class:"content-box"},Jt={key:1,class:"content-box"},Wt=["innerHTML"],Xt={class:"fragment-img"},Yt=["src"],Zt={class:"right-contnt-box"},Gt={class:"content-block"},eo={__name:"library-preview",setup(e){const a=ce(),s=fe(),p=z(()=>c.value.is_table_file=="1"),u=z(()=>c.value.doc_type),f=z(()=>{let o=c.value.status;return!(o=="1"||o=="2")||b.value.length==0}),c=m({pdf_url:""}),P=()=>{s.back()},g=m(null);let y=-1;const w=o=>{let d=document.querySelectorAll(".subsection-box .list-item")[o];d.classList.add("flash-border"),y>=0&&document.querySelectorAll(".subsection-box .list-item")[y].classList.remove("flash-border"),setTimeout(()=>{y=-1,d.classList.remove("flash-border")},2500),y=o,g.value.scrollToElement({el:d,time:1e3})},i=m(!0);(async()=>{ye({id:a.query.id}).then(o=>{c.value=o.data;let d=o.data.status;d==1||d==2?k():i.value=!1})})();const S=m({page:1,size:10}),A=m({}),b=m([]),q=m(0),h={0:"未转换",1:"已转换",2:"转换异常"};let _=!0;const k=()=>{_=!0,$e({file_id:a.query.id,...S.value}).then(o=>{var R,L;i.value=!1,_=!1;let d=o.data,O=d.list||[],$=((R=d.info)==null?void 0:R.is_qa_doc)=="1"&&((L=d.info)==null?void 0:L.is_table_file)=="1";O.forEach(T=>{T.status_text=h[T.status],T.isExcelQa=$}),A.value=d.info,S.value.page==1&&(b.value=[]),b.value=[...b.value,...O],q.value=d.total})},C=()=>{_||b.value.length>=q.value||(S.value.page++,k())},X=o=>{if(!o.id){S.value.page=1,k();return}let d=b.value,O=d.findIndex($=>$.id==o.id);if(O>-1){let $=d[O];$.title=o.title,$.content=o.content,$.question=o.question,$.answer=o.answer,$.answer=o.answer,$.images=o.images,$.word_total=o.question.length+o.answer.length+o.content.length,d.splice(O,1,$),b.value=d}},H=o=>{let d=b.value,O=d.findIndex($=>$.id==o);O>-1&&(d.splice(O,1),b.value=d,q.value=q.value--)};m(!0);const Q=m(null),D=o=>{Q.value.showModal(JSON.parse(JSON.stringify(o)))};return(o,d)=>{const O=ue,$=Pe,R=ie("viewer");return n(),r("div",Ft,[t("div",jt,[v(Z(Oe),{onClick:P}),t("span",Bt,I(c.value.file_name),1),v(Mt,{detailsInfo:c.value},null,8,["detailsInfo"]),v(O,{onClick:d[0]||(d[0]=L=>D({})),style:{"margin-left":"auto"},type:"primary"},{icon:E(()=>[v(Z(pe))]),default:E(()=>[Vt]),_:1})]),i.value?(n(),r("div",Ht,[v($)])):(n(),r(M,{key:1},[p.value||u.value==3?(n(),r(M,{key:0},[f.value?(n(),U(ne,{key:0,onOpenEditSubscription:D})):(n(),U(Y,{key:1,onOnScrollEnd:C},{default:E(()=>[t("div",Qt,[v(ae,{ref:"subsectionBoxRef",total:q.value,paragraphLists:b.value,detailsInfo:c.value,onOpenEditSubscription:D,onHandleDelParagraph:H},null,8,["total","paragraphLists","detailsInfo"])])]),_:1}))],64)):(n(),r("div",Rt,[t("div",Ut,[v(Y,{class:"scroll-box",onOnScrollEnd:C},{default:E(()=>[t("div",zt,[(n(!0),r(M,null,N(b.value,(L,T)=>(n(),r("div",{class:"list-item",onClick:oe=>w(T),key:T},[L.question?(n(),r("div",Kt,I(L.question),1)):j("",!0),L.answer?(n(),r("div",Jt,I(L.answer),1)):j("",!0),t("div",{class:"content-box",innerHTML:L.content},null,8,Wt),re((n(),r("div",Xt,[(n(!0),r(M,null,N(L.images,(oe,ve)=>(n(),r("img",{key:ve,src:oe,alt:""},null,8,Yt))),128))])),[[R]])],8,Nt))),128))])]),_:1})]),t("div",Zt,[f.value?(n(),U(ne,{key:0,onOpenEditSubscription:D})):(n(),U(Y,{key:1,ref_key:"rightScrollRef",ref:g,onOnScrollEnd:C},{default:E(()=>[t("div",Gt,[v(ae,{ref:"subsectionBoxRef",total:q.value,detailsInfo:c.value,paragraphLists:b.value,onOpenEditSubscription:D,onHandleDelParagraph:H},null,8,["total","detailsInfo","paragraphLists"])])]),_:1},512))])]))],64)),v(qt,{detailsInfo:c.value,onHandleEdit:X,ref_key:"editSubscriptionRef",ref:Q},null,8,["detailsInfo"])])}}},Lo=B(eo,[["__scopeId","data-v-d41bd24b"]]);export{Lo as default};
