import{_ as U,L as K,d as O,M as P,H as V,I as Q,E as Y,c as Z}from"../../index-BgrCTl48.js";import{e as p,w as X,M as f,N as y,k as s,S as d,Q as T,u as C,W as t,a4 as S,a5 as j,a0 as J,B as E,V as F,l as oo,x as to,F as eo,a2 as ao,a8 as A,Z as N,Y as G}from"./vue-chunks-C4JOcZXM.js";import{s as no,g as so,d as ro}from"./index-Bgac0nid.js";import{b as lo}from"./index-D4ZvEVkD.js";import{F as B,I as io,_ as co}from"./Password-BkAGcOtH.js";import{P as _o}from"./PlusOutlined-CrDiaLWY.js";import{_ as uo}from"./index-Bm3jSZ5d.js";import"./index-CFqviVPY.js";import{_ as po}from"./TextArea-wsOYN6gn.js";import{P as mo,M as vo}from"./PlusCircleOutlined-CpmHgkuR.js";import{_ as fo,M as bo}from"./index-DLGdcEmj.js";import"./index-CmR9oKMr.js";import{D as go}from"./dropdown-MYtlirtE.js";import"./dayjs-CNAygh1a.js";import"./axios-Cm0UX6qg.js";import"./qs-DjRPs0Fx.js";import"./crypto-js-WfkAukZn.js";import"./index-CN3fsnGQ.js";import"./collapseMotion-B9mQKKQo.js";import"./inputProps-BZDN953P.js";import"./FormItemContext-De0L87xX.js";import"./CheckOutlined-RqX9Rvfe.js";import"./useRefs-q3q6mNJg.js";import"./index-CnMjbvlp.js";import"./slide-56HIwf-4.js";import"./Dropdown-HPSJqWJO.js";import"./RightOutlined-ySsnwyhw.js";import"./move-CyGrGKYK.js";const ho=r=>(S("data-v-90289c7f"),r=r(),j(),r),ko={class:"avatar-uploader"},Co=["src"],wo={key:1},xo=ho(()=>t("div",{class:"ant-upload-text"},"上传照片",-1)),Lo=["src"],yo={__name:"avatar-input",props:{value:{type:String,default:""}},emits:["update:value","change"],setup(r,{emit:I}){function b(o){return new Promise((c,L)=>{const n=new FileReader;n.readAsDataURL(o),n.onload=()=>c(n.result),n.onerror=i=>L(i)})}const h=I,w=r,g=p([]),m=p(!1),_=p("");X(()=>w.value,o=>{_.value=o},{immediate:!0});const e=B.useInjectFormItemContext(),$=()=>{let o={imageUrl:_.value,file:g.value[0].originFileObj};h("change",o),h("update:value",o.imageUrl),e.onFieldChange()},l=o=>o.type==="image/jpeg"||o.type==="image/png"?o.size/1024<100?(g.value=[o],b(o).then(n=>{_.value=n,m.value=!1,$()}),!1):(O.error("机器人头像图片大小不能超过100kb"),!1):(O.error("机器人头像只支持JPG、PNG格式的图片"),!1),a=p(!1),v=p(""),u=p(""),M=()=>{a.value=!1,u.value=""},x=async o=>{!o.url&&!o.preview&&(o.preview=await b(o.originFileObj)),v.value=o.url||o.preview,a.value=!0,u.value=o.name||o.url.substring(o.url.lastIndexOf("/")+1)};return(o,c)=>{const L=uo,n=P;return f(),y("div",ko,[s(L,{"file-list":g.value,"onUpdate:fileList":c[0]||(c[0]=i=>g.value=i),"list-type":"picture-card","show-upload-list":!1,"before-upload":l,accept:".jpg,.png,.jpeg",onPreview:x},{default:d(()=>[r.value?(f(),y("img",{key:0,class:"avatar",src:r.value,alt:"avatar"},null,8,Co)):(f(),y("div",wo,[m.value?(f(),T(C(K),{key:0})):(f(),T(C(_o),{key:1})),xo]))]),_:1},8,["file-list"]),s(n,{open:a.value,title:u.value,footer:null,onCancel:M},{default:d(()=>[t("img",{alt:"example",style:{width:"100%"},src:v.value},null,8,Lo)]),_:1},8,["open","title"])])}}},Io=U(yo,[["__scopeId","data-v-90289c7f"]]),$o=r=>(S("data-v-33fa021d"),r=r(),j(),r),Mo={class:"form-box"},Oo=$o(()=>t("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1)),Po={__name:"add-robot-alert",setup(r,{expose:I}){const b=J(),h=B.useForm,w={span:4},g={span:20},m=p(!1),_=p(!1),e=E({robot_name:"",robot_intro:"",robot_avatar:void 0,robot_avatar_url:""}),$=E({robot_name:[{required:!0,message:"请输入机器人名称",trigger:"change"},{min:1,max:20,message:"最多20个字",trigger:"change"}]}),{validate:l,validateInfos:a,clearValidate:v}=h(e,$),u=n=>{e.robot_avatar=n.file},M=()=>{let n={robot_name:e.robot_name,robot_intro:e.robot_intro,robot_avatar:e.robot_avatar||V};_.value=!0,no(n).then(i=>{if(_.value=!1,i.res!=0)return O.error(i.msg);O.success("机器人创建成功"),b.push("/robot/config/basic-config?id="+i.data.id)}).catch(()=>{_.value=!1})},x=async()=>{let n=await lo({model_type:"LLM"});return!n||n.data.length==0?(P.confirm({title:"请先添加LLM模型服务商?",icon:oo(Q,{style:{color:"red"}}),content:"机器人聊天基于LLM(大语言模型)，请先完成LLM服务商配置",onOk(){b.push("/user/model")},onCancel(){}}),!1):!0},o=async()=>{await x()&&(e.robot_avatar="",e.robot_avatar_url=V,e.robot_name="",e.robot_intro="",m.value=!0)},c=()=>{v()},L=()=>{l().then(()=>{M()}).catch(n=>{})};return I({open:o}),(n,i)=>{const W=io,R=co,q=po,z=B,H=P;return f(),T(H,{width:"746px",open:m.value,"onUpdate:open":i[3]||(i[3]=k=>m.value=k),confirmLoading:_.value,title:"新建机器人",onOk:L,onCancel:c},{default:d(()=>[t("div",Mo,[s(z,{"label-col":w,"wrapper-col":g},{default:d(()=>[s(R,F({ref:"name",label:"机器人名称"},C(a).robot_name),{default:d(()=>[s(W,{value:e.robot_name,"onUpdate:value":i[0]||(i[0]=k=>e.robot_name=k),placeholder:"请输入机器人名称"},null,8,["value"])]),_:1},16),s(R,F({label:"简介"},C(a).robot_intro),{default:d(()=>[s(q,{rows:4,value:e.robot_intro,"onUpdate:value":i[1]||(i[1]=k=>e.robot_intro=k),placeholder:"请输入机器人简介，比如ChatWiki产品帮助机器人，可以通过提问获取ChatWiki的使用帮助，比如如何创建机器人，如何新建知识库，如何添加模型等。"},null,8,["value"])]),_:1},16),s(R,F({ref:"name",label:"机器人头像"},C(a).robot_avatar_url),{default:d(()=>[s(Io,{value:e.robot_avatar_url,"onUpdate:value":i[2]||(i[2]=k=>e.robot_avatar_url=k),onChange:u},null,8,["value"]),Oo]),_:1},16)]),_:1})])]),_:1},8,["open","confirmLoading"])}}},Ro=U(Po,[["__scopeId","data-v-33fa021d"]]),D=r=>(S("data-v-ce68545d"),r=r(),j(),r),Fo={class:"robot-page"},Ao=D(()=>t("div",{class:"top-banner"},[t("div",null," 1.可以创建多个不同的机器人，不同机器人应用在不同场景中，不同机器人可以关联不同的知识库 "),t("div",null," 2.您可以复制链接将机器人提供给您的用户使用。在对外提供服务之前，建议您进行充分测试，并适当调整知识库 ")],-1)),To={class:"list-box"},Bo={class:"list-item-wrapper"},Uo=D(()=>t("span",{class:"add-text"},"新增机器人",-1)),So=["onClick"],jo={class:"list-item"},Do=["onClick"],Vo={class:"robot-info"},Eo=["src"],No={class:"robot-info-content"},Go={class:"robot-name"},Jo={class:"robot-desc"},Wo=["onClick"],qo=D(()=>t("div",{class:"robot-action-line"},null,-1)),zo=["onClick"],Ho={__name:"robot-list",setup(r){const I=J(),b=p([]),h=()=>{so().then(l=>{b.value=l.data}).catch(()=>{})},w=p(null),g=()=>{w.value.open()},m=l=>{I.push({path:"/robot/config/basic-config",query:{id:l}})},_=l=>{let a=3,v=P.confirm({title:`删除机器人${l.robot_name}`,icon:s(Y),content:"您确定要删除此机器人吗？",okText:a+" 确 定",okType:"danger",cancelText:"取 消",okButtonProps:{disabled:!0},onOk(){e(l)},onCancel(){}}),u=setInterval(()=>{a==1?(v.update({okText:"确 定",okButtonProps:{disabled:!1}}),clearInterval(u),u=void 0):(a-=1,v.update({okText:a+" 确 定",okButtonProps:{disabled:!0}}))},1e3)},e=({id:l})=>{ro({id:l}).then(()=>{O.success("删除成功"),h()})},$=l=>{window.open(`#/robot/test?robot_key=${l.robot_key}&id=${l.id}`)};return to(()=>{h()}),(l,a)=>{const v=fo,u=bo,M=go,x=Z;return f(),y("div",Fo,[Ao,t("div",To,[t("div",Bo,[t("div",{class:"list-item add-robot",onClick:g},[s(C(mo),{class:"add-icon"}),Uo])]),(f(!0),y(eo,null,ao(b.value,o=>(f(),y("div",{class:"list-item-wrapper",key:o.id,onClick:c=>m(o.id)},[t("div",jo,[t("span",{class:"item-action",onClick:a[1]||(a[1]=A(()=>{},["stop"]))},[s(M,null,{overlay:d(()=>[s(u,null,{default:d(()=>[s(v,null,{default:d(()=>[t("a",{class:"delete-text-color",href:"javascript:;",onClick:c=>_(o)},"删 除",8,Do)]),_:2},1024)]),_:2},1024)]),default:d(()=>[t("span",{class:"menu-btn",onClick:a[0]||(a[0]=A(()=>{},["stop"]))},[s(C(vo))])]),_:2},1024)]),t("div",Vo,[t("img",{class:"robot-avatar",src:o.robot_avatar,alt:""},null,8,Eo),t("div",No,[t("div",Go,N(o.robot_name),1),t("div",Jo,N(o.robot_intro),1)])]),t("div",{class:"robot-action",onClick:a[2]||(a[2]=A(()=>{},["stop"]))},[t("a",{class:"robot-action-item",href:"javascript:;",onClick:c=>m(o.id)},[s(x,{class:"action-icon",name:"jibenpeizhi"}),G(" 管理")],8,Wo),qo,t("a",{class:"robot-action-item",onClick:c=>$(o)},[s(x,{class:"action-icon",name:"cmd"}),G(" 测试")],8,zo)])])],8,So))),128))]),s(Ro,{ref_key:"addRobotAlertRef",ref:w},null,512)])}}},xt=U(Ho,[["__scopeId","data-v-ce68545d"]]);export{xt as default};
