function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/js/vue-pdf-embed-DLTanxCR.js","assets/js/vue-chunks-Chs-lyDX.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{_ as D,B as oe,M as se,E as ce,d as T,f as re}from"../../index-BRxqhTX0.js";import{M as a,N as f,W as e,k as i,S as P,u as H,a4 as A,a5 as B,Y as G,Z as E,F as R,a2 as ue,a8 as J,a9 as j,a1 as ne,e as c,b as Q,a0 as de,Q as M,ak as _e,z as pe}from"./vue-chunks-Chs-lyDX.js";import{P as ae}from"./PlusOutlined-BsuTPPYk.js";import{o as ve,p as fe,b as he,q as me}from"./index-ClsKim4H.js";import{C as X}from"./cu-scroll-DdXilhPY.js";import"./index-BxFCEOhs.js";import{I as ge}from"./Password-IO9yCNMV.js";import{_ as be}from"./TextArea-DXf3OI0w.js";import{_ as ye}from"./index-BKmN8VmO.js";import{L as $e}from"./LeftOutlined-MipOkgmA.js";import{S as xe}from"./index-Bm-CdVnz.js";import"./dayjs-CkLU8sYs.js";import"./axios-Cm0UX6qg.js";import"./qs-DjYKlG5V.js";import"./crypto-js-BUUKnz8c.js";import"./FormItemContext-VrUvw7Ec.js";import"./inputProps-C625v0VH.js";import"./index-DYUnQ0Fx.js";const ke="/assets/img/empty-oK82-lgD.png",z=o=>(A("data-v-8eb7d862"),o=o(),B(),o),Ie={class:"empty-box"},Se=z(()=>e("img",{src:ke,alt:""},null,-1)),we=z(()=>e("div",{class:"title"},"知识库文档为空，请添加分段",-1)),Ee=z(()=>e("span",null,"添加分段",-1)),Pe={__name:"empty",props:{detailsInfo:{type:Object}},emits:["openEditSubscription"],setup(o,{emit:S}){const r=S,k=()=>{r("openEditSubscription",{})};return(g,b)=>{const v=oe;return a(),f("div",Ie,[Se,we,e("div",null,[i(v,{type:"primary",onClick:k},{icon:P(()=>[i(H(ae))]),default:P(()=>[Ee]),_:1})])])}}},ee=D(Pe,[["__scopeId","data-v-8eb7d862"]]),qe=o=>(A("data-v-8a993398"),o=o(),B(),o),Le={class:"subsection-box"},Ce={class:"subsection-box-title"},Oe=["onClick"],Te={class:"top-block"},De={class:"title"},Me={class:"right-opration"},He=["onClick"],Qe=qe(()=>e("span",{class:"v-line"},null,-1)),Re=["onClick"],Ae={key:0,class:"content-box"},Be={key:1,class:"content-box"},Ne=["innerHTML"],Ve={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription"],setup(o,{expose:S,emit:r}){const k=r,g=o,b=u=>{k("openEditSubscription",u)},v=u=>{se.confirm({title:"提示",icon:i(ce),content:"确认是否删除该分段?",onOk(){return new Promise((h,s)=>{ve({id:u}).then(y=>{T.success("删除成功"),k("handleDelParagraph",u),h()}).catch(()=>{h()})})},onCancel(){}})},l=u=>{k("handleScrollTargetPage",u)};return S({handleOpenEditModal:b}),(u,h)=>(a(),f("div",Le,[e("div",Ce,[G(" 分段预览 "),e("span",null,"共"+E(g.total)+"个分段",1)]),(a(!0),f(R,null,ue(g.paragraphLists,s=>(a(),f("div",{onClick:y=>l(s.page_num),class:"list-item",key:s.id},[e("div",Te,[e("div",De,[G(" id："+E(s.id)+" "+E(s.title)+" ",1),e("span",null,"共"+E(s.word_total)+"个字符",1),e("span",null,"状态："+E(s.status_text),1)]),e("div",Me,[e("a",{onClick:J(y=>b(s),["stop"])},"编辑",8,He),Qe,e("a",{onClick:J(y=>v(s.id),["stop"])},"删除",8,Re)])]),s.question?(a(),f("div",Ae,"Q："+E(s.question),1)):j("",!0),s.answer?(a(),f("div",Be,"A："+E(s.answer),1)):j("",!0),e("div",{class:"content-box",innerHTML:s.content},null,8,Ne)],8,Oe))),128))]))}},te=D(Ve,[["__scopeId","data-v-8a993398"]]),N=o=>(A("data-v-9d0346cb"),o=o(),B(),o),Fe={class:"form-box-wrapper"},Ue={class:"form-item"},je=N(()=>e("div",{class:"form-label"},"分段标题：",-1)),ze={class:"form-content"},Ke={class:"form-item"},We=N(()=>e("div",{class:"form-label required"},"分段问题：",-1)),Ye={class:"form-content"},Ze={class:"form-item"},Ge=N(()=>e("div",{class:"form-label required"},"分段答案：",-1)),Je={class:"form-content"},Xe={key:1,class:"form-item"},et=N(()=>e("div",{class:"form-label required"},"分段内容：",-1)),tt={class:"form-content"},ot={__name:"edit-subsection",props:{detailsInfo:{type:Object}},emits:["handleEdit"],setup(o,{expose:S,emit:r}){const k=ne(),g=o,b=r,v=c(!1),l=c(""),u=c(""),h=c(""),s=c(""),y=c(""),w=c(!1),m=d=>{l.value=d.title||"",u.value=d.content||"",y.value=d.id||"",h.value=d.answer||"",s.value=d.question||"",w.value=g.detailsInfo.is_qa_doc=="1",v.value=!0},I=()=>{if(!u.value&&!w.value)return T.error("请输入分段内容");if(!s.value&&w.value)return T.error("请输入分段问题");if(!h.value&&w.value)return T.error("请输入分段答案");let d={title:l.value,content:u.value,question:s.value,answer:h.value};y.value?d.id=y.value:d.file_id=k.query.id,fe(d).then(_=>{T.success(d.id?"修改成功":"添加成功"),v.value=!1,b("handleEdit",d)})};return S({showModal:m}),(d,_)=>{const L=ge,q=be,V=se;return a(),f("div",null,[i(V,{open:v.value,"onUpdate:open":_[4]||(_[4]=$=>v.value=$),title:"编辑分段",onOk:I,width:"746px"},{default:P(()=>[e("div",Fe,[e("div",Ue,[je,e("div",ze,[i(L,{value:l.value,"onUpdate:value":_[0]||(_[0]=$=>l.value=$),placeholder:"请输入分段标题"},null,8,["value"])])]),w.value?(a(),f(R,{key:0},[e("div",Ke,[We,e("div",Ye,[i(q,{placeholder:"请输入分段问题",value:s.value,"onUpdate:value":_[1]||(_[1]=$=>s.value=$),style:{height:"100px"}},null,8,["value"])])]),e("div",Ze,[Ge,e("div",Je,[i(q,{placeholder:"请输入分段答案",value:h.value,"onUpdate:value":_[2]||(_[2]=$=>h.value=$),style:{height:"250px"}},null,8,["value"])])])],64)):(a(),f("div",Xe,[et,e("div",tt,[i(q,{style:{height:"450px"},value:u.value,"onUpdate:value":_[3]||(_[3]=$=>u.value=$),placeholder:"请输入分段内容"},null,8,["value"])])]))])]),_:1},8,["open"])])}}},st=D(ot,[["__scopeId","data-v-9d0346cb"]]),nt={class:"mode-box"},at=["innerHTML"],lt={class:"tag-item"},it={__name:"segmentation-mode",props:{detailsInfo:{type:Object}},setup(o){const S=o,r=c(""),k=Q(()=>{const{is_table_file:g,is_qa_doc:b,is_diy_split:v,question_lable:l,answer_lable:u,separators:h,chunk_size:s,chunk_overlap:y,question_column:w,answer_column:m,qa_index_type:I,doc_type:d}=S.detailsInfo;if(g!=1&&b!=1&&v!=1)return d==3?(r.value=`分段模式：手动分段
文档类型：普通文档`,"自定义：普通文档"):(r.value=`分段模式：智能分段
文档类型：普通文档`,"智能分段：普通文档");if(g!=1&&b==1)return d==3?(r.value=`分段模式：手动分段
文档类型：QA文档`,"自定义：QA文档"):(r.value=`分段模式：智能分段
文档类型：QA文档
问题开始标识符："${l}"
答案开始标识符："${u}"`,"智能分段：QA文档");if(g!=1&&b!=1&&v==1)return r.value=`分段模式：自定义分段
文档标识符：${h}
分段最大长度：${s}字符
文段重叠长度：${y}字符`,"自定义分段";if(g==1&&b!=1)return r.value=`分段模式：智能分段
文档类型：普通表格`,"智能分段：普通表格";if(g==1&&b==1){let _=I==1?"问题与答案一起生成索引":"仅对问题生成索引";return r.value=`分段模式：智能分段
文档类型：QA文档
问题所在列："${w}"
答案所在列："${m}"
索引方式：${_}`,"智能分段：QA文档"}});return(g,b)=>{const v=ye;return a(),f("div",nt,[i(v,null,{title:P(()=>[e("div",{class:"tooltip-text-box",innerHTML:r.value},null,8,at)]),default:P(()=>[e("div",lt,E(k.value),1)]),_:1})])}}},ct=D(it,[["__scopeId","data-v-e8649c10"]]),rt=o=>(A("data-v-36a54353"),o=o(),B(),o),ut={class:"library-preview-page"},dt={class:"document-title-block"},_t={class:"title"},pt=rt(()=>e("span",null,"添加分段",-1)),vt={key:0,class:"page-loading-box"},ft={class:"content-block"},ht={key:1,class:"pdf-view-box"},mt={class:"view-content-wrap"},gt={key:0,class:"loading-box"},bt={class:"view-content"},yt={class:"right-contnt-box"},$t={class:"content-block"},xt={__name:"library-preview",setup(o){const S=_e(()=>re(()=>import("./vue-pdf-embed-DLTanxCR.js").then(t=>t.v),__vite__mapDeps([0,1]))),r=ne(),k=de(),g=Q(()=>l.value.is_qa_doc=="1"),b=Q(()=>l.value.doc_type),v=Q(()=>{let t=l.value.status;return!(t=="1"||t=="2")||m.value.length==0}),l=c({pdf_url:""}),u=()=>{k.back()},h=c(!0);(async()=>{he({id:r.query.id}).then(t=>{l.value=t.data;let n=t.data.status;n==1||n==2?L():h.value=!1})})();const y=c({page:1,size:10}),w=c({}),m=c([]),I=c(0),d={0:"未转换",1:"已转换",2:"转换异常"};let _=!0;const L=()=>{_=!0,me({file_id:r.query.id,...y.value}).then(t=>{var O,Z;h.value=!1,_=!1;let n=t.data,x=n.list||[],p=((O=n.info)==null?void 0:O.is_qa_doc)=="1"&&((Z=n.info)==null?void 0:Z.is_table_file)=="1";x.forEach(U=>{U.status_text=d[U.status],U.isExcelQa=p}),w.value=n.info,y.value.page==1&&(m.value=[]),m.value=[...m.value,...x],I.value=n.total})},q=()=>{_||m.value.length>=I.value||(y.value.page++,L())},V=t=>{if(!t.id){y.value.page=1,L();return}let n=m.value,x=n.findIndex(p=>p.id==t.id);if(x>-1){let p=n[x];p.title=t.title,p.content=t.content,p.question=t.question,p.answer=t.answer,p.word_total=t.question.length+t.answer.length+t.content.length,n.splice(x,1,p),m.value=n}},$=t=>{let n=m.value,x=n.findIndex(p=>p.id==t);x>-1&&(n.splice(x,1),m.value=n,I.value=I.value--)},K=c(!0),le=t=>{K.value=!1},F=c(null),W=c(null),ie=async t=>{await pe();let n=F.value.pageCount,p=F.value.$el.offsetHeight/n,O=(t-1)*p;W.value.scrollTop=O},Y=c(null),C=t=>{Y.value.showModal(t)};return(t,n)=>{const x=oe,p=xe;return a(),f("div",ut,[e("div",dt,[i(H($e),{onClick:u}),e("span",_t,E(l.value.file_name),1),i(ct,{detailsInfo:l.value},null,8,["detailsInfo"]),i(x,{onClick:n[0]||(n[0]=O=>C({})),style:{"margin-left":"auto"},type:"primary"},{icon:P(()=>[i(H(ae))]),default:P(()=>[pt]),_:1})]),h.value?(a(),f("div",vt,[i(p)])):(a(),f(R,{key:1},[g.value||b.value==3?(a(),f(R,{key:0},[v.value?(a(),M(ee,{key:0,onOpenEditSubscription:C})):(a(),M(X,{key:1,onOnScrollEnd:q},{default:P(()=>[e("div",ft,[i(te,{ref:"subsectionBoxRef",total:I.value,paragraphLists:m.value,detailsInfo:l.value,onOpenEditSubscription:C,onHandleDelParagraph:$},null,8,["total","paragraphLists","detailsInfo"])])]),_:1}))],64)):(a(),f("div",ht,[e("div",mt,[e("div",{class:"view-gray-bg",ref_key:"scollDivRef",ref:W},[K.value?(a(),f("div",gt,[i(p)])):j("",!0),e("div",bt,[i(H(S),{ref_key:"vuePdfRef",ref:F,onLoaded:le,source:l.value.pdf_url},null,8,["source"])])],512)]),e("div",yt,[v.value?(a(),M(ee,{key:0,onOpenEditSubscription:C})):(a(),M(X,{key:1,onOnScrollEnd:q},{default:P(()=>[e("div",$t,[i(te,{ref:"subsectionBoxRef",total:I.value,detailsInfo:l.value,paragraphLists:m.value,onOpenEditSubscription:C,onHandleDelParagraph:$,onHandleScrollTargetPage:ie},null,8,["total","detailsInfo","paragraphLists"])])]),_:1}))])]))],64)),i(st,{detailsInfo:l.value,onHandleEdit:V,ref_key:"editSubscriptionRef",ref:Y},null,8,["detailsInfo"])])}}},Nt=D(xt,[["__scopeId","data-v-36a54353"]]);export{Nt as default};
