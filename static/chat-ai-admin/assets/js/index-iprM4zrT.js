import{_ as z,b as H,B as ae,d as J,M as ee,E as ie}from"../../index-DMzxB8WT.js";import{a as ce,e as re,g as me,d as _e}from"./index-DCm_jl4h.js";import{e as $,M as l,N as m,F as M,a2 as U,a3 as se,Z as g,u as I,W as i,k as C,ac as ue,S as r,Y as L,a9 as S,G as pe,H as fe,Q as A,aa as O,a4 as ve,a5 as ye,B as de,ad as ge,V as he,ae as ke,b as oe}from"./vue-chunks-CN-qMzA4.js";import{_ as we}from"./index-CMEsCGiE.js";import{F as le,I as xe,_ as be}from"./Password-C7NwFRDD.js";import{R as Ie,_ as Ce}from"./index-ymqnKXh3.js";import{S as Ae,_ as Me}from"./index-DlM4rsXn.js";import"./index-BHh3pnC6.js";import{_ as Ke}from"./index-fTGBUk26.js";import{_ as Te,a as $e}from"./index-DAwD7vOG.js";import"./dayjs-BxPRU-k5.js";import"./axios-Cm0UX6qg.js";import"./qs-BLqWfGjr.js";import"./crypto-js-BPJ1YzU4.js";import"./collapseMotion-Dj56_wvK.js";import"./inputProps-wmP5fhXe.js";import"./FormItemContext-rNmaTKvh.js";import"./slide-DZgSj_bV.js";import"./index-_Zzk1L5c.js";import"./isMobile-D_4OiXLP.js";import"./CheckOutlined-DhB7-tl9.js";import"./DownOutlined-AERV3uFR.js";import"./TextArea-BO367esI.js";import"./move-BZp_EDCU.js";import"./index-eip_bubo.js";import"./LeftOutlined-Db1kQFmw.js";import"./RightOutlined-C4O44dJV.js";import"./index-DdPwgdEp.js";import"./index-C9vi6Cyy.js";import"./dropdown-DOgUTukA.js";import"./Dropdown-C-pHTp7f.js";import"./index-fy2rQic9.js";const Se={class:"page-tabs"},Be=["onClick"],Ee={__name:"page-tabs",props:{value:{type:[Number,String]}},emits:["update:value","change"],setup(a,{emit:_}){const{t:s}=H(),d=_,w=a,u=$([{value:1,title:s("views.user.model.modelsHaveBeenAdded"),langKey:"views.user.model.modelsHaveBeenAdded"},{value:0,title:s("views.user.model.canAddAModel"),langKey:"views.user.model.canAddAModel"}]),T=c=>{d("update:value",c),d("change",c)};return(c,h)=>(l(),m("div",Se,[(l(!0),m(M,null,U(u.value,k=>(l(),m("div",{class:se(["tab-item",{active:w.value==k.value}]),onClick:p=>T(k.value),key:k.value},g(I(s)(k.langKey)),11,Be))),128))]))}},Le=z(Ee,[["__scopeId","data-v-cc65f89a"]]),Re=a=>(ve("data-v-81d074da"),a=a(),ye(),a),Pe={class:"model-list"},De={class:"model-item-left"},Oe={class:"model-item-left-top"},Ne=["src"],Ue={class:"model-name"},qe=Re(()=>i("div",{class:"line"},null,-1)),Ve={class:"model-tags"},Fe={key:0,class:"tag"},ze={class:"model-item-left-bottom"},He={class:"model-desc"},Ge={class:"model-item-right"},Xe={__name:"model-list",props:{type:{type:Number,default:()=>1},list:{type:Array,default:()=>[]}},emits:["edit","new","see","remove","add"],setup(a,{emit:_}){const{t:s}=H(),d=_,w=["azure","ollama","xinference","openaiAgent"],u=a,T=v=>{d("see",O(v))},c=v=>{let y=O(v);d("edit",y,y.config_list[0])},h=v=>{d("new",O(v))},k=v=>{d("add",O(v))},p=v=>{let y=O(v);d("remove",y.config_list[0])};return(v,y)=>{const N=we,f=ae;return l(),m("div",Pe,[(l(!0),m(M,null,U(u.list,t=>(l(),m("div",{class:"model-item",key:t.model_define},[i("div",De,[i("div",Oe,[i("img",{class:"model-logo",src:t.model_icon_url,alt:""},null,8,Ne),i("div",Ue,g(t.model_name),1),qe,i("div",Ve,[(l(!0),m(M,null,U(t.support_list,(o,x)=>(l(),m("div",{key:x},[C(N,null,ue({default:r(()=>[o!="SPEECH2TEXT"&&o!="TTS"?(l(),m("span",Fe,g(o),1)):S("",!0)]),_:2},[o=="LLM"?{name:"title",fn:r(()=>[L("大语言模型，添加机器人时需要选择一个大语言模型。用户的提问将交由大语言模型，结合知识库给出答案。")]),key:"0"}:o=="TEXT EMBEDDING"?{name:"title",fn:r(()=>[L("嵌入模型，添加知识库时需要选择嵌入模型，用于将知识库分段向量化。用户提问时也会将问题生成向量，通过比对向量相似度的方式四配跟提问语义相近的知识库分段。向量检索具备很好的语义分析能力。")]),key:"1"}:o=="RERANK"?{name:"title",fn:r(()=>[L("重排序模型,通过重排序模型,将从知识库中检索出来的分段进行重新排序。再将重排序的结果前top-K传递个大语言模型生成答案。重排序有助于优化检索结果，提高大语言模型回答的准确性。")]),key:"2"}:void 0]),1024)]))),128))])]),i("div",ze,[i("div",He,g(t.introduce),1)])]),i("div",Ge,[pe(C(f,{class:se({"btn-red":t.listType==1&&u.type==1}),onClick:o=>p(t)},{default:r(()=>[L(g(t.listType==1&&u.type==1?"移除配置":"删除"),1)]),_:2},1032,["class","onClick"]),[[fe,u.type==1]]),u.type==2&&t.model_define!="azure"?(l(),A(f,{key:0,class:"add-btn",onClick:o=>T(t)},{default:r(()=>[L("查看模型")]),_:2},1032,["onClick"])):S("",!0),u.type==2?(l(),A(f,{key:1,disabled:t.listType==1,class:"add-btn",onClick:o=>k(t)},{default:r(()=>[L("添加配置")]),_:2},1032,["disabled","onClick"])):S("",!0),t.listType==1&&u.type==1?(l(),m(M,{key:2},[w.indexOf(t.model_define)>-1?(l(),m(M,{key:0},[C(f,{class:"add-btn",onClick:o=>T(t)},{default:r(()=>[L(g(I(s)("views.user.model.modelConfigButton"))+"（"+g(t.config_list.length)+"）",1)]),_:2},1032,["onClick"]),C(f,{class:"add-btn",onClick:o=>h(t)},{default:r(()=>[L(g(I(s)("views.user.model.addModelButton")),1)]),_:2},1032,["onClick"])],64)):(l(),m(M,{key:1},[C(f,{class:"add-btn",onClick:o=>c(t)},{default:r(()=>[L(g(I(s)("views.user.model.editModelButton")),1)]),_:2},1032,["onClick"]),C(f,{class:"add-btn",onClick:o=>T(t)},{default:r(()=>[L(g(I(s)("views.user.model.viewModelButton")),1)]),_:2},1032,["onClick"])],64))],64)):S("",!0)])]))),128))])}}},te=z(Xe,[["__scopeId","data-v-81d074da"]]),D={componentType:"input",placeholder:"",defaultValue:""},Qe={componentType:"radio",defaultValue:void 0},We={componentType:"select",defaultValue:void 0},ne={id:{hidden:!0},model_types:{...Qe,key:"model_types",label:"模型类型",optionsKey:"supported_type",options:[],disabled:!1,rules:[{required:!0,message:"请选择模型类型",trigger:"change"}]},deployment_name:{...D,label:"部署名称",placeholder:"请与Azure 部署名称保持一致",rules:[{required:!0,message:"请输入部署名称",trigger:"change"}]},model_name:{...D,label:"模型名称",placeholder:"模型名称请保持一致",rules:[{required:!0,message:"请输入模型名称",trigger:"change"}]},api_endpoint:{...D,label:"API 域名",placeholder:"请输入您的API 域名",rules:[{required:!0,message:"请输入API 域名",trigger:"change"}]},model_context_length:{...D,label:"模型上下文长度",placeholder:"请输入您的模型上下文长度",rules:[{required:!0,message:"请输入模型上下文长度",trigger:"change"}]},model_uid:{...D,label:"模型UID",placeholder:"请输入您的模型UID",rules:[{required:!0,message:"请输入模型UID",trigger:"change"}]},api_key:{...D,label:"API Key",placeholder:"请输入您的API Key",rules:[{required:!0,message:"请输入API Key",trigger:"change"}]},secret_key:{...D,label:"Secret Key",placeholder:"请输入您的Secret Key",rules:[{required:!0,message:"请输入Secret Key",trigger:"change"}]},api_version:{...We,label:"API 版本",placeholder:"请输入您的API 版本",optionsKey:"api_versions",options:[],rules:[{required:!0,message:"请选择API 版本",trigger:"change"}]},app_id:{...D,label:"appid",placeholder:"请输入appid",rules:[{required:!0,message:"请输入appid",trigger:"change"}]}};function Ye(a){if(ne[a])return ne[a];let _={...D};return _.placeholder="请输入您的"+a,_}const Ze={columns:[{title:"模型名称",dataIndex:"model_name",key:"model_name",langKey:"views.user.model.model_name"},{title:"模型类型",dataIndex:"model_type",key:"model_type",langKey:"views.user.model.model_type"}],rows:[],showAddBtn:!1},je={azure:{columns:[{title:"部署名称",dataIndex:"deployment_name",key:"deployment_name",langKey:"views.user.model.deployment_name"},{title:"模型类型",dataIndex:"model_types",key:"model_types",langKey:"views.user.model.model_types"},{title:"API版本",dataIndex:"api_version",key:"api_version",langKey:"views.user.model.api_version"},{title:"操作",dataIndex:"action",key:"action",width:150,langKey:"common.action"}],rows:[],showAddBtn:!0},ollama:{columns:[{title:"模型名称",dataIndex:"deployment_name",key:"deployment_name",langKey:"views.user.model.deployment_name"},{title:"模型类型",dataIndex:"model_types",key:"model_types",langKey:"views.user.model.model_types"},{title:"BaseURL",dataIndex:"api_endpoint",key:"api_endpoint",langKey:"views.user.model.api_endpoint"},{title:"操作",dataIndex:"action",key:"action",width:150,langKey:"common.action"}],rows:[],showAddBtn:!0},openaiAgent:{columns:[{title:"模型名称",dataIndex:"deployment_name",key:"deployment_name",langKey:"views.user.model.deployment_name"},{title:"模型类型",dataIndex:"model_types",key:"model_types",langKey:"views.user.model.model_types"},{title:"BaseURL",dataIndex:"api_endpoint",key:"api_endpoint",langKey:"views.user.model.api_endpoint"},{title:"API Key",dataIndex:"api_key",key:"api_key",langKey:"views.user.model.api_key"},{title:"API版本",dataIndex:"api_version",key:"api_version",langKey:"views.user.model.api_version"},{title:"操作",dataIndex:"action",key:"action",width:150,langKey:"common.action"}],rows:[],showAddBtn:!0},xinference:{columns:[{title:"模型名称",dataIndex:"deployment_name",key:"deployment_name",langKey:"views.user.model.deployment_name"},{title:"模型类型",dataIndex:"model_types",key:"model_types",langKey:"views.user.model.model_types"},{title:"服务器地址",dataIndex:"api_endpoint",key:"api_endpoint",langKey:"views.user.model.api_endpoint"},{title:"操作",dataIndex:"action",key:"action",width:150,langKey:"common.action"}],rows:[],showAddBtn:!0}},Je=["azure","ollama","xinference","openaiAgent"];function eo(a){if(Je.indexOf(a.model_define)>-1)return a.config_list;{let _=[];return a.llm_model_list||(a.llm_model_list=[]),a.llm_model_list.forEach(s=>{_.push({model_name:s,model_type:"LLM"})}),a.vector_model_list||(a.vector_model_list=[]),a.vector_model_list.forEach(s=>{_.push({model_name:s,model_type:"TEXT EMBEDDING"})}),_}}function oo(a){let _=["model_define","model_icon_url"],s=je[a.model_define];return s||(s=Ze),_.forEach(d=>{s[d]=a[d]}),s.rows=eo(a),s}const lo={class:"form-wrapper"},to={class:"model-logo-box"},no=["src"],ao={class:"form-box"},so={class:"form-item-label"},io=["href"],co={__name:"set-model-alert",emits:["ok"],setup(a,{expose:_,emit:s}){const{t:d}=H(),w=s,u=le.useForm,T=$(""),c=de({model_icon_url:"",model_define:"",model_name:""}),h=$(!1),k=$({}),p=$({}),v=$([]),y=["ollama","xinference","openaiAgent"],N=(n,E)=>{k.value={},p.value={},v.value=[];const{model_icon_url:Y,model_define:Z,config_params:X,model_name:V}=n;T.value=E?d("common.edit")+" "+V:d("common.add")+" "+V,c.model_icon_url=Y,c.model_define=Z,c.model_name=V;let Q={},F={},W=[];X.unshift("id"),X.forEach(K=>{K=="model_type"&&(K="model_types"),y.indexOf(n.model_define)>-1&&K=="deployment_name"&&(K="model_name");let e=Ye(K);e.key=K,e.help_links=n.help_links,e.disabled=!1,e.key=="model_types"&&E&&(e.disabled=!0);let b=e.options;E?(y.indexOf(E.model_define)>-1&&E.deployment_name&&(E.model_name=E.deployment_name),F[K]=E[K]||void 0):F[K]=e.defaultValue,e.optionsKey&&n[e.optionsKey]&&(b=n[e.optionsKey]),e.hidden||W.push({...e,options:b,key:K}),e.rules&&(Q[K]=e.rules)}),k.value=Q,p.value=F,v.value=W,h.value=!0,setTimeout(()=>{t()},100)},{resetFields:f,clearValidate:t,validate:o,validateInfos:x}=u(p,k),B=()=>{o().then(()=>{p.value.id?G():R()}).catch(n=>{})},q=()=>{f(),t()},P=$(!1),R=()=>{let n=O(p.value);n.model_type=n.model_types,n.model_define=c.model_define,y.indexOf(n.model_define)>-1&&n.model_name&&(n.deployment_name=n.model_name,delete n.model_name),P.value=!0,ce(n).then(()=>{P.value=!1,h.value=!1,J.success(d("common.saveSuccess")),w("ok")}).catch(()=>{P.value=!1})},G=()=>{let n=O(p.value);n.model_type=n.model_types,n.model_define=c.model_define,y.indexOf(n.model_define)>-1&&n.model_name&&(n.deployment_name=n.model_name,delete n.model_name),P.value=!0,re(n).then(()=>{P.value=!1,h.value=!1,J.success(d("common.saveSuccess")),w("ok")}).catch(()=>{P.value=!1})};return _({open:N}),(n,E)=>{const Y=Ie,Z=Ce,X=Ae,V=Me,Q=xe,F=be,W=le,K=ee;return l(),A(K,{class:"add-model-alert",width:"650px",open:h.value,"onUpdate:open":E[0]||(E[0]=e=>h.value=e),title:T.value,confirmLoading:P.value,onOk:B,onCancel:q,maskClosable:!1},{default:r(()=>[i("div",lo,[i("div",to,[i("img",{class:"model-logo",src:c.model_icon_url,alt:""},null,8,no)]),i("div",ao,[C(W,{layout:"horizontal","label-col":{span:6},"wrapper-col":{span:18}},{default:r(()=>[(l(!0),m(M,null,U(v.value,e=>(l(),m(M,{key:e.key},[e.hidden?S("",!0):(l(),A(F,ge(he({key:0},I(x)[e.key])),{label:r(()=>[i("div",so,[i("span",null,g(I(d)("views.user.model."+e.key)),1)])]),default:r(()=>[e.componentType=="radio"?(l(),A(Z,{key:0,value:p.value[e.key],"onUpdate:value":b=>p.value[e.key]=b,disabled:e.disabled},{default:r(()=>[(l(!0),m(M,null,U(e.options,(b,j)=>(l(),A(Y,{value:b,key:j},{default:r(()=>[i("span",null,g(b),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","disabled"])):S("",!0),e.componentType=="select"?(l(),A(V,{key:1,value:p.value[e.key],"onUpdate:value":b=>p.value[e.key]=b,placeholder:e.placeholder},{default:r(()=>[(l(!0),m(M,null,U(e.options,(b,j)=>(l(),A(X,{value:b,key:j},{default:r(()=>[i("span",null,g(b),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder"])):S("",!0),e.componentType=="input"?(l(),m(M,{key:2},[C(Q,{value:p.value[e.key],"onUpdate:value":b=>p.value[e.key]=b,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"]),e.key=="api_key"?(l(),m("a",{key:0,href:e.help_links,target:"_blank"},g(I(d)("views.user.model.getApikeyText")),9,io)):S("",!0)],64)):S("",!0)]),_:2},1040))],64))),128))]),_:1})])])]),_:1},8,["open","title","confirmLoading"])}}},ro=z(co,[["__scopeId","data-v-65cb9426"]]),mo={class:"form-wrapper"},_o={class:"tools-wrapper"},uo=["src"],po={class:"tools-box"},fo={class:"list-box"},vo=["onClick"],yo=["onClick"],go={__name:"see-model-alert",emits:["new","edit","remove"],setup(a,{expose:_,emit:s}){const{t:d}=H(),w=s,u=$(!1),T=["ollama","xinference","openaiAgent"],c=de({model_icon_url:"",model_define:"",columns:[],rows:[],showAddBtn:!1});let h=ke({});const k=f=>{h=f;let t=oo(f);for(let o in t)c[o]=t[o];u.value=!0},p=()=>{u.value=!1,w("new",{...h})},v=f=>{u.value=!1,w("edit",{...h},O(f))},y=f=>{u.value=!1,w("remove",O(f))},N=()=>{};return _({open:k}),(f,t)=>{const o=ae,x=Ke,B=Te,q=$e,P=ee;return l(),A(P,{class:"add-model-alert",width:"800px",open:u.value,"onUpdate:open":t[0]||(t[0]=R=>u.value=R),title:I(d)("views.user.model.modelConfigButton"),footer:null,onOk:N},{default:r(()=>[i("div",mo,[i("div",_o,[i("img",{class:"model-logo",src:c.model_icon_url,alt:""},null,8,uo),i("div",po,[c.showAddBtn?(l(),A(o,{key:0,type:"primary",onClick:p},{default:r(()=>[L(g(I(d)("views.user.model.addModel")),1)]),_:1})):S("",!0)])]),i("div",fo,[C(q,{"data-source":c.rows,scroll:{y:400},pagination:!1},{default:r(()=>[(l(!0),m(M,null,U(c.columns,R=>(l(),m(M,{key:R.key},[R.key=="action"?(l(),A(B,{key:0,title:I(d)("common.action"),"data-index":R.key,width:"140px"},{default:r(({record:G})=>[i("span",null,[i("a",{onClick:n=>v(G)},g(I(d)("common.edit")),9,vo),C(x,{type:"vertical"}),i("a",{onClick:n=>y(G)},g(I(d)("common.remove")),9,yo)])]),_:2},1032,["title","data-index"])):(l(),A(B,{key:1,title:I(d)("views.user.model."+(T.indexOf(c.model_define)>-1&&R.key=="deployment_name"?"model_name":R.key)),"data-index":R.key},null,8,["title","data-index"]))],64))),128))]),_:1},8,["data-source"])])])]),_:1},8,["open","title"])}}},ho=z(go,[["__scopeId","data-v-cb6626b7"]]),ko={class:"user-model-page"},wo={class:"list-wrapper"},xo={__name:"index",setup(a){const{t:_}=H(),s=$(1),d=()=>{},w=$([]),u=oe(()=>w.value.filter(o=>o.listType==1)),T=oe(()=>w.value),c=()=>{me().then(o=>{let x=o.data||[];x.forEach(B=>{B.listType=B.config_list.length>0?1:0}),x.sort((B,q)=>B.listType-q.listType),w.value=x})};c();const h=$(null),k=o=>{h.value.open(o)},p=o=>{y.value.open(o)},v=o=>{y.value.open(o)},y=$(null),N=(o,x)=>{y.value.open(o,x)},f=()=>{c()},t=o=>{ee.confirm({title:_("views.user.model.deleteModel"),icon:C(ie),content:_("views.user.model.deleteModelContent"),onOk(){_e({id:o.id}).then(()=>{J.success(_("common.deleteSuccessful")),c()})}})};return(o,x)=>(l(),m(M,null,[i("div",ko,[C(Le,{value:s.value,"onUpdate:value":x[0]||(x[0]=B=>s.value=B),onChange:d},null,8,["value"]),i("div",wo,[s.value==1?(l(),A(te,{list:u.value,type:1,key:"addedModelList",onEdit:N,onNew:p,onSee:k,onRemove:t},null,8,["list"])):S("",!0),s.value==0?(l(),A(te,{list:T.value,type:2,key:"canAddModelList",onAdd:v,onSee:k},null,8,["list"])):S("",!0)])]),C(ho,{ref_key:"seeModelAlertRef",ref:h,onNew:p,onEdit:N,onRemove:t},null,512),C(ro,{ref_key:"setModelAlertRef",ref:y,onOk:f},null,512)],64))}},ol=z(xo,[["__scopeId","data-v-1807041e"]]);export{ol as default};
