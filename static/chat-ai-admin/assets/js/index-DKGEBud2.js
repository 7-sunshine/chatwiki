import{j as t,L as p,M as w,V as e,X as R,Y as U,S as Y,a8 as Q,P as L,Q as s,W as He,a2 as ye,r as $,d as P,A as M,E as G,G as X,u as S,a9 as j,a3 as T,a4 as F,F as V,ac as re,ae as de,a1 as D,b as ge,h as Ee,v as Le,y as Ke,w as pe,ab as We,U as Ge,a6 as Xe,p as Ze}from"./vue-chunks-DrvJJrR0.js";import{A as Ye,_ as z,c as ae,B as te,N as et,O as tt,P as ot,e as ee,M as ne,Q as ce,S as ue,E as st}from"../../index-C3D4HQO4.js";import{_ as me}from"./index-C5lzbLNl.js";import{C as nt,E as at}from"./cu-upload-Cd04MV1F.js";import"./index-92XYYNmA.js";import{I as _e}from"./Input-BVrvRKk_.js";import{_ as ve}from"./TextArea-Hvz_NOKt.js";import{c as Ue}from"./index-D2OC7FNz.js";import{S as Oe,a as Re,_ as Ae}from"./index-CK6XLfa6.js";import{_ as Me}from"./index-D6xWDfR9.js";import{_ as ke}from"./index-1NcpBXFq.js";import{Q as W}from"./QuestionCircleOutlined-CdbzAklR.js";import{_ as xe}from"./index-Cu7s0I6-.js";import{_ as it,a as lt}from"./index-BZK3XV9r.js";import{_ as oe}from"./index-CQom3Nvi.js";import{g as ze}from"./index-4jhODJXn.js";import{S as ct}from"./SearchOutlined-D67jTUps.js";import{C as Ve,_ as Ne}from"./index-BDCGZp8a.js";import{S as Be}from"./index-WDhJTqVN.js";import{_ as _t}from"./index-Y9KLXA0t.js";import{_ as ie}from"./index-apSKrHEW.js";import{g as De}from"./index-CFSigmBv.js";import{_ as rt}from"./empty-CzGZrENG.js";import{d as $e}from"./vuedraggable.umd-BZm2M5ml.js";import{P as Qe}from"./PlusOutlined-CuZGeFo-.js";import"./index-CiMXXF-o.js";import{R as dt,_ as ut}from"./RadioButton-RnRA7W0e.js";import{F as Ce,_ as pt}from"./index-Dy2UaLQp.js";import{s as mt}from"./index-Dvk58OIJ.js";import{u as vt}from"./robot-BCpeMZv_.js";import{T as ft,_ as ht}from"./index-D940WHle.js";import"./dayjs-Bv4VEw_C.js";import"./axios-Cm0UX6qg.js";import"./qs-QntUJHOZ.js";import"./crypto-js-BpV8n4kc.js";import"./FormItemContext-BDLcJmuw.js";import"./index-BiAIeTEt.js";import"./Search-2etv_UE_.js";import"./inputProps-AgB5Odoi.js";import"./Password-DHIwewzt.js";import"./index-BCwkXfxz.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./colors-DfBzDIod.js";import"./slide-BDhWp3gd.js";import"./CheckOutlined-CTzTXmhw.js";import"./DownOutlined-efyh-RzL.js";import"./move-CM83rOfC.js";import"./responsiveObserve-DLBlQQpe.js";import"./collapseMotion-DfZt1qrJ.js";import"./index-NXEUm3Jt.js";import"./shallowequal-CfnxU2uU.js";import"./Dropdown-C3qXFNcz.js";import"./useRefs-Bj34oM9A.js";var bt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};const yt=bt;function Ie(c){for(var l=1;l<arguments.length;l++){var m=arguments[l]!=null?Object(arguments[l]):{},r=Object.keys(m);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(m).filter(function(o){return Object.getOwnPropertyDescriptor(m,o).enumerable}))),r.forEach(function(o){gt(c,o,m[o])})}return c}function gt(c,l,m){return l in c?Object.defineProperty(c,l,{value:m,enumerable:!0,configurable:!0,writable:!0}):c[l]=m,c}var we=function(l,m){var r=Ie({},l,m.attrs);return t(Ye,Ie({},r,{icon:yt}),null)};we.displayName="SyncOutlined";we.inheritAttrs=!1;const kt=we,xt={class:"edit-box-header"},$t={class:"left-box"},wt={class:"edit-box-title"},qt={key:0},St={key:0,class:"title-tip"},Ct={class:"right-box"},It={class:"extra-box"},Et={class:"actions-box"},Lt={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(c,{emit:l}){const m=l,r=c,o=n=>{m("edit"),m("update:isEdit",n)},i=()=>{m("save")};return(n,y)=>{const a=ae,g=te,q=me;return p(),w("div",{class:ye(["edit-box",{"is-edit":c.isEdit}])},[e("div",xt,[e("div",$t,[t(a,{class:"edit-box-icon",name:r.iconName},null,8,["name"]),e("span",wt,[R(U(r.title)+" ",1),n.$slots.icon?(p(),w("span",qt,[Y(n.$slots,"icon",{},void 0,!0)])):Q("",!0)]),n.$slots.tip?(p(),w("span",St,[Y(n.$slots,"tip",{},void 0,!0)])):Q("",!0)]),e("div",Ct,[e("div",It,[Y(n.$slots,"extra",{},()=>[e("div",Et,[r.isEdit?(p(),L(q,{key:0,gap:8},{default:s(()=>[t(g,{onClick:i,size:"small",type:"primary"},{default:s(()=>[R("保存")]),_:1}),t(g,{onClick:y[0]||(y[0]=k=>o(!1)),size:"small"},{default:s(()=>[R("取消")]),_:1})]),_:1})):(p(),L(g,{key:1,onClick:y[1]||(y[1]=k=>o(!0)),size:"small"},{default:s(()=>[R("修改")]),_:1}))])],!0)])])]),e("div",{class:"edit-box-body",style:He({...c.bodyStyle})},[Y(n.$slots,"default",{},void 0,!0)],4)],2)}}},H=z(Lt,[["__scopeId","data-v-dbe09743"]]),je=c=>(T("data-v-899bcb03"),c=c(),F(),c),Ut={class:"robot-form-box"},Ot={class:"form-item"},Rt=je(()=>e("div",{class:"form-item-label"},"机器人名称/头像",-1)),At={class:"form-item-body robot-name-item"},Mt={class:"robot-avetar-upload"},zt=["src"],Vt={class:"robot-name-box"},Nt={class:"form-item"},Bt=je(()=>e("div",{class:"form-item-label"},"简介",-1)),Dt={class:"form-item-body"},Qt={class:"robot-info-box"},jt={class:"robot-name-box"},Pt=["src"],Tt={class:"robot-name"},Ft={class:"robot-intro"},Jt={__name:"basic-config",setup(c){const l=$(!1),{robotInfo:m,updateRobotInfo:r}=P("robotInfo"),o=M({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),i=()=>{r({...j(o)}),l.value=!1},n=a=>{let g=a[0];return o.robot_avatar=g,et(g).then(q=>{o.robot_avatar_url=q}),!1},y=()=>{o.robot_name=m.robot_name,o.robot_intro=m.robot_intro,o.robot_avatar=m.robot_avatar,o.robot_avatar_url=m.robot_avatar_url};return(a,g)=>{const q=_e,k=ve;return p(),L(H,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:l.value,"onUpdate:isEdit":g[2]||(g[2]=u=>l.value=u),onSave:i,onEdit:y},{default:s(()=>[G(e("div",Ut,[e("div",Ot,[Rt,e("div",At,[t(nt,{accept:"image/*",onChange:n},{default:s(()=>[e("div",Mt,[o.robot_avatar_url?(p(),w("img",{key:0,class:"robot-avetar",src:o.robot_avatar_url},null,8,zt)):Q("",!0)])]),_:1}),e("div",Vt,[t(q,{value:o.robot_name,"onUpdate:value":g[0]||(g[0]=u=>o.robot_name=u),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",Nt,[Bt,e("div",Dt,[t(k,{rows:3,value:o.robot_intro,"onUpdate:value":g[1]||(g[1]=u=>o.robot_intro=u),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[X,l.value]]),G(e("div",Qt,[e("div",jt,[e("img",{class:"robot-avatar",src:S(m).robot_avatar_url,alt:""},null,8,Pt),e("span",Tt,U(S(m).robot_name),1)]),e("div",Ft,U(S(m).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)],512),[[X,!l.value]])]),_:1},8,["isEdit"])}}},Ht=z(Jt,[["__scopeId","data-v-899bcb03"]]),Kt={class:"robot-form-box"},Wt={class:"form-item"},Gt={class:"robot-info-box"},Xt={class:"robot-prompt"},Zt={__name:"system-prompt-words",setup(c){const l=$(!1),{robotInfo:m,updateRobotInfo:r}=P("robotInfo"),o=M({prompt:""}),i=()=>{r({...j(o)}),l.value=!1},n=()=>{o.prompt=m.prompt};return(y,a)=>{const g=ve;return p(),L(H,{class:"setting-box",title:"系统提示词","icon-name":"xitongtishici",isEdit:l.value,"onUpdate:isEdit":a[1]||(a[1]=q=>l.value=q),onSave:i,onEdit:n},{default:s(()=>[G(e("div",Kt,[e("div",Wt,[t(g,{rows:4,value:o.prompt,"onUpdate:value":a[0]||(a[0]=q=>o.prompt=q),placeholder:"请输入提示词","allow-clear":""},null,8,["value"])])],512),[[X,l.value]]),G(e("div",Gt,[e("div",Xt,U(S(m).prompt),1)],512),[[X,!l.value]])]),_:1},8,["isEdit"])}}},Yt=z(Zt,[["__scopeId","data-v-49969601"]]),fe=c=>(T("data-v-ce956f07"),c=c(),F(),c),eo={class:"actions-box"},to={class:"model-name"},oo={key:0,class:"form-box"},so={class:"form-item"},no=fe(()=>e("div",{class:"form-item-label"},[e("span",null,"LLM模型 ")],-1)),ao={class:"form-item-body"},io=["src"],lo={key:0},co={key:1},_o={class:"form-item"},ro={class:"form-item-label"},uo=fe(()=>e("span",null,"温度 ",-1)),po={class:"form-item-body"},mo={class:"number-box"},vo={class:"number-slider-box"},fo={class:"number-input-box"},ho={class:"form-item"},bo={class:"form-item-label"},yo=fe(()=>e("span",null,"最大token ",-1)),go={class:"form-item-body"},ko={class:"number-box"},xo={class:"number-slider-box"},$o={class:"number-input-box"},wo={class:"form-item"},qo={class:"form-item-label"},So=fe(()=>e("span",null,"上下文数量 ",-1)),Co={class:"form-item-body"},Io={class:"number-box"},Eo={class:"number-slider-box"},Lo={class:"number-input-box"},Uo={__name:"model-settings",setup(c){const l=["azure","ollama","xinference","openaiAgent"],m=["azure"],r=M({sm:24,md:24,lg:12,xl:8,xxl:8}),o=$([]),i=$(!1),{robotInfo:n,updateRobotInfo:y}=P("robotInfo"),a=M({use_model:void 0,model_config_id:"",temperature:0,max_token:0,context_pair:0}),g=$(""),q=$(""),k=$(""),u=(v,h)=>{const b=h.current_obj;a.use_model=l.indexOf(b.model_define)>-1&&b.deployment_name?b.deployment_name:b.name,g.value=b.model_define,a.model_config_id=b.id||h.model_config_id},d=()=>{k.value=a.use_model,m.indexOf(g.value)>-1&&(a.use_model="默认"),y({...j(a)}),i.value=!1},x=v=>{v||(g.value=q.value),l.indexOf(g.value)>-1?a.use_model=k.value:a.use_model=n.use_model,a.model_config_id=n.model_config_id,a.temperature=n.temperature,a.max_token=n.max_token,a.context_pair=n.context_pair,i.value=v};function I(v,h,b){const _=new Set(v.map(O=>O.model_define));return h.filter(O=>{let N=O[b];_.has(N)&&v.filter(J=>{if(J.model_define==N)return J.children=ot(J.children,O.children),!1})}),v}return(()=>{Ue({model_type:"LLM"}).then(v=>{k.value=n.use_model;let h=v.data||[],b=[];o.value=h.map(_=>{b=[];for(let O=0;O<_.model_info.llm_model_list.length;O++){const N=_.model_info.llm_model_list[O];l.indexOf(_.model_info.model_define)>-1&&n.model_config_id==_.model_config.id&&(k.value=_.model_config.deployment_name,g.value=_.model_info.model_define,q.value=_.model_info.model_define),b.push({name:N,deployment_name:_.model_config.deployment_name,id:_.model_config.id,model_define:_.model_info.model_define})}return{id:_.model_config.id,name:_.model_info.model_name,model_define:_.model_info.model_define,icon:_.model_info.model_icon_url,children:b,deployment_name:_.model_config.deployment_name}}),o.value=I(tt(o.value,"model_define"),o.value,"model_define")})})(),(v,h)=>{const b=te,_=me,O=xe,N=Oe,J=Re,Z=Ae,A=it,E=oe,K=Me,le=ke,be=lt;return p(),L(H,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:i.value,"onUpdate:isEdit":h[9]||(h[9]=C=>i.value=C)},{extra:s(()=>[e("div",eo,[i.value?(p(),L(_,{key:0,gap:8},{default:s(()=>[t(b,{onClick:d,size:"small",type:"primary"},{default:s(()=>[R("保存")]),_:1}),t(b,{onClick:h[0]||(h[0]=C=>x(!1)),size:"small"},{default:s(()=>[R("取消")]),_:1})]),_:1})):(p(),w(V,{key:1},[e("span",to,U(k.value),1),t(O,{type:"vertical"}),t(b,{onClick:h[1]||(h[1]=C=>x(!0)),size:"small"},{default:s(()=>[R("修改")]),_:1})],64))])]),default:s(()=>[i.value?(p(),w("div",oo,[t(be,{gutter:[32,16]},{default:s(()=>[t(A,re(de(r)),{default:s(()=>[e("div",so,[no,e("div",ao,[t(Z,{value:a.use_model,"onUpdate:value":h[2]||(h[2]=C=>a.use_model=C),placeholder:"请选择LLM模型",onChange:u,style:{width:"100%"}},{default:s(()=>[(p(!0),w(V,null,D(o.value,C=>(p(),L(J,{key:C.id},{label:s(()=>[t(_,{align:"center",gap:6},{default:s(()=>[e("img",{class:"model-icon",src:C.icon,alt:""},null,8,io),R(U(C.name),1)]),_:2},1024)]),default:s(()=>[(p(!0),w(V,null,D(C.children,B=>(p(),L(N,{value:l.indexOf(C.model_define)>-1&&B.deployment_name?B.deployment_name:B.name+B.id,model_config_id:C.id,current_obj:B,key:B.name+B.id},{default:s(()=>[l.indexOf(C.model_define)>-1&&B.deployment_name?(p(),w("span",lo,U(B.deployment_name),1)):(p(),w("span",co,U(B.name),1))]),_:2},1032,["value","model_config_id","current_obj"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])]),_:1},16),t(A,re(de(r)),{default:s(()=>[e("div",_o,[e("div",ro,[uo,t(E,null,{title:s(()=>[R("温度越低，回答越严谨。温度越高，回答越发散。")]),default:s(()=>[t(S(W),{class:"question-icon"})]),_:1})]),e("div",po,[e("div",mo,[e("div",vo,[t(K,{class:"custom-slider",value:a.temperature,"onUpdate:value":h[3]||(h[3]=C=>a.temperature=C),min:0,max:2,step:.1},null,8,["value"])]),e("div",fo,[t(le,{value:a.temperature,"onUpdate:value":h[4]||(h[4]=C=>a.temperature=C),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),t(A,re(de(r)),{default:s(()=>[e("div",ho,[e("div",bo,[yo,t(E,null,{title:s(()=>[R("问题+答案的最大token数，如果出现回答被截断，可调高此值")]),default:s(()=>[t(S(W),{class:"question-icon"})]),_:1})]),e("div",go,[e("div",ko,[e("div",xo,[t(K,{class:"custom-slider",value:a.max_token,"onUpdate:value":h[5]||(h[5]=C=>a.max_token=C),min:0,max:100*1024},null,8,["value"])]),e("div",$o,[t(le,{value:a.max_token,"onUpdate:value":h[6]||(h[6]=C=>a.max_token=C),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),t(A,re(de(r)),{default:s(()=>[e("div",wo,[e("div",qo,[So,t(E,null,{title:s(()=>[R("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置10轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")]),default:s(()=>[t(S(W),{class:"question-icon"})]),_:1})]),e("div",Co,[e("div",Io,[e("div",Eo,[t(K,{class:"custom-slider",value:a.context_pair,"onUpdate:value":h[7]||(h[7]=C=>a.context_pair=C),min:0,max:10},null,8,["value"])]),e("div",Lo,[t(le,{value:a.context_pair,"onUpdate:value":h[8]||(h[8]=C=>a.context_pair=C),min:0,max:10},null,8,["value"])])])])])]),_:1},16)]),_:1})])):Q("",!0)]),_:1},8,["isEdit"])}}},Oo=z(Uo,[["__scopeId","data-v-ce956f07"]]),Ro={class:"library-checkbox-box"},Ao={class:"list-tools"},Mo={class:"list-box",ref:"scrollContainer"},zo={class:"library-name"},Vo={class:"library-desc"},No={__name:"library-select-alert",emits:["change"],setup(c,{expose:l,emit:m}){const r=m,o=M({indeterminate:!1,checkAll:!1,checkedList:[]}),i=$(!1),n=f=>{u(),o.checkedList=f,i.value=!0},y=()=>{i.value=!1,k()},a=$(""),g=()=>{u()},q=$([]),k=()=>{r("change",[...o.checkedList])},u=async()=>{const f=await ze({library_name:a.value});if(f){let v=f.data||[];q.value=v}},d=$(!1),x=async()=>{d.value=!0,await u(),d.value=!1,ee.success("刷新完成")},I=()=>{window.open("/#/library/add")};return l({open:n}),(f,v)=>{const h=_t,b=_e,_=te,O=Ve,N=Ne,J=Be,Z=ne;return p(),L(Z,{width:"746px",open:i.value,"onUpdate:open":v[2]||(v[2]=A=>i.value=A),title:"关联知识库",onOk:y},{default:s(()=>[e("div",Ro,[t(h,{message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"}),e("div",Ao,[e("div",null,[t(b,{style:{width:"282px"},value:a.value,"onUpdate:value":v[0]||(v[0]=A=>a.value=A),placeholder:"请输入知识库名称搜索",onChange:g},{suffix:s(()=>[t(S(ct),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),e("div",null,[t(_,{style:{"margin-right":"8px"},onClick:x},{default:s(()=>[t(S(kt)),R(" 刷新 ")]),_:1}),t(_,{type:"primary",ghost:"",onClick:I},{default:s(()=>[R("新建知识库")]),_:1})])]),t(J,{spinning:d.value,delay:100},{default:s(()=>[t(N,{value:o.checkedList,"onUpdate:value":v[1]||(v[1]=A=>o.checkedList=A),style:{width:"100%"}},{default:s(()=>[e("div",Mo,[(p(!0),w(V,null,D(q.value,A=>(p(),w("div",{class:"list-item-wraapper",key:A.id},[t(O,{class:"list-item",value:A.id},{default:s(()=>[e("div",zo,U(A.library_name),1),e("div",Vo,U(A.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},Bo=z(No,[["__scopeId","data-v-f9210a6f"]]),he=c=>(T("data-v-e6571a88"),c=c(),F(),c),Do={class:"recall-settings-box"},Qo={class:"form-box"},jo={class:"form-item is-required"},Po=he(()=>e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),To={class:"form-item-body"},Fo={class:"retrieval-mode-items"},Jo=["onClick"],Ho={class:"retrieval-mode-title"},Ko={class:"title-text"},Wo={class:"retrieval-mode-desc"},Go={class:"form-item"},Xo={class:"form-item-label"},Zo=he(()=>e("span",null,"Top K ",-1)),Yo={class:"form-item-body"},es={class:"number-box"},ts={class:"number-slider-box"},os={class:"number-input-box"},ss={class:"form-item"},ns={class:"form-item-label"},as=he(()=>e("span",null,"相似度阈值 ",-1)),is={class:"form-item-body"},ls={class:"number-box"},cs={class:"number-slider-box"},_s={class:"number-input-box"},rs={class:"form-item"},ds={class:"form-item-label"},us=he(()=>e("span",null,"Rerank模型",-1)),ps={class:"form-item-body"},ms=["src"],vs={__name:"recall-settings-alert",emits:["change"],setup(c,{expose:l,emit:m}){const r=m,o=$([{iconName:"search",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行全文检索和向量检索，使用RRF算法进行排序，从两中查询结果中选择更匹配用户问题的结果"},{iconName:"file-search",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果"},{iconName:"comment-search",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),i=M({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),n=$(!1),y=I=>{x(),i.rerank_status=I.rerank_status||0,i.rerank_use_model=I.rerank_use_model||void 0,i.rerank_model_config_id=I.rerank_model_config_id||"",i.top_k=I.top_k,i.similarity=I.similarity,i.search_type=I.search_type,n.value=!0},a=(I,f)=>{i.rerank_model_config_id=f.rerank_model_config_id},g=I=>{i.search_type=I},q=()=>i.rerank_status==1&&!i.rerank_model_config_id,k=()=>{if(q())return ee.error("请选择Rerank模型");n.value=!1,u()},u=()=>{r("change",j(i))},d=$([]),x=()=>{Ue({model_type:"RERANK"}).then(I=>{let f=I.data||[];d.value=f.map(v=>({id:v.model_config.id,name:v.model_info.model_name,icon:v.model_info.model_icon_url,children:v.model_info.rerank_model_list}))})};return l({open:y}),(I,f)=>{const v=ae,h=oe,b=Me,_=ke,O=ie,N=Oe,J=Re,Z=Ae,A=ne;return p(),L(A,{width:"472px",open:n.value,"onUpdate:open":f[6]||(f[6]=E=>n.value=E),title:"召回设置",onOk:k},{default:s(()=>[e("div",Do,[e("div",Qo,[e("div",jo,[Po,e("div",To,[e("div",Fo,[(p(!0),w(V,null,D(o.value,E=>(p(),w("div",{class:ye(["retrieval-mode-item",{active:i.search_type==E.value}]),key:E.value,onClick:K=>g(E.value)},[i.search_type==E.value?(p(),L(v,{key:0,class:"check-arrow",name:"check-arrow-filled"})):Q("",!0),e("div",Ho,[t(v,{name:E.iconName,class:"title-icon"},null,8,["name"]),e("span",Ko,U(E.title),1),E.isRecommendation?(p(),L(v,{key:0,class:"recommendation-icon",name:"recommendation"})):Q("",!0)]),e("div",Wo,U(E.desc),1)],10,Jo))),128))])])]),e("div",Go,[e("div",Xo,[Zo,t(h,null,{title:s(()=>[R("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:s(()=>[t(S(W),{class:"question-icon"})]),_:1})]),e("div",Yo,[e("div",es,[e("div",ts,[t(b,{class:"custom-slider",value:i.top_k,"onUpdate:value":f[0]||(f[0]=E=>i.top_k=E),min:1,max:10},null,8,["value"])]),e("div",os,[t(_,{value:i.top_k,"onUpdate:value":f[1]||(f[1]=E=>i.top_k=E),min:1,max:10},null,8,["value"])])])])]),e("div",ss,[e("div",ns,[as,t(h,null,{title:s(()=>[R("召回时，只会召回相似度大于阈值的文本分段。")]),default:s(()=>[t(S(W),{class:"question-icon"})]),_:1})]),e("div",is,[e("div",ls,[e("div",cs,[t(b,{class:"custom-slider",value:i.similarity,"onUpdate:value":f[2]||(f[2]=E=>i.similarity=E),min:0,max:1,step:.01},null,8,["value"])]),e("div",_s,[t(_,{value:i.similarity,"onUpdate:value":f[3]||(f[3]=E=>i.similarity=E),min:0,max:1,step:.01},null,8,["value"])])])])]),e("div",rs,[e("div",ds,[us,R("   "),t(O,{checkedValue:1,unCheckedValue:0,checked:i.rerank_status,"onUpdate:checked":f[4]||(f[4]=E=>i.rerank_status=E)},null,8,["checked"])]),e("div",ps,[t(Z,{value:i.rerank_use_model,"onUpdate:value":f[5]||(f[5]=E=>i.rerank_use_model=E),placeholder:"请选择Rerank模型",onChange:a,style:{width:"320px"}},{default:s(()=>[(p(!0),w(V,null,D(d.value,E=>(p(),L(J,{key:E.id},{label:s(()=>[e("span",null,[e("img",{class:"model-icon",src:E.icon,alt:""},null,8,ms)])]),default:s(()=>[(p(!0),w(V,null,D(E.children,K=>(p(),L(N,{value:K,rerank_model_config_id:E.id,key:K},{default:s(()=>[e("span",null,U(K),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])])])]),_:1},8,["open"])}}},fs=z(vs,[["__scopeId","data-v-e6571a88"]]),hs={class:"actions-box"},bs={key:0,class:"library-list"},ys=["onClick"],gs={class:"library-name"},ks={class:"library-intro"},xs={__name:"index",setup(c){const l=$(!1),{robotInfo:m,updateRobotInfo:r}=P("robotInfo"),o=M({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),i=$([]),n=$(null),y=ge(()=>i.value.filter(f=>o.library_ids.includes(f.id))),a=f=>{let v=o.library_ids.indexOf(f.id);o.library_ids.splice(v,1),x()},g=f=>{o.library_ids=[...f],x()},q=()=>{n.value.open([...o.library_ids])},k=$(null),u=()=>{k.value.open(j(o))},d=f=>{o.rerank_status=f.rerank_status,o.rerank_use_model=f.rerank_use_model,o.rerank_model_config_id=f.rerank_model_config_id,o.top_k=f.top_k,o.similarity=f.similarity,o.search_type=f.search_type,x()},x=()=>{let f={...j(o)};f.library_ids=f.library_ids.join(","),r({...f})};return(async()=>{const f=await ze();f&&(i.value=f.data||[])})(),Ee(()=>{o.library_ids=m.library_ids.split(","),o.rerank_status=m.rerank_status||0,o.rerank_use_model=m.rerank_use_model||void 0,o.rerank_model_config_id=m.rerank_model_config_id||"",o.top_k=m.top_k,o.similarity=m.similarity,o.search_type=m.search_type}),(f,v)=>{const h=te,b=me;return p(),L(H,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:l.value,"onUpdate:isEdit":v[0]||(v[0]=_=>l.value=_),bodyStyle:{padding:0}},{extra:s(()=>[e("div",hs,[t(b,{gap:8},{default:s(()=>[t(h,{size:"small",onClick:u},{default:s(()=>[R("召回设置")]),_:1}),t(h,{size:"small",onClick:q},{default:s(()=>[R("关联知识库")]),_:1})]),_:1})])]),default:s(()=>[y.value.length>0?(p(),w("div",bs,[(p(!0),w(V,null,D(y.value,_=>(p(),w("div",{class:"library-item",key:_.id},[e("span",{class:"close-btn",onClick:O=>a(_)},[t(S(ce))],8,ys),e("div",gs,U(_.library_name),1),e("div",ks,U(_.library_intro),1)]))),128))])):Q("",!0),t(Bo,{ref_key:"librarySelectAlertRef",ref:n,onChange:g},null,512),t(fs,{ref_key:"recallSettingsAlertRef",ref:k,onChange:d},null,512)]),_:1},8,["isEdit"])}}},$s=z(xs,[["__scopeId","data-v-96e96ac2"]]),ws=c=>(T("data-v-b559dd08"),c=c(),F(),c),qs={class:"library-checkbox-box"},Ss={class:"list-box",ref:"scrollContainer"},Cs={class:"library-name"},Is={class:"library-desc"},Es={key:0,class:"empty-box"},Ls=ws(()=>e("img",{src:rt,alt:""},null,-1)),Us={__name:"library-select-alert",emits:["change"],setup(c,{expose:l,emit:m}){const r=m,o=M({indeterminate:!1,checkAll:!1,checkedList:[]}),i=$(!1),n=d=>{q(),o.checkedList=d,i.value=!0},y=()=>{i.value=!1,g()};$("");const a=$([]),g=()=>{r("change",[...o.checkedList])},q=async()=>{const d=await De();if(d){let x=d.data||[];a.value=x}},k=$(!1),u=()=>{window.open("/#/database/list")};return l({open:n}),(d,x)=>{const I=Ve,f=Ne,v=Be,h=ne;return p(),L(h,{width:"746px",open:i.value,"onUpdate:open":x[1]||(x[1]=b=>i.value=b),title:"关联数据表",onOk:y},{default:s(()=>[e("div",qs,[t(v,{spinning:k.value,delay:100},{default:s(()=>[t(f,{value:o.checkedList,"onUpdate:value":x[0]||(x[0]=b=>o.checkedList=b),style:{width:"100%"}},{default:s(()=>[e("div",Ss,[(p(!0),w(V,null,D(a.value,b=>(p(),w("div",{class:"list-item-wraapper",key:b.id},[t(I,{class:"list-item",value:b.id},{default:s(()=>[e("div",Cs,U(b.name),1),e("div",Is,U(b.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!k.value&&!a.value.length?(p(),w("div",Es,[Ls,e("div",null,[R(" 暂无数据表, 请先去添加数据表 "),e("a",{onClick:u}," 去添加")])])):Q("",!0)])]),_:1},8,["open"])}}},Os=z(Us,[["__scopeId","data-v-b559dd08"]]),Rs=c=>(T("data-v-de8ee53c"),c=c(),F(),c),As=Rs(()=>e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)),Ms={class:"actions-box"},zs={key:0,class:"library-list"},Vs=["onClick"],Ns={class:"library-name"},Bs={class:"library-intro"},Ds={__name:"index",setup(c){const l=$(!1),{robotInfo:m,updateRobotInfo:r}=P("robotInfo"),o=M({form_ids:[]}),i=$([]),n=$(null),y=ge(()=>i.value.filter(d=>o.form_ids.includes(d.id))),a=d=>{let x=o.form_ids.indexOf(d.id);o.form_ids.splice(x,1),k()},g=d=>{o.form_ids=[...d],k()},q=()=>{n.value.open([...o.form_ids])},k=()=>{let d={...j(o)};d.form_ids=d.form_ids.join(","),r({...d})};return(async()=>{const d=await De();d&&(i.value=d.data||[])})(),Ee(()=>{o.form_ids=m.form_ids.split(",")}),(d,x)=>{const I=oe,f=te,v=me;return p(),L(H,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:l.value,"onUpdate:isEdit":x[0]||(x[0]=h=>l.value=h),bodyStyle:{padding:0}},{tip:s(()=>[t(I,{placement:"top"},{title:s(()=>[As]),default:s(()=>[t(S(W))]),_:1})]),extra:s(()=>[e("div",Ms,[t(v,{gap:8},{default:s(()=>[t(f,{size:"small",onClick:q},{default:s(()=>[R("关联数据表")]),_:1})]),_:1})])]),default:s(()=>[y.value.length>0?(p(),w("div",zs,[(p(!0),w(V,null,D(y.value,h=>(p(),w("div",{class:"library-item",key:h.id},[e("span",{class:"close-btn",onClick:b=>a(h)},[t(S(ce))],8,Vs),e("div",Ns,U(h.name),1),e("div",Bs,U(h.description),1)]))),128))])):Q("",!0),t(Os,{ref_key:"librarySelectAlertRef",ref:n,onChange:g},null,512)]),_:1},8,["isEdit"])}}},Qs=z(Ds,[["__scopeId","data-v-de8ee53c"]]),js={class:"form-box"},Ps={class:"question-title"},Ts={class:"question-options"},Fs={class:"question-option"},Js={class:"drag-btn"},Hs={class:"action-box"},Ks={class:"robot-info-box"},Ws={class:"robot-welcome-content"},Gs={class:"robot-welcome-question"},Xs={__name:"welcome-words",setup(c){const l=$(!1),m=$(!1),{robotInfo:r,updateRobotInfo:o,scrollBoxToBottom:i}=P("robotInfo"),n=M({welcomes:{content:"",question:[]}}),y=()=>{let u=!1;if(n.welcomes.question.length>0){for(let d=0;d<n.welcomes.question.length;d++)if(!n.welcomes.question[d].content){u=d+1;break}}return u},a=()=>{n.welcomes.question.push({content:"",id:ue(8)})},g=u=>{n.welcomes.question.splice(u,1)},q=()=>{if(!n.welcomes.content)return ee.error("请输入欢迎语");if(y())return ee.error("引导问题内容不能为空");o({...j(n)}),l.value=!1},k=()=>{let u={...r.welcomes},d=[];u.question.forEach(({content:x,id:I})=>{let f={id:I,content:x};f.id||(f.id=ue(6)),d.push(f)}),n.welcomes.content=u.content,n.welcomes.question=d};return(u,d)=>{const x=ve,I=ae,f=_e;return p(),L(H,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:l.value,"onUpdate:isEdit":d[4]||(d[4]=v=>l.value=v),onSave:q,onEdit:k},{default:s(()=>[G(e("div",js,[e("div",Ps,[t(x,{value:n.welcomes.content,"onUpdate:value":d[0]||(d[0]=v=>n.welcomes.content=v),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",Ts,[t(S($e),{modelValue:n.welcomes.question,"onUpdate:modelValue":d[1]||(d[1]=v=>n.welcomes.question=v),"item-key":"id",handle:".drag-btn",onStart:d[2]||(d[2]=v=>m.value=!0),onEnd:d[3]||(d[3]=v=>m.value=!1)},{item:s(({element:v,index:h})=>[e("div",Fs,[e("span",Js,[t(I,{name:"drag"})]),t(f,{class:"question-option-content",value:v.content,"onUpdate:value":b=>v.content=b,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",Hs,[t(S(ce),{class:"del-btn",onClick:b=>g(h)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:a},[t(S(Qe),{class:"add-btn-icon"}),R("添加引导问题 ")])])],512),[[X,l.value]]),G(e("div",Ks,[e("div",Ws,U(S(r).welcomes.content),1),e("div",Gs,[(p(!0),w(V,null,D(S(r).welcomes.question,(v,h)=>(p(),w("div",{class:"question-item",key:h},U(v.content),1))),128))])],512),[[X,!l.value]])]),_:1},8,["isEdit"])}}},Zs=z(Xs,[["__scopeId","data-v-ea227a87"]]),Ys=c=>(T("data-v-bc797bf6"),c=c(),F(),c),en=Ys(()=>e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)),tn={class:"form-box"},on={class:"question-title"},sn={class:"question-options"},nn={class:"question-option"},an={class:"drag-btn"},ln={class:"action-box"},cn={class:"robot-info-box"},_n={class:"robot-unknown-content"},rn={class:"robot-unknown-question"},dn={__name:"unknown-problem-prompt",setup(c){const l=$(!1),m=$(!1),{robotInfo:r,updateRobotInfo:o,scrollBoxToBottom:i}=P("robotInfo"),n=M({unknown_question_prompt:{content:"",question:[]}}),y=()=>{n.unknown_question_prompt.question.push({content:"",id:ue(8)}),Ke(()=>{i()})},a=k=>{n.unknown_question_prompt.question.splice(k,1)},g=()=>{o({...j(n)}),l.value=!1},q=()=>{let k={...r.unknown_question_prompt},u=[];k.question&&k.question.forEach(({content:d,id:x})=>{let I={id:x,content:d};I.id||(I.id=ue(6)),u.push(I)}),k.content&&(n.unknown_question_prompt.content=k.content),u&&(n.unknown_question_prompt.question=u)};return Le(()=>{}),(k,u)=>{const d=oe,x=ve,I=ae,f=_e;return p(),L(H,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:l.value,"onUpdate:isEdit":u[4]||(u[4]=v=>l.value=v),onSave:g,onEdit:q},{tip:s(()=>[t(d,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:s(()=>[en]),default:s(()=>[t(S(W))]),_:1})]),default:s(()=>[G(e("div",tn,[e("div",on,[t(x,{value:n.unknown_question_prompt.content,"onUpdate:value":u[0]||(u[0]=v=>n.unknown_question_prompt.content=v),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",sn,[t(S($e),{modelValue:n.unknown_question_prompt.question,"onUpdate:modelValue":u[1]||(u[1]=v=>n.unknown_question_prompt.question=v),"item-key":"id",handle:".drag-btn",onStart:u[2]||(u[2]=v=>m.value=!0),onEnd:u[3]||(u[3]=v=>m.value=!1)},{item:s(({element:v,index:h})=>[e("div",nn,[e("span",an,[t(I,{name:"drag"})]),t(f,{class:"question-option-content",value:v.content,"onUpdate:value":b=>v.content=b,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",ln,[t(S(ce),{class:"del-btn",onClick:b=>a(h)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:y},[t(S(Qe),{class:"add-btn-icon"}),R("添加引导问题 ")])])],512),[[X,l.value]]),G(e("div",cn,[e("div",_n,U(S(r).unknown_question_prompt.content),1),e("div",rn,[(p(!0),w(V,null,D(S(r).unknown_question_prompt.question,(v,h)=>(p(),w("div",{class:"question-item",key:h},U(v.content),1))),128))])],512),[[X,!l.value]])]),_:1},8,["isEdit"])}}},un=z(dn,[["__scopeId","data-v-bc797bf6"]]),Pe=c=>(T("data-v-c60b8d8e"),c=c(),F(),c),pn=Pe(()=>e("span",null,null,-1)),mn=Pe(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ")],-1)),vn={__name:"problem-optimization",setup(c){$(!1);const{robotInfo:l,updateRobotInfo:m}=P("robotInfo");M({prompt:""});const r=o=>{m({})};return(o,i)=>{const n=ie;return p(),L(H,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:s(()=>[pn]),default:s(()=>[mn,t(n,{onChange:r,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:S(l).enable_question_optimize,"onUpdate:checked":i[0]||(i[0]=y=>S(l).enable_question_optimize=y),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},fn=z(vn,[["__scopeId","data-v-c60b8d8e"]]),Te=c=>(T("data-v-34918831"),c=c(),F(),c),hn=Te(()=>e("span",null,null,-1)),bn=Te(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，机器人回答问题后，自动根据对话内容提供3条用户提问建议 ")],-1)),yn={__name:"suggested-issues",setup(c){$(!1);const{robotInfo:l,updateRobotInfo:m}=P("robotInfo"),r=o=>{m({})};return(o,i)=>{const n=ie;return p(),L(H,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:s(()=>[hn]),default:s(()=>[bn,t(n,{onChange:r,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:S(l).enable_question_guide,"onUpdate:checked":i[0]||(i[0]=y=>S(l).enable_question_guide=y),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},gn=z(yn,[["__scopeId","data-v-34918831"]]),qe=c=>(T("data-v-a0ec9e93"),c=c(),F(),c),kn={class:"direct-title"},xn={class:"direct-desc"},$n={class:"qa"},wn={class:"prompt-form-item-label"},qn=qe(()=>e("span",{class:"qa-title"},"QA文档直接回复答案",-1)),Sn={class:"direct-switch"},Cn={class:"similarity"},In=qe(()=>e("span",null,"相似度超过",-1)),En={class:"number-input-box"},Ln=qe(()=>e("span",null,"时直接回复答案",-1)),Un={__name:"chat-edit-alert",emits:["save"],setup(c,{expose:l,emit:m}){const r=m,o=$(1),i=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],n=M(i()),y=$(!1),a=M({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),g=()=>{a.chat_type=o.value.toString(),n.forEach(u=>{u.chat_type==o.value&&(a.chat_type=="3"?(a.mixture_qa_direct_reply_switch=u.mixture_qa_direct_reply_switch==1?"true":"false",a.mixture_qa_direct_reply_score=u.mixture_qa_direct_reply_score.toString()):a.chat_type=="1"&&(a.library_qa_direct_reply_switch=u.library_qa_direct_reply_switch==1?"true":"false",a.library_qa_direct_reply_score=u.library_qa_direct_reply_score.toString()))}),q(),Object.assign(n,i()),y.value=!1},q=()=>{r("save",j(a))};Le(()=>{});const k=u=>{o.value=parseInt(u.chat_type),a.chat_type=u.chat_type,a.library_qa_direct_reply_score=u.library_qa_direct_reply_score,a.library_qa_direct_reply_switch=u.library_qa_direct_reply_switch,a.mixture_qa_direct_reply_score=u.mixture_qa_direct_reply_score,a.mixture_qa_direct_reply_switch=u.mixture_qa_direct_reply_switch,n.forEach(d=>{d.chat_type=="3"?(d.mixture_qa_direct_reply_score=u.mixture_qa_direct_reply_score,d.mixture_qa_direct_reply_switch=u.mixture_qa_direct_reply_switch=="true"?1:0):d.chat_type=="1"&&(d.library_qa_direct_reply_score=u.library_qa_direct_reply_score,d.library_qa_direct_reply_switch=u.library_qa_direct_reply_switch=="true"?1:0)}),y.value=!0};return pe(()=>y.value,u=>{u===!1&&Object.assign(n,i())},{immediate:!0}),l({open:k}),(u,d)=>{const x=oe,I=ie,f=ke,v=dt,h=ut,b=ne;return p(),L(b,{width:"746px",open:y.value,"onUpdate:open":d[1]||(d[1]=_=>y.value=_),title:"聊天模式设置",onOk:g},{default:s(()=>[t(h,{class:"direct-box",value:o.value,"onUpdate:value":d[0]||(d[0]=_=>o.value=_)},{default:s(()=>[(p(!0),w(V,null,D(n,_=>(p(),L(v,{class:ye(["direct-item",{active:o.value==_.direct_id}]),value:_.direct_id,key:_.direct_id},{default:s(()=>[e("div",kn,U(_.direct_title),1),e("div",xn,U(_.direct_desc),1),G(e("div",$n,[e("div",wn,[qn,t(x,null,We({default:s(()=>[t(S(W),{class:"question-icon"})]),_:2},[_.chat_type=="1"?{name:"title",fn:s(()=>[R("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"0"}:_.chat_type=="3"?{name:"title",fn:s(()=>[R("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"1"}:void 0]),1024),e("div",Sn,[_.chat_type=="1"?(p(),L(I,{key:0,checkedValue:1,unCheckedValue:0,checked:_.library_qa_direct_reply_switch,"onUpdate:checked":O=>_.library_qa_direct_reply_switch=O},null,8,["checked","onUpdate:checked"])):_.chat_type=="3"?(p(),L(I,{key:1,checkedValue:1,unCheckedValue:0,checked:_.mixture_qa_direct_reply_switch,"onUpdate:checked":O=>_.mixture_qa_direct_reply_switch=O},null,8,["checked","onUpdate:checked"])):Q("",!0)])])],512),[[X,_.isQaDirectReply&&o.value==_.direct_id]]),G(e("div",Cn,[In,e("div",En,[_.chat_type=="1"?(p(),L(f,{key:0,value:_.library_qa_direct_reply_score,"onUpdate:value":O=>_.library_qa_direct_reply_score=O,disabled:!_.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):_.chat_type=="3"?(p(),L(f,{key:1,value:_.mixture_qa_direct_reply_score,"onUpdate:value":O=>_.mixture_qa_direct_reply_score=O,disabled:!_.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):Q("",!0)]),Ln],512),[[X,_.isQaDirectReply&&o.value==_.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},On=z(Un,[["__scopeId","data-v-a0ec9e93"]]),Se=c=>(T("data-v-2a920ba8"),c=c(),F(),c),Rn=Se(()=>e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1)),An=Se(()=>e("br",null,null,-1)),Mn=Se(()=>e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)),zn={class:"actions-box"},Vn={class:"model-name"},Nn={class:"form-box"},Bn={__name:"index",setup(c){const l=$(!1),m=$(null),{robotInfo:r,updateRobotInfo:o}=P("robotInfo"),i=M({chat_type:r.chat_type,library_qa_direct_reply_score:r.library_qa_direct_reply_score,library_qa_direct_reply_switch:r.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:r.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:r.mixture_qa_direct_reply_switch}),n=g=>{i.chat_type=g.chat_type,i.library_qa_direct_reply_score=g.library_qa_direct_reply_score,i.library_qa_direct_reply_switch=g.library_qa_direct_reply_switch,i.mixture_qa_direct_reply_score=g.mixture_qa_direct_reply_score,i.mixture_qa_direct_reply_switch=g.mixture_qa_direct_reply_switch,y()},y=()=>{o({...j(i)}),l.value=!1},a=()=>{m.value.open(j(i)),l.value=!0};return(g,q)=>{const k=oe,u=xe,d=te;return p(),L(H,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:l.value,"onUpdate:isEdit":q[1]||(q[1]=x=>l.value=x),bodyStyle:{padding:0}},{tip:s(()=>[t(k,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:s(()=>[Rn,An,Mn]),default:s(()=>[t(S(W))]),_:1})]),extra:s(()=>[e("div",zn,[e("span",Vn,U(S(r).chat_type=="1"?"仅知识库":S(r).chat_type=="2"?"直连模式":"混合模式"),1),t(u,{type:"vertical"}),t(d,{size:"small",onClick:q[0]||(q[0]=x=>a(!0))},{default:s(()=>[R("修改")]),_:1})])]),default:s(()=>[e("div",Nn,[t(On,{ref_key:"ChatEditAlertRef",ref:m,onSave:n},null,512)])]),_:1},8,["isEdit"])}}},Dn=z(Bn,[["__scopeId","data-v-2a920ba8"]]),Qn=c=>(T("data-v-8d185d5f"),c=c(),F(),c),jn={class:"switch-box"},Pn={class:"switch-box-body"},Tn={class:"switch-box-header"},Fn={class:"left-box"},Jn={class:"switch-box-title"},Hn={key:0,class:"title-tip"},Kn={class:"right-box"},Wn={class:"extra-box"},Gn=Qn(()=>e("div",{class:"extra-box"},null,-1)),Xn={class:"switch-desc"},Zn={class:"switch-box-right"},Yn={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(c,{emit:l}){const m=l,r=c,o=$(r.value),i=n=>{m("update:value",n),m("change",n)};return(n,y)=>{const a=ae,g=ie;return p(),w("div",jn,[e("div",Pn,[e("div",Tn,[e("div",Fn,[t(a,{class:"switch-box-icon",name:r.iconName},null,8,["name"]),e("span",Jn,U(r.title),1),n.$slots.tip?(p(),w("span",Hn,[Y(n.$slots,"tip",{},void 0,!0)])):Q("",!0)]),e("div",Kn,[e("div",Wn,[Y(n.$slots,"extra",{},()=>[Gn],!0)])])]),e("div",Xn,[Y(n.$slots,"default",{},void 0,!0)])]),e("div",Zn,[t(g,{checked:o.value,"onUpdate:checked":y[0]||(y[0]=q=>o.value=q),onChange:i,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},Fe=z(Yn,[["__scopeId","data-v-8d185d5f"]]),ea=e("span",null,null,-1),ta=e("div",null,"开启后，在使用H5链接、Web、PC客户端时,可以要求机器人以Markdown格式输出回答",-1),oa={__name:"markdown-setting",setup(c){const{robotInfo:l,updateRobotInfo:m}=P("robotInfo"),r=$(!1);pe(()=>l.show_type,i=>{r.value=i==1},{immediate:!0});const o=()=>{m({show_type:r.value?1:0})};return(i,n)=>(p(),L(Fe,{class:"markdown-setting",title:"Markdown格式输出","icon-name":"jibenpeizhi",value:r.value,"onUpdate:value":n[0]||(n[0]=y=>r.value=y),onChange:o},{extra:s(()=>[ea]),default:s(()=>[ta]),_:1},8,["value"]))}},sa="/assets/img/empty-Bx9z1cwf.png",na="/assets/img/phone-head-COM4IpX2.png",aa="/assets/img/phone-body-D1T2Ayr2.png",ia="/assets/img/phone-footer-ClQtNpln.png",se=c=>(T("data-v-5125783f"),c=c(),F(),c),la={class:"common-problem-box"},ca={class:"left-content-box"},_a={key:0,class:"empty-box"},ra=se(()=>e("img",{src:sa,alt:""},null,-1)),da=se(()=>e("div",{class:"title"},"暂无数据",-1)),ua=se(()=>e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),pa={key:1,class:"lists-box"},ma={class:"drag-btn"},va={class:"title"},fa={class:"opration-box"},ha={class:"preview-box"},ba=se(()=>e("div",{class:"phone-head"},[e("img",{class:"head-img",src:na,alt:""})],-1)),ya={class:"phone-body"},ga=se(()=>e("div",null,[e("img",{class:"body-img",src:aa,alt:""})],-1)),ka={key:0,class:"question-box"},xa=se(()=>e("div",{class:"name"},"常见问题",-1)),$a=se(()=>e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:ia,alt:""})],-1)),wa={__name:"common-problem",setup(c){$(!1);const{robotInfo:l,updateRobotInfo:m}=P("robotInfo"),r=ge(()=>l.common_question_list?JSON.parse(l.common_question_list):[]),o=$([]);o.value=r.value,pe(r,()=>{o.value=r.value});const i=Ce.useForm,n=$(!1),y=$("添加问题"),a=M({question:"",index:-1}),g=M({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:q,validate:k,validateInfos:u}=i(a,g),d=()=>{if(r.value.length>=10)return ee.error("最多设置10条常用问题");n.value=!0,q(),a.question="",a.index=-1},x=(b,_)=>{n.value=!0,q(),a.question=b,a.index=_},I=b=>{let _=[];_=r.value.filter((O,N)=>b!=N),ne.confirm({title:"提醒",icon:t(st),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){m({common_question_list:JSON.stringify(_)})},onCancel(){}})},f=()=>{k().then(()=>{let b=[];a.index>=0?b=r.value.map((_,O)=>O===a.index?a.question:_):b=[a.question,...r.value],m({common_question_list:JSON.stringify(b)}),n.value=!1})},v=b=>{m({})},h=b=>{m({common_question_list:JSON.stringify(o.value)})};return(b,_)=>{const O=oe,N=ie,J=xe,Z=te,A=ae,E=_e,K=pt,le=Ce,be=ne;return p(),w("div",la,[e("div",ca,[t(H,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:s(()=>[t(O,null,{title:s(()=>[R("最多10条。开启后，常见问题会显示在每条问答后面")]),default:s(()=>[t(S(W),{class:"quess-icon"})]),_:1})]),extra:s(()=>[t(N,{onChange:v,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:S(l).enable_common_question,"onUpdate:checked":_[0]||(_[0]=C=>S(l).enable_common_question=C),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t(J,{type:"vertical"}),t(Z,{type:"primary",size:"small",onClick:d},{default:s(()=>[R("添加")]),_:1})]),default:s(()=>[r.value.length==0?(p(),w("div",_a,[ra,da,ua,t(Z,{onClick:d,type:"primary"},{default:s(()=>[R("立即添加")]),_:1})])):(p(),w("div",pa,[t(S($e),{modelValue:o.value,"onUpdate:modelValue":_[1]||(_[1]=C=>o.value=C),handle:".drag-btn","item-key":"index",onEnd:h},{item:s(({element:C,index:B})=>[(p(),w("div",{class:"list-item",key:B},[e("span",ma,[t(A,{name:"drag"})]),e("div",va,U(C),1),e("div",fa,[t(S(at),{onClick:Je=>x(C,B)},null,8,["onClick"]),t(S(ce),{onClick:Je=>I(B)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",ha,[ba,e("div",ya,[ga,r.value.length&&S(l).enable_common_question=="true"?(p(),w("div",ka,[xa,(p(!0),w(V,null,D(r.value,C=>(p(),w("div",{class:"list-item",key:C},U(C),1))),128))])):Q("",!0)]),$a]),t(be,{open:n.value,"onUpdate:open":_[3]||(_[3]=C=>n.value=C),title:y.value,onOk:f,width:"476px"},{default:s(()=>[t(le,{class:"form-box",layout:"vertical"},{default:s(()=>[t(K,Ge({label:"问题名称"},S(u).question),{default:s(()=>[t(E,{maxLength:100,value:a.question,"onUpdate:value":_[2]||(_[2]=C=>a.question=C),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},qa=z(wa,[["__scopeId","data-v-5125783f"]]),Sa=e("span",null,null,-1),Ca=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1),Ia={__name:"display-aitations",setup(c){const{robotInfo:l,updateRobotInfo:m}=P("robotInfo"),r=$(!1);pe(()=>l.answer_source_switch,i=>{r.value=i=="true"},{immediate:!0});const o=()=>{m({answer_source_switch:r.value?"true":"false"})};return(i,n)=>(p(),L(Fe,{title:"显示引文","icon-name":"jibenpeizhi",value:r.value,"onUpdate:value":n[0]||(n[0]=y=>r.value=y),onChange:o},{extra:s(()=>[Sa]),default:s(()=>[Ca]),_:1},8,["value"]))}},Ea={key:0,class:"robot-config-page"},La={class:"setting-box"},Ua={class:"setting-box"},Oa={class:"setting-box"},Ra={class:"setting-box"},Aa={class:"setting-box"},Ma={class:"setting-box"},za={class:"setting-box"},Va={class:"setting-box"},Na={class:"setting-box"},Ba={class:"setting-box"},Da={class:"setting-box"},Qa={class:"setting-box"},ja={key:1,class:"robot-config-page"},Pa={__name:"index",setup(c){const l=vt(),m=$(null),{robotInfo:r}=Xe(l),{getRobot:o}=l,i=()=>{m.value.scrollTop=m.value.scrollHeight},n=$(1),y=$(!1),a=M(r.value);Ze("robotInfo",{robotInfo:a,updateRobotInfo:k=>{let u=JSON.parse(JSON.stringify(k));Object.assign(a,u),q()},scrollBoxToBottom:i});const q=()=>{let k=JSON.parse(JSON.stringify(j(a))),u=k.welcomes;u.question=u.question.map(x=>x.content),k.welcomes=JSON.stringify(u);let d=k.unknown_question_prompt;d.question=d.question.map(x=>x.content),k.unknown_question_prompt=JSON.stringify(d),delete k.robot_avatar_url,y.value=!0,mt(k).then(x=>{if(x.res!=0)return ee.error(x.msg);y.value=!1,ee.success("保存成功"),o(a.id)}).catch(()=>{y.value=!1})};return(k,u)=>{const d=ht,x=ft;return p(),w(V,null,[t(x,{activeKey:n.value,"onUpdate:activeKey":u[0]||(u[0]=I=>n.value=I)},{default:s(()=>[(p(),L(d,{key:1,tab:"基础配置"})),(p(),L(d,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),n.value==1?(p(),w("div",Ea,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:m},[e("div",La,[t(Ht)]),e("div",Ua,[t(Yt)]),e("div",Oa,[t(Oo)]),e("div",Ra,[t($s)]),e("div",Aa,[t(Qs)]),e("div",Ma,[t(Zs)]),e("div",za,[t(Dn)]),e("div",Va,[t(un)]),e("div",Na,[t(oa)]),e("div",Ba,[t(fn)]),e("div",Da,[t(gn)]),e("div",Qa,[t(Ia)])],512)])):(p(),w("div",ja,[t(qa)]))],64)}}},Pi=z(Pa,[["__scopeId","data-v-a4131969"]]);export{Pi as default};
