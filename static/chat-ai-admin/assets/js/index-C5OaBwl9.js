import{k as t,M as p,N as q,W as e,Y as L,Z as R,U as Y,a9 as T,Q as U,S as n,X as De,a3 as he,e as w,d as j,B as A,G as F,H,u as x,aa as Q,a4 as K,a5 as W,F as B,ad as _e,af as re,a2 as P,b as Ie,j as Pe,x as Ee,z as Te,w as be,ac as je,V as Je,a7 as Fe,p as He}from"./vue-chunks-C4JOcZXM.js";import{A as Ke,_ as z,c as oe,B as se,J as We,K as Ze,N as Ge,d as ee,M as le,O as ue,P as de,E as Xe}from"../../index-BgrCTl48.js";import{_ as ye}from"./index-BW3f0XEL.js";import{C as Ye,d as ge,E as et}from"./vuedraggable.umd-BsP717zK.js";import"./index-CFqviVPY.js";import{I as ce,F as Se,_ as tt}from"./Password-BkAGcOtH.js";import{_ as pe,S as ot}from"./TextArea-wsOYN6gn.js";import{b as Ue}from"./index-D4ZvEVkD.js";import{Q as G}from"./inputProps-BZDN953P.js";import{S as Oe,a as Le,_ as Re}from"./index-BfOtUhB_.js";import{_ as Me}from"./index-D0sTKcOU.js";import{_ as ke}from"./index-CmkE5tmJ.js";import{_ as xe}from"./index-yySVv2hI.js";import{_ as st,a as nt}from"./index-DDW69Mlr.js";import{_ as ne}from"./index-CN3fsnGQ.js";import{g as Ae}from"./index-yh2rFKEh.js";import{C as at,_ as it}from"./index-iFbKobMy.js";import{S as lt}from"./index-DTqbM4ub.js";import{_ as ct}from"./index-CBF-ssDo.js";import{_ as ae}from"./index-CVivyHsB.js";import{P as ze}from"./PlusOutlined-CrDiaLWY.js";import{R as _t,_ as rt}from"./index-wl8lhV1o.js";import{s as dt}from"./index-Bgac0nid.js";import{u as ut}from"./robot-BsWrttYp.js";import{T as pt,_ as mt}from"./index-Dxjhh4uj.js";import"./dayjs-CNAygh1a.js";import"./axios-Cm0UX6qg.js";import"./qs-DjRPs0Fx.js";import"./crypto-js-WfkAukZn.js";import"./FormItemContext-De0L87xX.js";import"./collapseMotion-B9mQKKQo.js";import"./index-CnMjbvlp.js";import"./slide-56HIwf-4.js";import"./isMobile-D_4OiXLP.js";import"./CheckOutlined-RqX9Rvfe.js";import"./DownOutlined-clGmvltY.js";import"./move-CyGrGKYK.js";import"./index-DLGdcEmj.js";import"./Dropdown-HPSJqWJO.js";import"./useRefs-q3q6mNJg.js";var vt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};const ft=vt;function Ce(r){for(var c=1;c<arguments.length;c++){var u=arguments[c]!=null?Object(arguments[c]):{},d=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(u).filter(function(o){return Object.getOwnPropertyDescriptor(u,o).enumerable}))),d.forEach(function(o){ht(r,o,u[o])})}return r}function ht(r,c,u){return c in r?Object.defineProperty(r,c,{value:u,enumerable:!0,configurable:!0,writable:!0}):r[c]=u,r}var $e=function(c,u){var d=Ce({},c,u.attrs);return t(Ke,Ce({},d,{icon:ft}),null)};$e.displayName="SyncOutlined";$e.inheritAttrs=!1;const bt=$e,yt={class:"edit-box-header"},gt={class:"left-box"},kt={class:"edit-box-title"},xt={key:0},$t={key:0,class:"title-tip"},wt={class:"right-box"},qt={class:"extra-box"},St={class:"actions-box"},Ct={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(r,{emit:c}){const u=c,d=r,o=s=>{u("edit"),u("update:isEdit",s)},l=()=>{u("save")};return(s,y)=>{const a=oe,b=se,$=ye;return p(),q("div",{class:he(["edit-box",{"is-edit":r.isEdit}])},[e("div",yt,[e("div",gt,[t(a,{class:"edit-box-icon",name:d.iconName},null,8,["name"]),e("span",kt,[L(R(d.title)+" ",1),s.$slots.icon?(p(),q("span",xt,[Y(s.$slots,"icon",{},void 0,!0)])):T("",!0)]),s.$slots.tip?(p(),q("span",$t,[Y(s.$slots,"tip",{},void 0,!0)])):T("",!0)]),e("div",wt,[e("div",qt,[Y(s.$slots,"extra",{},()=>[e("div",St,[d.isEdit?(p(),U($,{key:0,gap:8},{default:n(()=>[t(b,{onClick:l,size:"small",type:"primary"},{default:n(()=>[L("保存")]),_:1}),t(b,{onClick:y[0]||(y[0]=g=>o(!1)),size:"small"},{default:n(()=>[L("取消")]),_:1})]),_:1})):(p(),U(b,{key:1,onClick:y[1]||(y[1]=g=>o(!0)),size:"small"},{default:n(()=>[L("修改")]),_:1}))])],!0)])])]),e("div",{class:"edit-box-body",style:De({...r.bodyStyle})},[Y(s.$slots,"default",{},void 0,!0)],4)],2)}}},Z=z(Ct,[["__scopeId","data-v-dbe09743"]]),Ve=r=>(K("data-v-899bcb03"),r=r(),W(),r),It={class:"robot-form-box"},Et={class:"form-item"},Ut=Ve(()=>e("div",{class:"form-item-label"},"机器人名称/头像",-1)),Ot={class:"form-item-body robot-name-item"},Lt={class:"robot-avetar-upload"},Rt=["src"],Mt={class:"robot-name-box"},At={class:"form-item"},zt=Ve(()=>e("div",{class:"form-item-label"},"简介",-1)),Vt={class:"form-item-body"},Nt={class:"robot-info-box"},Bt={class:"robot-name-box"},Qt=["src"],Dt={class:"robot-name"},Pt={class:"robot-intro"},Tt={__name:"basic-config",setup(r){const c=w(!1),{robotInfo:u,updateRobotInfo:d}=j("robotInfo"),o=A({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),l=()=>{d({...Q(o)}),c.value=!1},s=a=>{let b=a[0];return o.robot_avatar=b,We(b).then($=>{o.robot_avatar_url=$}),!1},y=()=>{o.robot_name=u.robot_name,o.robot_intro=u.robot_intro,o.robot_avatar=u.robot_avatar,o.robot_avatar_url=u.robot_avatar_url};return(a,b)=>{const $=ce,g=pe;return p(),U(Z,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:c.value,"onUpdate:isEdit":b[2]||(b[2]=_=>c.value=_),onSave:l,onEdit:y},{default:n(()=>[F(e("div",It,[e("div",Et,[Ut,e("div",Ot,[t(Ye,{accept:"image/*",onChange:s},{default:n(()=>[e("div",Lt,[o.robot_avatar_url?(p(),q("img",{key:0,class:"robot-avetar",src:o.robot_avatar_url},null,8,Rt)):T("",!0)])]),_:1}),e("div",Mt,[t($,{value:o.robot_name,"onUpdate:value":b[0]||(b[0]=_=>o.robot_name=_),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",At,[zt,e("div",Vt,[t(g,{rows:3,value:o.robot_intro,"onUpdate:value":b[1]||(b[1]=_=>o.robot_intro=_),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[H,c.value]]),F(e("div",Nt,[e("div",Bt,[e("img",{class:"robot-avatar",src:x(u).robot_avatar_url,alt:""},null,8,Qt),e("span",Dt,R(x(u).robot_name),1)]),e("div",Pt,R(x(u).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)],512),[[H,!c.value]])]),_:1},8,["isEdit"])}}},jt=z(Tt,[["__scopeId","data-v-899bcb03"]]),Jt={class:"robot-form-box"},Ft={class:"form-item"},Ht={class:"robot-info-box"},Kt={class:"robot-prompt"},Wt={__name:"system-prompt-words",setup(r){const c=w(!1),{robotInfo:u,updateRobotInfo:d}=j("robotInfo"),o=A({prompt:""}),l=()=>{d({...Q(o)}),c.value=!1},s=()=>{o.prompt=u.prompt};return(y,a)=>{const b=pe;return p(),U(Z,{class:"setting-box",title:"系统提示词","icon-name":"xitongtishici",isEdit:c.value,"onUpdate:isEdit":a[1]||(a[1]=$=>c.value=$),onSave:l,onEdit:s},{default:n(()=>[F(e("div",Jt,[e("div",Ft,[t(b,{rows:4,value:o.prompt,"onUpdate:value":a[0]||(a[0]=$=>o.prompt=$),placeholder:"请输入提示词","allow-clear":""},null,8,["value"])])],512),[[H,c.value]]),F(e("div",Ht,[e("div",Kt,R(x(u).prompt),1)],512),[[H,!c.value]])]),_:1},8,["isEdit"])}}},Zt=z(Wt,[["__scopeId","data-v-49969601"]]),me=r=>(K("data-v-cb4a3a92"),r=r(),W(),r),Gt={class:"actions-box"},Xt={class:"model-name"},Yt={key:0,class:"form-box"},eo={class:"form-item"},to=me(()=>e("div",{class:"form-item-label"},[e("span",null,"LLM模型 ")],-1)),oo={class:"form-item-body"},so=["src"],no={key:0},ao={key:1},io={class:"form-item"},lo={class:"form-item-label"},co=me(()=>e("span",null,"温度 ",-1)),_o={class:"form-item-body"},ro={class:"number-box"},uo={class:"number-slider-box"},po={class:"number-input-box"},mo={class:"form-item"},vo={class:"form-item-label"},fo=me(()=>e("span",null,"最大token ",-1)),ho={class:"form-item-body"},bo={class:"number-box"},yo={class:"number-slider-box"},go={class:"number-input-box"},ko={class:"form-item"},xo={class:"form-item-label"},$o=me(()=>e("span",null,"上下文数量 ",-1)),wo={class:"form-item-body"},qo={class:"number-box"},So={class:"number-slider-box"},Co={class:"number-input-box"},Io={__name:"model-settings",setup(r){const c=["azure","ollama","xinference","openaiAgent"],u=["azure"],d=A({sm:24,md:24,lg:12,xl:8,xxl:8}),o=w([]),l=w(!1),{robotInfo:s,updateRobotInfo:y}=j("robotInfo"),a=A({use_model:void 0,model_config_id:"",temperature:0,max_token:0,context_pair:0}),b=w(""),$=w(""),g=w(""),_=(m,h)=>{b.value=h.current_obj.model_define,a.model_config_id=h.current_obj.id||h.model_config_id},f=()=>{g.value=a.use_model,u.indexOf(b.value)>-1&&(a.use_model="默认"),y({...Q(a)}),l.value=!1},C=m=>{m||(b.value=$.value),c.indexOf(b.value)>-1?a.use_model=g.value:a.use_model=s.use_model,a.model_config_id=s.model_config_id,a.temperature=s.temperature,a.max_token=s.max_token,a.context_pair=s.context_pair,l.value=m};function I(m,h,S){const i=new Set(m.map(O=>O.model_define));return h.filter(O=>{let V=O[S];i.has(V)&&m.filter(D=>{if(D.model_define==V)return D.children=Ge(D.children,O.children),!1})}),m}return(()=>{Ue({model_type:"LLM"}).then(m=>{g.value=s.use_model;let h=m.data||[],S=[];o.value=h.map(i=>{S=[];for(let O=0;O<i.model_info.llm_model_list.length;O++){const V=i.model_info.llm_model_list[O];c.indexOf(i.model_info.model_define)>-1&&s.model_config_id==i.model_config.id&&(g.value=i.model_config.deployment_name,b.value=i.model_info.model_define,$.value=i.model_info.model_define),S.push({name:V,deployment_name:i.model_config.deployment_name,id:i.model_config.id,model_define:i.model_info.model_define})}return{id:i.model_config.id,name:i.model_info.model_name,model_define:i.model_info.model_define,icon:i.model_info.model_icon_url,children:S,deployment_name:i.model_config.deployment_name}}),o.value=I(Ze(o.value,"model_define"),o.value,"model_define")})})(),(m,h)=>{const S=se,i=ye,O=xe,V=Oe,D=Le,X=Re,M=st,E=ne,J=Me,ie=ke,fe=nt;return p(),U(Z,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:l.value,"onUpdate:isEdit":h[9]||(h[9]=k=>l.value=k)},{extra:n(()=>[e("div",Gt,[l.value?(p(),U(i,{key:0,gap:8},{default:n(()=>[t(S,{onClick:f,size:"small",type:"primary"},{default:n(()=>[L("保存")]),_:1}),t(S,{onClick:h[0]||(h[0]=k=>C(!1)),size:"small"},{default:n(()=>[L("取消")]),_:1})]),_:1})):(p(),q(B,{key:1},[e("span",Xt,R(g.value),1),t(O,{type:"vertical"}),t(S,{onClick:h[1]||(h[1]=k=>C(!0)),size:"small"},{default:n(()=>[L("修改")]),_:1})],64))])]),default:n(()=>[l.value?(p(),q("div",Yt,[t(fe,{gutter:[32,16]},{default:n(()=>[t(M,_e(re(d)),{default:n(()=>[e("div",eo,[to,e("div",oo,[t(X,{value:a.use_model,"onUpdate:value":h[2]||(h[2]=k=>a.use_model=k),placeholder:"请选择LLM模型",onChange:_,style:{width:"100%"}},{default:n(()=>[(p(!0),q(B,null,P(o.value,k=>(p(),U(D,{key:k.id},{label:n(()=>[t(i,{align:"center",gap:6},{default:n(()=>[e("img",{class:"model-icon",src:k.icon,alt:""},null,8,so),L(R(k.name),1)]),_:2},1024)]),default:n(()=>[(p(!0),q(B,null,P(k.children,N=>(p(),U(V,{value:c.indexOf(k.model_define)>-1&&N.deployment_name?N.deployment_name:N.name,model_config_id:k.id,current_obj:N,key:N.name+N.id},{default:n(()=>[c.indexOf(k.model_define)>-1&&N.deployment_name?(p(),q("span",no,R(N.deployment_name),1)):(p(),q("span",ao,R(N.name),1))]),_:2},1032,["value","model_config_id","current_obj"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])]),_:1},16),t(M,_e(re(d)),{default:n(()=>[e("div",io,[e("div",lo,[co,t(E,null,{title:n(()=>[L("温度越低，回答越严谨。温度越高，回答越发散。")]),default:n(()=>[t(x(G),{class:"question-icon"})]),_:1})]),e("div",_o,[e("div",ro,[e("div",uo,[t(J,{class:"custom-slider",value:a.temperature,"onUpdate:value":h[3]||(h[3]=k=>a.temperature=k),min:0,max:2,step:.1},null,8,["value"])]),e("div",po,[t(ie,{value:a.temperature,"onUpdate:value":h[4]||(h[4]=k=>a.temperature=k),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),t(M,_e(re(d)),{default:n(()=>[e("div",mo,[e("div",vo,[fo,t(E,null,{title:n(()=>[L("问题+答案的最大token数，如果出现回答被截断，可调高此值")]),default:n(()=>[t(x(G),{class:"question-icon"})]),_:1})]),e("div",ho,[e("div",bo,[e("div",yo,[t(J,{class:"custom-slider",value:a.max_token,"onUpdate:value":h[5]||(h[5]=k=>a.max_token=k),min:0,max:100*1024},null,8,["value"])]),e("div",go,[t(ie,{value:a.max_token,"onUpdate:value":h[6]||(h[6]=k=>a.max_token=k),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),t(M,_e(re(d)),{default:n(()=>[e("div",ko,[e("div",xo,[$o,t(E,null,{title:n(()=>[L("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置10轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")]),default:n(()=>[t(x(G),{class:"question-icon"})]),_:1})]),e("div",wo,[e("div",qo,[e("div",So,[t(J,{class:"custom-slider",value:a.context_pair,"onUpdate:value":h[7]||(h[7]=k=>a.context_pair=k),min:0,max:10},null,8,["value"])]),e("div",Co,[t(ie,{value:a.context_pair,"onUpdate:value":h[8]||(h[8]=k=>a.context_pair=k),min:0,max:10},null,8,["value"])])])])])]),_:1},16)]),_:1})])):T("",!0)]),_:1},8,["isEdit"])}}},Eo=z(Io,[["__scopeId","data-v-cb4a3a92"]]),Uo={class:"library-checkbox-box"},Oo={class:"list-tools"},Lo={class:"list-box",ref:"scrollContainer"},Ro={class:"library-name"},Mo={class:"library-desc"},Ao={__name:"library-select-alert",emits:["change"],setup(r,{expose:c,emit:u}){const d=u,o=A({indeterminate:!1,checkAll:!1,checkedList:[]}),l=w(!1),s=v=>{_(),o.checkedList=v,l.value=!0},y=()=>{l.value=!1,g()},a=w(""),b=()=>{_()},$=w([]),g=()=>{d("change",[...o.checkedList])},_=async()=>{const v=await Ae({library_name:a.value});if(v){let m=v.data||[];$.value=m}},f=w(!1),C=async()=>{f.value=!0,await _(),f.value=!1,ee.success("刷新完成")},I=()=>{window.open("/#/library/add")};return c({open:s}),(v,m)=>{const h=ct,S=ce,i=se,O=at,V=it,D=lt,X=le;return p(),U(X,{width:"746px",open:l.value,"onUpdate:open":m[2]||(m[2]=M=>l.value=M),title:"关联知识库",onOk:y},{default:n(()=>[e("div",Uo,[t(h,{message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"}),e("div",Oo,[e("div",null,[t(S,{style:{width:"282px"},value:a.value,"onUpdate:value":m[0]||(m[0]=M=>a.value=M),placeholder:"请输入知识库名称搜索",onChange:b},{suffix:n(()=>[t(x(ot),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),e("div",null,[t(i,{style:{"margin-right":"8px"},onClick:C},{default:n(()=>[t(x(bt)),L(" 刷新 ")]),_:1}),t(i,{type:"primary",ghost:"",onClick:I},{default:n(()=>[L("新建知识库")]),_:1})])]),t(D,{spinning:f.value,delay:100},{default:n(()=>[t(V,{value:o.checkedList,"onUpdate:value":m[1]||(m[1]=M=>o.checkedList=M),style:{width:"100%"}},{default:n(()=>[e("div",Lo,[(p(!0),q(B,null,P($.value,M=>(p(),q("div",{class:"list-item-wraapper",key:M.id},[t(O,{class:"list-item",value:M.id},{default:n(()=>[e("div",Ro,R(M.library_name),1),e("div",Mo,R(M.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},zo=z(Ao,[["__scopeId","data-v-f9210a6f"]]),ve=r=>(K("data-v-e6571a88"),r=r(),W(),r),Vo={class:"recall-settings-box"},No={class:"form-box"},Bo={class:"form-item is-required"},Qo=ve(()=>e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),Do={class:"form-item-body"},Po={class:"retrieval-mode-items"},To=["onClick"],jo={class:"retrieval-mode-title"},Jo={class:"title-text"},Fo={class:"retrieval-mode-desc"},Ho={class:"form-item"},Ko={class:"form-item-label"},Wo=ve(()=>e("span",null,"Top K ",-1)),Zo={class:"form-item-body"},Go={class:"number-box"},Xo={class:"number-slider-box"},Yo={class:"number-input-box"},es={class:"form-item"},ts={class:"form-item-label"},os=ve(()=>e("span",null,"相似度阈值 ",-1)),ss={class:"form-item-body"},ns={class:"number-box"},as={class:"number-slider-box"},is={class:"number-input-box"},ls={class:"form-item"},cs={class:"form-item-label"},_s=ve(()=>e("span",null,"Rerank模型",-1)),rs={class:"form-item-body"},ds=["src"],us={__name:"recall-settings-alert",emits:["change"],setup(r,{expose:c,emit:u}){const d=u,o=w([{iconName:"search",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行全文检索和向量检索，使用RRF算法进行排序，从两中查询结果中选择更匹配用户问题的结果"},{iconName:"file-search",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果"},{iconName:"comment-search",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),l=A({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),s=w(!1),y=I=>{C(),l.rerank_status=I.rerank_status||0,l.rerank_use_model=I.rerank_use_model||void 0,l.rerank_model_config_id=I.rerank_model_config_id||"",l.top_k=I.top_k,l.similarity=I.similarity,l.search_type=I.search_type,s.value=!0},a=(I,v)=>{l.rerank_model_config_id=v.rerank_model_config_id},b=I=>{l.search_type=I},$=()=>l.rerank_status==1&&!l.rerank_model_config_id,g=()=>{if($())return ee.error("请选择Rerank模型");s.value=!1,_()},_=()=>{d("change",Q(l))},f=w([]),C=()=>{Ue({model_type:"RERANK"}).then(I=>{let v=I.data||[];f.value=v.map(m=>({id:m.model_config.id,name:m.model_info.model_name,icon:m.model_info.model_icon_url,children:m.model_info.rerank_model_list}))})};return c({open:y}),(I,v)=>{const m=oe,h=ne,S=Me,i=ke,O=ae,V=Oe,D=Le,X=Re,M=le;return p(),U(M,{width:"472px",open:s.value,"onUpdate:open":v[6]||(v[6]=E=>s.value=E),title:"召回设置",onOk:g},{default:n(()=>[e("div",Vo,[e("div",No,[e("div",Bo,[Qo,e("div",Do,[e("div",Po,[(p(!0),q(B,null,P(o.value,E=>(p(),q("div",{class:he(["retrieval-mode-item",{active:l.search_type==E.value}]),key:E.value,onClick:J=>b(E.value)},[l.search_type==E.value?(p(),U(m,{key:0,class:"check-arrow",name:"check-arrow-filled"})):T("",!0),e("div",jo,[t(m,{name:E.iconName,class:"title-icon"},null,8,["name"]),e("span",Jo,R(E.title),1),E.isRecommendation?(p(),U(m,{key:0,class:"recommendation-icon",name:"recommendation"})):T("",!0)]),e("div",Fo,R(E.desc),1)],10,To))),128))])])]),e("div",Ho,[e("div",Ko,[Wo,t(h,null,{title:n(()=>[L("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:n(()=>[t(x(G),{class:"question-icon"})]),_:1})]),e("div",Zo,[e("div",Go,[e("div",Xo,[t(S,{class:"custom-slider",value:l.top_k,"onUpdate:value":v[0]||(v[0]=E=>l.top_k=E),min:1,max:10},null,8,["value"])]),e("div",Yo,[t(i,{value:l.top_k,"onUpdate:value":v[1]||(v[1]=E=>l.top_k=E),min:1,max:10},null,8,["value"])])])])]),e("div",es,[e("div",ts,[os,t(h,null,{title:n(()=>[L("召回时，只会召回相似度大于阈值的文本分段。")]),default:n(()=>[t(x(G),{class:"question-icon"})]),_:1})]),e("div",ss,[e("div",ns,[e("div",as,[t(S,{class:"custom-slider",value:l.similarity,"onUpdate:value":v[2]||(v[2]=E=>l.similarity=E),min:0,max:1,step:.01},null,8,["value"])]),e("div",is,[t(i,{value:l.similarity,"onUpdate:value":v[3]||(v[3]=E=>l.similarity=E),min:0,max:1,step:.01},null,8,["value"])])])])]),e("div",ls,[e("div",cs,[_s,L("   "),t(O,{checkedValue:1,unCheckedValue:0,checked:l.rerank_status,"onUpdate:checked":v[4]||(v[4]=E=>l.rerank_status=E)},null,8,["checked"])]),e("div",rs,[t(X,{value:l.rerank_use_model,"onUpdate:value":v[5]||(v[5]=E=>l.rerank_use_model=E),placeholder:"请选择Rerank模型",onChange:a,style:{width:"320px"}},{default:n(()=>[(p(!0),q(B,null,P(f.value,E=>(p(),U(D,{key:E.id},{label:n(()=>[e("span",null,[e("img",{class:"model-icon",src:E.icon,alt:""},null,8,ds)])]),default:n(()=>[(p(!0),q(B,null,P(E.children,J=>(p(),U(V,{value:J,rerank_model_config_id:E.id,key:J},{default:n(()=>[e("span",null,R(J),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])])])]),_:1},8,["open"])}}},ps=z(us,[["__scopeId","data-v-e6571a88"]]),ms={class:"actions-box"},vs={key:0,class:"library-list"},fs=["onClick"],hs={class:"library-name"},bs={class:"library-intro"},ys={__name:"index",setup(r){const c=w(!1),{robotInfo:u,updateRobotInfo:d}=j("robotInfo"),o=A({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),l=w([]),s=w(null),y=Ie(()=>l.value.filter(v=>o.library_ids.includes(v.id))),a=v=>{let m=o.library_ids.indexOf(v.id);o.library_ids.splice(m,1),C()},b=v=>{o.library_ids=[...v],C()},$=()=>{s.value.open([...o.library_ids])},g=w(null),_=()=>{g.value.open(Q(o))},f=v=>{o.rerank_status=v.rerank_status,o.rerank_use_model=v.rerank_use_model,o.rerank_model_config_id=v.rerank_model_config_id,o.top_k=v.top_k,o.similarity=v.similarity,o.search_type=v.search_type,C()},C=()=>{let v={...Q(o)};v.library_ids=v.library_ids.join(","),d({...v})};return(async()=>{const v=await Ae();v&&(l.value=v.data||[])})(),Pe(()=>{o.library_ids=u.library_ids.split(","),o.rerank_status=u.rerank_status||0,o.rerank_use_model=u.rerank_use_model||void 0,o.rerank_model_config_id=u.rerank_model_config_id||"",o.top_k=u.top_k,o.similarity=u.similarity,o.search_type=u.search_type}),(v,m)=>{const h=se,S=ye;return p(),U(Z,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:c.value,"onUpdate:isEdit":m[0]||(m[0]=i=>c.value=i),bodyStyle:{padding:0}},{extra:n(()=>[e("div",ms,[t(S,{gap:8},{default:n(()=>[t(h,{size:"small",onClick:_},{default:n(()=>[L("召回设置")]),_:1}),t(h,{size:"small",onClick:$},{default:n(()=>[L("关联知识库")]),_:1})]),_:1})])]),default:n(()=>[y.value.length>0?(p(),q("div",vs,[(p(!0),q(B,null,P(y.value,i=>(p(),q("div",{class:"library-item",key:i.id},[e("span",{class:"close-btn",onClick:O=>a(i)},[t(x(ue))],8,fs),e("div",hs,R(i.library_name),1),e("div",bs,R(i.library_intro),1)]))),128))])):T("",!0),t(zo,{ref_key:"librarySelectAlertRef",ref:s,onChange:b},null,512),t(ps,{ref_key:"recallSettingsAlertRef",ref:g,onChange:f},null,512)]),_:1},8,["isEdit"])}}},gs=z(ys,[["__scopeId","data-v-96e96ac2"]]),ks={class:"form-box"},xs={class:"question-title"},$s={class:"question-options"},ws={class:"question-option"},qs={class:"drag-btn"},Ss={class:"action-box"},Cs={class:"robot-info-box"},Is={class:"robot-welcome-content"},Es={class:"robot-welcome-question"},Us={__name:"welcome-words",setup(r){const c=w(!1),u=w(!1),{robotInfo:d,updateRobotInfo:o,scrollBoxToBottom:l}=j("robotInfo"),s=A({welcomes:{content:"",question:[]}}),y=()=>{let _=!1;if(s.welcomes.question.length>0){for(let f=0;f<s.welcomes.question.length;f++)if(!s.welcomes.question[f].content){_=f+1;break}}return _},a=()=>{s.welcomes.question.push({content:"",id:de(8)})},b=_=>{s.welcomes.question.splice(_,1)},$=()=>{if(!s.welcomes.content)return ee.error("请输入欢迎语");if(y())return ee.error("引导问题内容不能为空");o({...Q(s)}),c.value=!1},g=()=>{let _={...d.welcomes},f=[];_.question.forEach(({content:C,id:I})=>{let v={id:I,content:C};v.id||(v.id=de(6)),f.push(v)}),s.welcomes.content=_.content,s.welcomes.question=f};return(_,f)=>{const C=pe,I=oe,v=ce;return p(),U(Z,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:c.value,"onUpdate:isEdit":f[4]||(f[4]=m=>c.value=m),onSave:$,onEdit:g},{default:n(()=>[F(e("div",ks,[e("div",xs,[t(C,{value:s.welcomes.content,"onUpdate:value":f[0]||(f[0]=m=>s.welcomes.content=m),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",$s,[t(x(ge),{modelValue:s.welcomes.question,"onUpdate:modelValue":f[1]||(f[1]=m=>s.welcomes.question=m),"item-key":"id",handle:".drag-btn",onStart:f[2]||(f[2]=m=>u.value=!0),onEnd:f[3]||(f[3]=m=>u.value=!1)},{item:n(({element:m,index:h})=>[e("div",ws,[e("span",qs,[t(I,{name:"drag"})]),t(v,{class:"question-option-content",value:m.content,"onUpdate:value":S=>m.content=S,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",Ss,[t(x(ue),{class:"del-btn",onClick:S=>b(h)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:a},[t(x(ze),{class:"add-btn-icon"}),L("添加引导问题 ")])])],512),[[H,c.value]]),F(e("div",Cs,[e("div",Is,R(x(d).welcomes.content),1),e("div",Es,[(p(!0),q(B,null,P(x(d).welcomes.question,(m,h)=>(p(),q("div",{class:"question-item",key:h},R(m.content),1))),128))])],512),[[H,!c.value]])]),_:1},8,["isEdit"])}}},Os=z(Us,[["__scopeId","data-v-ea227a87"]]),Ls=r=>(K("data-v-bc797bf6"),r=r(),W(),r),Rs=Ls(()=>e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)),Ms={class:"form-box"},As={class:"question-title"},zs={class:"question-options"},Vs={class:"question-option"},Ns={class:"drag-btn"},Bs={class:"action-box"},Qs={class:"robot-info-box"},Ds={class:"robot-unknown-content"},Ps={class:"robot-unknown-question"},Ts={__name:"unknown-problem-prompt",setup(r){const c=w(!1),u=w(!1),{robotInfo:d,updateRobotInfo:o,scrollBoxToBottom:l}=j("robotInfo"),s=A({unknown_question_prompt:{content:"",question:[]}}),y=()=>{s.unknown_question_prompt.question.push({content:"",id:de(8)}),Te(()=>{l()})},a=g=>{s.unknown_question_prompt.question.splice(g,1)},b=()=>{o({...Q(s)}),c.value=!1},$=()=>{let g={...d.unknown_question_prompt},_=[];g.question&&g.question.forEach(({content:f,id:C})=>{let I={id:C,content:f};I.id||(I.id=de(6)),_.push(I)}),g.content&&(s.unknown_question_prompt.content=g.content),_&&(s.unknown_question_prompt.question=_)};return Ee(()=>{}),(g,_)=>{const f=ne,C=pe,I=oe,v=ce;return p(),U(Z,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:c.value,"onUpdate:isEdit":_[4]||(_[4]=m=>c.value=m),onSave:b,onEdit:$},{tip:n(()=>[t(f,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:n(()=>[Rs]),default:n(()=>[t(x(G))]),_:1})]),default:n(()=>[F(e("div",Ms,[e("div",As,[t(C,{value:s.unknown_question_prompt.content,"onUpdate:value":_[0]||(_[0]=m=>s.unknown_question_prompt.content=m),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",zs,[t(x(ge),{modelValue:s.unknown_question_prompt.question,"onUpdate:modelValue":_[1]||(_[1]=m=>s.unknown_question_prompt.question=m),"item-key":"id",handle:".drag-btn",onStart:_[2]||(_[2]=m=>u.value=!0),onEnd:_[3]||(_[3]=m=>u.value=!1)},{item:n(({element:m,index:h})=>[e("div",Vs,[e("span",Ns,[t(I,{name:"drag"})]),t(v,{class:"question-option-content",value:m.content,"onUpdate:value":S=>m.content=S,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",Bs,[t(x(ue),{class:"del-btn",onClick:S=>a(h)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:y},[t(x(ze),{class:"add-btn-icon"}),L("添加引导问题 ")])])],512),[[H,c.value]]),F(e("div",Qs,[e("div",Ds,R(x(d).unknown_question_prompt.content),1),e("div",Ps,[(p(!0),q(B,null,P(x(d).unknown_question_prompt.question,(m,h)=>(p(),q("div",{class:"question-item",key:h},R(m.content),1))),128))])],512),[[H,!c.value]])]),_:1},8,["isEdit"])}}},js=z(Ts,[["__scopeId","data-v-bc797bf6"]]),Ne=r=>(K("data-v-c60b8d8e"),r=r(),W(),r),Js=Ne(()=>e("span",null,null,-1)),Fs=Ne(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ")],-1)),Hs={__name:"problem-optimization",setup(r){w(!1);const{robotInfo:c,updateRobotInfo:u}=j("robotInfo");A({prompt:""});const d=o=>{u({})};return(o,l)=>{const s=ae;return p(),U(Z,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:n(()=>[Js]),default:n(()=>[Fs,t(s,{onChange:d,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:x(c).enable_question_optimize,"onUpdate:checked":l[0]||(l[0]=y=>x(c).enable_question_optimize=y),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Ks=z(Hs,[["__scopeId","data-v-c60b8d8e"]]),Be=r=>(K("data-v-34918831"),r=r(),W(),r),Ws=Be(()=>e("span",null,null,-1)),Zs=Be(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，机器人回答问题后，自动根据对话内容提供3条用户提问建议 ")],-1)),Gs={__name:"suggested-issues",setup(r){w(!1);const{robotInfo:c,updateRobotInfo:u}=j("robotInfo"),d=o=>{u({})};return(o,l)=>{const s=ae;return p(),U(Z,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:n(()=>[Ws]),default:n(()=>[Zs,t(s,{onChange:d,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:x(c).enable_question_guide,"onUpdate:checked":l[0]||(l[0]=y=>x(c).enable_question_guide=y),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Xs=z(Gs,[["__scopeId","data-v-34918831"]]),we=r=>(K("data-v-a0ec9e93"),r=r(),W(),r),Ys={class:"direct-title"},en={class:"direct-desc"},tn={class:"qa"},on={class:"prompt-form-item-label"},sn=we(()=>e("span",{class:"qa-title"},"QA文档直接回复答案",-1)),nn={class:"direct-switch"},an={class:"similarity"},ln=we(()=>e("span",null,"相似度超过",-1)),cn={class:"number-input-box"},_n=we(()=>e("span",null,"时直接回复答案",-1)),rn={__name:"chat-edit-alert",emits:["save"],setup(r,{expose:c,emit:u}){const d=u,o=w(1),l=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],s=A(l()),y=w(!1),a=A({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),b=()=>{a.chat_type=o.value.toString(),s.forEach(_=>{_.chat_type==o.value&&(a.chat_type=="3"?(a.mixture_qa_direct_reply_switch=_.mixture_qa_direct_reply_switch==1?"true":"false",a.mixture_qa_direct_reply_score=_.mixture_qa_direct_reply_score.toString()):a.chat_type=="1"&&(a.library_qa_direct_reply_switch=_.library_qa_direct_reply_switch==1?"true":"false",a.library_qa_direct_reply_score=_.library_qa_direct_reply_score.toString()))}),$(),Object.assign(s,l()),y.value=!1},$=()=>{d("save",Q(a))};Ee(()=>{});const g=_=>{o.value=parseInt(_.chat_type),a.chat_type=_.chat_type,a.library_qa_direct_reply_score=_.library_qa_direct_reply_score,a.library_qa_direct_reply_switch=_.library_qa_direct_reply_switch,a.mixture_qa_direct_reply_score=_.mixture_qa_direct_reply_score,a.mixture_qa_direct_reply_switch=_.mixture_qa_direct_reply_switch,s.forEach(f=>{f.chat_type=="3"?(f.mixture_qa_direct_reply_score=_.mixture_qa_direct_reply_score,f.mixture_qa_direct_reply_switch=_.mixture_qa_direct_reply_switch=="true"?1:0):f.chat_type=="1"&&(f.library_qa_direct_reply_score=_.library_qa_direct_reply_score,f.library_qa_direct_reply_switch=_.library_qa_direct_reply_switch=="true"?1:0)}),y.value=!0};return be(()=>y.value,_=>{_===!1&&Object.assign(s,l())},{immediate:!0}),c({open:g}),(_,f)=>{const C=ne,I=ae,v=ke,m=_t,h=rt,S=le;return p(),U(S,{width:"746px",open:y.value,"onUpdate:open":f[1]||(f[1]=i=>y.value=i),title:"聊天模式设置",onOk:b},{default:n(()=>[t(h,{class:"direct-box",value:o.value,"onUpdate:value":f[0]||(f[0]=i=>o.value=i)},{default:n(()=>[(p(!0),q(B,null,P(s,i=>(p(),U(m,{class:he(["direct-item",{active:o.value==i.direct_id}]),value:i.direct_id,key:i.direct_id},{default:n(()=>[e("div",Ys,R(i.direct_title),1),e("div",en,R(i.direct_desc),1),F(e("div",tn,[e("div",on,[sn,t(C,null,je({default:n(()=>[t(x(G),{class:"question-icon"})]),_:2},[i.chat_type=="1"?{name:"title",fn:n(()=>[L("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"0"}:i.chat_type=="3"?{name:"title",fn:n(()=>[L("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"1"}:void 0]),1024),e("div",nn,[i.chat_type=="1"?(p(),U(I,{key:0,checkedValue:1,unCheckedValue:0,checked:i.library_qa_direct_reply_switch,"onUpdate:checked":O=>i.library_qa_direct_reply_switch=O},null,8,["checked","onUpdate:checked"])):i.chat_type=="3"?(p(),U(I,{key:1,checkedValue:1,unCheckedValue:0,checked:i.mixture_qa_direct_reply_switch,"onUpdate:checked":O=>i.mixture_qa_direct_reply_switch=O},null,8,["checked","onUpdate:checked"])):T("",!0)])])],512),[[H,i.isQaDirectReply&&o.value==i.direct_id]]),F(e("div",an,[ln,e("div",cn,[i.chat_type=="1"?(p(),U(v,{key:0,value:i.library_qa_direct_reply_score,"onUpdate:value":O=>i.library_qa_direct_reply_score=O,disabled:!i.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):i.chat_type=="3"?(p(),U(v,{key:1,value:i.mixture_qa_direct_reply_score,"onUpdate:value":O=>i.mixture_qa_direct_reply_score=O,disabled:!i.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):T("",!0)]),_n],512),[[H,i.isQaDirectReply&&o.value==i.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},dn=z(rn,[["__scopeId","data-v-a0ec9e93"]]),qe=r=>(K("data-v-2a920ba8"),r=r(),W(),r),un=qe(()=>e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1)),pn=qe(()=>e("br",null,null,-1)),mn=qe(()=>e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)),vn={class:"actions-box"},fn={class:"model-name"},hn={class:"form-box"},bn={__name:"index",setup(r){const c=w(!1),u=w(null),{robotInfo:d,updateRobotInfo:o}=j("robotInfo"),l=A({chat_type:d.chat_type,library_qa_direct_reply_score:d.library_qa_direct_reply_score,library_qa_direct_reply_switch:d.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:d.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:d.mixture_qa_direct_reply_switch}),s=b=>{l.chat_type=b.chat_type,l.library_qa_direct_reply_score=b.library_qa_direct_reply_score,l.library_qa_direct_reply_switch=b.library_qa_direct_reply_switch,l.mixture_qa_direct_reply_score=b.mixture_qa_direct_reply_score,l.mixture_qa_direct_reply_switch=b.mixture_qa_direct_reply_switch,y()},y=()=>{o({...Q(l)}),c.value=!1},a=()=>{u.value.open(Q(l)),c.value=!0};return(b,$)=>{const g=ne,_=xe,f=se;return p(),U(Z,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:c.value,"onUpdate:isEdit":$[1]||($[1]=C=>c.value=C),bodyStyle:{padding:0}},{tip:n(()=>[t(g,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:n(()=>[un,pn,mn]),default:n(()=>[t(x(G))]),_:1})]),extra:n(()=>[e("div",vn,[e("span",fn,R(x(d).chat_type=="1"?"仅知识库":x(d).chat_type=="2"?"直连模式":"混合模式"),1),t(_,{type:"vertical"}),t(f,{size:"small",onClick:$[0]||($[0]=C=>a(!0))},{default:n(()=>[L("修改")]),_:1})])]),default:n(()=>[e("div",hn,[t(dn,{ref_key:"ChatEditAlertRef",ref:u,onSave:s},null,512)])]),_:1},8,["isEdit"])}}},yn=z(bn,[["__scopeId","data-v-2a920ba8"]]),gn=r=>(K("data-v-8d185d5f"),r=r(),W(),r),kn={class:"switch-box"},xn={class:"switch-box-body"},$n={class:"switch-box-header"},wn={class:"left-box"},qn={class:"switch-box-title"},Sn={key:0,class:"title-tip"},Cn={class:"right-box"},In={class:"extra-box"},En=gn(()=>e("div",{class:"extra-box"},null,-1)),Un={class:"switch-desc"},On={class:"switch-box-right"},Ln={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(r,{emit:c}){const u=c,d=r,o=w(d.value),l=s=>{u("update:value",s),u("change",s)};return(s,y)=>{const a=oe,b=ae;return p(),q("div",kn,[e("div",xn,[e("div",$n,[e("div",wn,[t(a,{class:"switch-box-icon",name:d.iconName},null,8,["name"]),e("span",qn,R(d.title),1),s.$slots.tip?(p(),q("span",Sn,[Y(s.$slots,"tip",{},void 0,!0)])):T("",!0)]),e("div",Cn,[e("div",In,[Y(s.$slots,"extra",{},()=>[En],!0)])])]),e("div",Un,[Y(s.$slots,"default",{},void 0,!0)])]),e("div",On,[t(b,{checked:o.value,"onUpdate:checked":y[0]||(y[0]=$=>o.value=$),onChange:l,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},Rn=z(Ln,[["__scopeId","data-v-8d185d5f"]]),Mn=e("span",null,null,-1),An=e("div",null,"开启后，在使用H5链接、Web、PC客户端时,可以要求机器人以Markdown格式输出回答",-1),zn={__name:"markdown-setting",setup(r){const{robotInfo:c,updateRobotInfo:u}=j("robotInfo"),d=w(!1);be(()=>c.show_type,l=>{d.value=l==1},{immediate:!0});const o=()=>{u({show_type:d.value?1:0})};return(l,s)=>(p(),U(Rn,{class:"markdown-setting",title:"Markdown格式输出","icon-name":"jibenpeizhi",value:d.value,"onUpdate:value":s[0]||(s[0]=y=>d.value=y),onChange:o},{extra:n(()=>[Mn]),default:n(()=>[An]),_:1},8,["value"]))}},Vn="/assets/img/empty-Bx9z1cwf.png",Nn="/assets/img/phone-head-COM4IpX2.png",Bn="/assets/img/phone-body-D1T2Ayr2.png",Qn="/assets/img/phone-footer-ClQtNpln.png",te=r=>(K("data-v-5125783f"),r=r(),W(),r),Dn={class:"common-problem-box"},Pn={class:"left-content-box"},Tn={key:0,class:"empty-box"},jn=te(()=>e("img",{src:Vn,alt:""},null,-1)),Jn=te(()=>e("div",{class:"title"},"暂无数据",-1)),Fn=te(()=>e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),Hn={key:1,class:"lists-box"},Kn={class:"drag-btn"},Wn={class:"title"},Zn={class:"opration-box"},Gn={class:"preview-box"},Xn=te(()=>e("div",{class:"phone-head"},[e("img",{class:"head-img",src:Nn,alt:""})],-1)),Yn={class:"phone-body"},ea=te(()=>e("div",null,[e("img",{class:"body-img",src:Bn,alt:""})],-1)),ta={key:0,class:"question-box"},oa=te(()=>e("div",{class:"name"},"常见问题",-1)),sa=te(()=>e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:Qn,alt:""})],-1)),na={__name:"common-problem",setup(r){w(!1);const{robotInfo:c,updateRobotInfo:u}=j("robotInfo"),d=Ie(()=>c.common_question_list?JSON.parse(c.common_question_list):[]),o=w([]);o.value=d.value,be(d,()=>{o.value=d.value});const l=Se.useForm,s=w(!1),y=w("添加问题"),a=A({question:"",index:-1}),b=A({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:$,validate:g,validateInfos:_}=l(a,b),f=()=>{if(d.value.length>=10)return ee.error("最多设置10条常用问题");s.value=!0,$(),a.question="",a.index=-1},C=(S,i)=>{s.value=!0,$(),a.question=S,a.index=i},I=S=>{let i=[];i=d.value.filter((O,V)=>S!=V),le.confirm({title:"提醒",icon:t(Xe),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){u({common_question_list:JSON.stringify(i)})},onCancel(){}})},v=()=>{g().then(()=>{let S=[];a.index>=0?S=d.value.map((i,O)=>O===a.index?a.question:i):S=[a.question,...d.value],u({common_question_list:JSON.stringify(S)}),s.value=!1})},m=S=>{u({})},h=S=>{u({common_question_list:JSON.stringify(o.value)})};return(S,i)=>{const O=ne,V=ae,D=xe,X=se,M=oe,E=ce,J=tt,ie=Se,fe=le;return p(),q("div",Dn,[e("div",Pn,[t(Z,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:n(()=>[t(O,null,{title:n(()=>[L("最多10条。开启后，常见问题会显示在每条问答后面")]),default:n(()=>[t(x(G),{class:"quess-icon"})]),_:1})]),extra:n(()=>[t(V,{onChange:m,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:x(c).enable_common_question,"onUpdate:checked":i[0]||(i[0]=k=>x(c).enable_common_question=k),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t(D,{type:"vertical"}),t(X,{type:"primary",size:"small",onClick:f},{default:n(()=>[L("添加")]),_:1})]),default:n(()=>[d.value.length==0?(p(),q("div",Tn,[jn,Jn,Fn,t(X,{onClick:f,type:"primary"},{default:n(()=>[L("立即添加")]),_:1})])):(p(),q("div",Hn,[t(x(ge),{modelValue:o.value,"onUpdate:modelValue":i[1]||(i[1]=k=>o.value=k),handle:".drag-btn","item-key":"index",onEnd:h},{item:n(({element:k,index:N})=>[(p(),q("div",{class:"list-item",key:N},[e("span",Kn,[t(M,{name:"drag"})]),e("div",Wn,R(k),1),e("div",Zn,[t(x(et),{onClick:Qe=>C(k,N)},null,8,["onClick"]),t(x(ue),{onClick:Qe=>I(N)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",Gn,[Xn,e("div",Yn,[ea,d.value.length&&x(c).enable_common_question=="true"?(p(),q("div",ta,[oa,(p(!0),q(B,null,P(d.value,k=>(p(),q("div",{class:"list-item",key:k},R(k),1))),128))])):T("",!0)]),sa]),t(fe,{open:s.value,"onUpdate:open":i[3]||(i[3]=k=>s.value=k),title:y.value,onOk:v,width:"476px"},{default:n(()=>[t(ie,{class:"form-box",layout:"vertical"},{default:n(()=>[t(J,Je({label:"问题名称"},x(_).question),{default:n(()=>[t(E,{maxLength:100,value:a.question,"onUpdate:value":i[2]||(i[2]=k=>a.question=k),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},aa=z(na,[["__scopeId","data-v-5125783f"]]),ia={key:0,class:"robot-config-page"},la={class:"setting-box"},ca={class:"setting-box"},_a={class:"setting-box"},ra={class:"setting-box"},da={class:"setting-box"},ua={class:"setting-box"},pa={class:"setting-box"},ma={class:"setting-box"},va={class:"setting-box"},fa={class:"setting-box"},ha={key:1,class:"robot-config-page"},ba={__name:"index",setup(r){const c=ut(),u=w(null),{robotInfo:d}=Fe(c),{getRobot:o}=c,l=()=>{u.value.scrollTop=u.value.scrollHeight},s=w(1),y=w(!1),a=A(d.value);He("robotInfo",{robotInfo:a,updateRobotInfo:g=>{let _=JSON.parse(JSON.stringify(g));Object.assign(a,_),$()},scrollBoxToBottom:l});const $=()=>{let g=JSON.parse(JSON.stringify(Q(a))),_=g.welcomes;_.question=_.question.map(C=>C.content),g.welcomes=JSON.stringify(_);let f=g.unknown_question_prompt;f.question=f.question.map(C=>C.content),g.unknown_question_prompt=JSON.stringify(f),delete g.robot_avatar_url,y.value=!0,dt(g).then(C=>{if(C.res!=0)return ee.error(C.msg);y.value=!1,ee.success("保存成功"),o(a.id)}).catch(()=>{y.value=!1})};return(g,_)=>{const f=mt,C=pt;return p(),q(B,null,[t(C,{activeKey:s.value,"onUpdate:activeKey":_[0]||(_[0]=I=>s.value=I)},{default:n(()=>[(p(),U(f,{key:1,tab:"基础配置"})),(p(),U(f,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),s.value==1?(p(),q("div",ia,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:u},[e("div",la,[t(jt)]),e("div",ca,[t(Zt)]),e("div",_a,[t(Eo)]),e("div",ra,[t(gs)]),e("div",da,[t(Os)]),e("div",ua,[t(yn)]),e("div",pa,[t(js)]),e("div",ma,[t(zn)]),e("div",va,[t(Ks)]),e("div",fa,[t(Xs)])],512)])):(p(),q("div",ha,[t(aa)]))],64)}}},ai=z(ba,[["__scopeId","data-v-69ffa8f6"]]);export{ai as default};
