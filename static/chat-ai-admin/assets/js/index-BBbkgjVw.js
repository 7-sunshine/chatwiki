import{j as t,L as p,M as S,V as e,X as L,Y as R,S as Y,a8 as j,P as U,Q as n,W as De,a2 as be,r as w,d as Q,A,E as F,G as K,u as $,a9 as P,a3 as H,a4 as W,F as B,ac as _e,ae as re,a1 as T,b as Ie,h as Te,v as Ee,y as je,w as ue,ab as Je,U as Fe,a6 as Ke,p as He}from"./vue-chunks-XeeYQ2kA.js";import{A as We,_ as z,c as oe,B as se,J as Ge,K as Xe,N as Ze,d as ee,M as le,O as pe,P as de,E as Ye}from"../../index-pGVpQMA0.js";import{_ as ye}from"./index-D9Oeu4M4.js";import{C as et,d as ge,E as tt}from"./vuedraggable.umd-4o4SE2KC.js";import"./index-BPzZ8HYg.js";import{I as ce}from"./Input-BpoOlxnx.js";import{_ as me}from"./TextArea-DvqYUUpc.js";import{c as Ue}from"./index-BiBRpeT6.js";import{Q as X}from"./QuestionCircleOutlined-C6hYQFmR.js";import{S as Oe,a as Le,_ as Re}from"./index-CpXIlpHQ.js";import{_ as Me}from"./index-BtyeTI8D.js";import{_ as ke}from"./index-BZ6ztxPN.js";import{_ as xe}from"./index-DXUwg8Bt.js";import{_ as ot,a as st}from"./index-C8nzpyDB.js";import{_ as ne}from"./index-zLXV6DVR.js";import{g as Ae}from"./index-DRYFeHdL.js";import{S as nt}from"./SearchOutlined-C_Q6hh1x.js";import{C as at,_ as it}from"./index-43HoJZDy.js";import{S as lt}from"./index-DwwRbEJn.js";import{_ as ct}from"./index-DzAksAsu.js";import{_ as ae}from"./index-EEwqdrcw.js";import{P as ze}from"./PlusOutlined-BvMptCf7.js";import"./index-Dg5FoGFr.js";import{R as _t,_ as rt}from"./RadioButton-DhVApLrq.js";import{F as Se,_ as dt}from"./index-BlZhlPki.js";import{s as ut}from"./index-C8SRDQAi.js";import{u as pt}from"./robot-CdEsOL90.js";import{T as mt,_ as vt}from"./index-BBKzoe5I.js";import"./dayjs-oAino27R.js";import"./axios-Cm0UX6qg.js";import"./qs-DfimNey5.js";import"./crypto-js-CuiFEUvY.js";import"./FormItemContext-Da_jkx0v.js";import"./index-Z11VoXTE.js";import"./Search-CpOmfbSY.js";import"./inputProps-DZRcc7xF.js";import"./Password-BTEAOcTM.js";import"./index-Bruf23Oc.js";import"./colors-DCZEizLq.js";import"./slide-D6W0LxJh.js";import"./CheckOutlined-_VUPY4GZ.js";import"./DownOutlined-C8Q6Kr-5.js";import"./move-jqhYINnj.js";import"./responsiveObserve-Cdlm3rJ_.js";import"./collapseMotion-Bep1tU8X.js";import"./index-Cxpqycif.js";import"./shallowequal-Da0otATl.js";import"./Dropdown-CcwauEi-.js";import"./useRefs-DGVWkBGy.js";var ft={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};const ht=ft;function Ce(d){for(var c=1;c<arguments.length;c++){var u=arguments[c]!=null?Object(arguments[c]):{},_=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(u).filter(function(o){return Object.getOwnPropertyDescriptor(u,o).enumerable}))),_.forEach(function(o){bt(d,o,u[o])})}return d}function bt(d,c,u){return c in d?Object.defineProperty(d,c,{value:u,enumerable:!0,configurable:!0,writable:!0}):d[c]=u,d}var $e=function(c,u){var _=Ce({},c,u.attrs);return t(We,Ce({},_,{icon:ht}),null)};$e.displayName="SyncOutlined";$e.inheritAttrs=!1;const yt=$e,gt={class:"edit-box-header"},kt={class:"left-box"},xt={class:"edit-box-title"},$t={key:0},wt={key:0,class:"title-tip"},qt={class:"right-box"},St={class:"extra-box"},Ct={class:"actions-box"},It={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(d,{emit:c}){const u=c,_=d,o=s=>{u("edit"),u("update:isEdit",s)},i=()=>{u("save")};return(s,b)=>{const a=oe,y=se,q=ye;return p(),S("div",{class:be(["edit-box",{"is-edit":d.isEdit}])},[e("div",gt,[e("div",kt,[t(a,{class:"edit-box-icon",name:_.iconName},null,8,["name"]),e("span",xt,[L(R(_.title)+" ",1),s.$slots.icon?(p(),S("span",$t,[Y(s.$slots,"icon",{},void 0,!0)])):j("",!0)]),s.$slots.tip?(p(),S("span",wt,[Y(s.$slots,"tip",{},void 0,!0)])):j("",!0)]),e("div",qt,[e("div",St,[Y(s.$slots,"extra",{},()=>[e("div",Ct,[_.isEdit?(p(),U(q,{key:0,gap:8},{default:n(()=>[t(y,{onClick:i,size:"small",type:"primary"},{default:n(()=>[L("保存")]),_:1}),t(y,{onClick:b[0]||(b[0]=g=>o(!1)),size:"small"},{default:n(()=>[L("取消")]),_:1})]),_:1})):(p(),U(y,{key:1,onClick:b[1]||(b[1]=g=>o(!0)),size:"small"},{default:n(()=>[L("修改")]),_:1}))])],!0)])])]),e("div",{class:"edit-box-body",style:De({...d.bodyStyle})},[Y(s.$slots,"default",{},void 0,!0)],4)],2)}}},G=z(It,[["__scopeId","data-v-1b63f826"]]),Ve=d=>(H("data-v-c384f413"),d=d(),W(),d),Et={class:"robot-form-box"},Ut={class:"form-item"},Ot=Ve(()=>e("div",{class:"form-item-label"},"机器人名称/头像",-1)),Lt={class:"form-item-body robot-name-item"},Rt={class:"robot-avetar-upload"},Mt=["src"],At={class:"robot-name-box"},zt={class:"form-item"},Vt=Ve(()=>e("div",{class:"form-item-label"},"简介",-1)),Nt={class:"form-item-body"},Bt={class:"robot-info-box"},Pt={class:"robot-name-box"},Qt=["src"],Dt={class:"robot-name"},Tt={class:"robot-intro"},jt={__name:"basic-config",setup(d){const c=w(!1),{robotInfo:u,updateRobotInfo:_}=Q("robotInfo"),o=A({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),i=()=>{_({...P(o)}),c.value=!1},s=a=>{let y=a[0];return o.robot_avatar=y,Ge(y).then(q=>{o.robot_avatar_url=q}),!1},b=()=>{o.robot_name=u.robot_name,o.robot_intro=u.robot_intro,o.robot_avatar=u.robot_avatar,o.robot_avatar_url=u.robot_avatar_url};return(a,y)=>{const q=ce,g=me;return p(),U(G,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:c.value,"onUpdate:isEdit":y[2]||(y[2]=r=>c.value=r),onSave:i,onEdit:b},{default:n(()=>[F(e("div",Et,[e("div",Ut,[Ot,e("div",Lt,[t(et,{accept:"image/*",onChange:s},{default:n(()=>[e("div",Rt,[o.robot_avatar_url?(p(),S("img",{key:0,class:"robot-avetar",src:o.robot_avatar_url},null,8,Mt)):j("",!0)])]),_:1}),e("div",At,[t(q,{value:o.robot_name,"onUpdate:value":y[0]||(y[0]=r=>o.robot_name=r),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",zt,[Vt,e("div",Nt,[t(g,{rows:3,value:o.robot_intro,"onUpdate:value":y[1]||(y[1]=r=>o.robot_intro=r),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[K,c.value]]),F(e("div",Bt,[e("div",Pt,[e("img",{class:"robot-avatar",src:$(u).robot_avatar_url,alt:""},null,8,Qt),e("span",Dt,R($(u).robot_name),1)]),e("div",Tt,R($(u).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)],512),[[K,!c.value]])]),_:1},8,["isEdit"])}}},Jt=z(jt,[["__scopeId","data-v-c384f413"]]),Ft={class:"robot-form-box"},Kt={class:"form-item"},Ht={class:"robot-info-box"},Wt={class:"robot-prompt"},Gt={__name:"system-prompt-words",setup(d){const c=w(!1),{robotInfo:u,updateRobotInfo:_}=Q("robotInfo"),o=A({prompt:""}),i=()=>{_({...P(o)}),c.value=!1},s=()=>{o.prompt=u.prompt};return(b,a)=>{const y=me;return p(),U(G,{class:"setting-box",title:"系统提示词","icon-name":"xitongtishici",isEdit:c.value,"onUpdate:isEdit":a[1]||(a[1]=q=>c.value=q),onSave:i,onEdit:s},{default:n(()=>[F(e("div",Ft,[e("div",Kt,[t(y,{rows:4,value:o.prompt,"onUpdate:value":a[0]||(a[0]=q=>o.prompt=q),placeholder:"请输入提示词","allow-clear":""},null,8,["value"])])],512),[[K,c.value]]),F(e("div",Ht,[e("div",Wt,R($(u).prompt),1)],512),[[K,!c.value]])]),_:1},8,["isEdit"])}}},Xt=z(Gt,[["__scopeId","data-v-b893c2fb"]]),ve=d=>(H("data-v-ba5c9280"),d=d(),W(),d),Zt={class:"actions-box"},Yt={class:"model-name"},eo={key:0,class:"form-box"},to={class:"form-item"},oo=ve(()=>e("div",{class:"form-item-label"},[e("span",null,"LLM模型 ")],-1)),so={class:"form-item-body"},no=["src"],ao={key:0},io={key:1},lo={class:"form-item"},co={class:"form-item-label"},_o=ve(()=>e("span",null,"温度 ",-1)),ro={class:"form-item-body"},uo={class:"number-box"},po={class:"number-slider-box"},mo={class:"number-input-box"},vo={class:"form-item"},fo={class:"form-item-label"},ho=ve(()=>e("span",null,"最大token ",-1)),bo={class:"form-item-body"},yo={class:"number-box"},go={class:"number-slider-box"},ko={class:"number-input-box"},xo={class:"form-item"},$o={class:"form-item-label"},wo=ve(()=>e("span",null,"上下文数量 ",-1)),qo={class:"form-item-body"},So={class:"number-box"},Co={class:"number-slider-box"},Io={class:"number-input-box"},Eo={__name:"model-settings",setup(d){const c=["azure","ollama","xinference","openaiAgent"],u=["azure"],_=A({sm:24,md:24,lg:12,xl:8,xxl:8}),o=w([]),i=w(!1),{robotInfo:s,updateRobotInfo:b}=Q("robotInfo"),a=A({use_model:void 0,model_config_id:"",temperature:0,max_token:0,context_pair:0}),y=w(""),q=w(""),g=w(""),r=(m,h)=>{const k=h.current_obj;a.use_model=c.indexOf(k.model_define)>-1&&k.deployment_name?k.deployment_name:k.name,y.value=k.model_define,a.model_config_id=k.id||h.model_config_id},f=()=>{g.value=a.use_model,u.indexOf(y.value)>-1&&(a.use_model="默认"),b({...P(a)}),i.value=!1},C=m=>{m||(y.value=q.value),c.indexOf(y.value)>-1?a.use_model=g.value:a.use_model=s.use_model,a.model_config_id=s.model_config_id,a.temperature=s.temperature,a.max_token=s.max_token,a.context_pair=s.context_pair,i.value=m};function I(m,h,k){const l=new Set(m.map(O=>O.model_define));return h.filter(O=>{let V=O[k];l.has(V)&&m.filter(D=>{if(D.model_define==V)return D.children=Ze(D.children,O.children),!1})}),m}return(()=>{Ue({model_type:"LLM"}).then(m=>{g.value=s.use_model;let h=m.data||[],k=[];o.value=h.map(l=>{k=[];for(let O=0;O<l.model_info.llm_model_list.length;O++){const V=l.model_info.llm_model_list[O];c.indexOf(l.model_info.model_define)>-1&&s.model_config_id==l.model_config.id&&(g.value=l.model_config.deployment_name,y.value=l.model_info.model_define,q.value=l.model_info.model_define),k.push({name:V,deployment_name:l.model_config.deployment_name,id:l.model_config.id,model_define:l.model_info.model_define})}return{id:l.model_config.id,name:l.model_info.model_name,model_define:l.model_info.model_define,icon:l.model_info.model_icon_url,children:k,deployment_name:l.model_config.deployment_name}}),o.value=I(Xe(o.value,"model_define"),o.value,"model_define")})})(),(m,h)=>{const k=se,l=ye,O=xe,V=Oe,D=Le,Z=Re,M=ot,E=ne,J=Me,ie=ke,he=st;return p(),U(G,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:i.value,"onUpdate:isEdit":h[9]||(h[9]=x=>i.value=x)},{extra:n(()=>[e("div",Zt,[i.value?(p(),U(l,{key:0,gap:8},{default:n(()=>[t(k,{onClick:f,size:"small",type:"primary"},{default:n(()=>[L("保存")]),_:1}),t(k,{onClick:h[0]||(h[0]=x=>C(!1)),size:"small"},{default:n(()=>[L("取消")]),_:1})]),_:1})):(p(),S(B,{key:1},[e("span",Yt,R(g.value),1),t(O,{type:"vertical"}),t(k,{onClick:h[1]||(h[1]=x=>C(!0)),size:"small"},{default:n(()=>[L("修改")]),_:1})],64))])]),default:n(()=>[i.value?(p(),S("div",eo,[t(he,{gutter:[32,16]},{default:n(()=>[t(M,_e(re(_)),{default:n(()=>[e("div",to,[oo,e("div",so,[t(Z,{value:a.use_model,"onUpdate:value":h[2]||(h[2]=x=>a.use_model=x),placeholder:"请选择LLM模型",onChange:r,style:{width:"100%"}},{default:n(()=>[(p(!0),S(B,null,T(o.value,x=>(p(),U(D,{key:x.id},{label:n(()=>[t(l,{align:"center",gap:6},{default:n(()=>[e("img",{class:"model-icon",src:x.icon,alt:""},null,8,no),L(R(x.name),1)]),_:2},1024)]),default:n(()=>[(p(!0),S(B,null,T(x.children,N=>(p(),U(V,{value:c.indexOf(x.model_define)>-1&&N.deployment_name?N.deployment_name:N.name+N.id,model_config_id:x.id,current_obj:N,key:N.name+N.id},{default:n(()=>[c.indexOf(x.model_define)>-1&&N.deployment_name?(p(),S("span",ao,R(N.deployment_name),1)):(p(),S("span",io,R(N.name),1))]),_:2},1032,["value","model_config_id","current_obj"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])]),_:1},16),t(M,_e(re(_)),{default:n(()=>[e("div",lo,[e("div",co,[_o,t(E,null,{title:n(()=>[L("温度越低，回答越严谨。温度越高，回答越发散。")]),default:n(()=>[t($(X),{class:"question-icon"})]),_:1})]),e("div",ro,[e("div",uo,[e("div",po,[t(J,{class:"custom-slider",value:a.temperature,"onUpdate:value":h[3]||(h[3]=x=>a.temperature=x),min:0,max:2,step:.1},null,8,["value"])]),e("div",mo,[t(ie,{value:a.temperature,"onUpdate:value":h[4]||(h[4]=x=>a.temperature=x),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),t(M,_e(re(_)),{default:n(()=>[e("div",vo,[e("div",fo,[ho,t(E,null,{title:n(()=>[L("问题+答案的最大token数，如果出现回答被截断，可调高此值")]),default:n(()=>[t($(X),{class:"question-icon"})]),_:1})]),e("div",bo,[e("div",yo,[e("div",go,[t(J,{class:"custom-slider",value:a.max_token,"onUpdate:value":h[5]||(h[5]=x=>a.max_token=x),min:0,max:100*1024},null,8,["value"])]),e("div",ko,[t(ie,{value:a.max_token,"onUpdate:value":h[6]||(h[6]=x=>a.max_token=x),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),t(M,_e(re(_)),{default:n(()=>[e("div",xo,[e("div",$o,[wo,t(E,null,{title:n(()=>[L("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置10轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")]),default:n(()=>[t($(X),{class:"question-icon"})]),_:1})]),e("div",qo,[e("div",So,[e("div",Co,[t(J,{class:"custom-slider",value:a.context_pair,"onUpdate:value":h[7]||(h[7]=x=>a.context_pair=x),min:0,max:10},null,8,["value"])]),e("div",Io,[t(ie,{value:a.context_pair,"onUpdate:value":h[8]||(h[8]=x=>a.context_pair=x),min:0,max:10},null,8,["value"])])])])])]),_:1},16)]),_:1})])):j("",!0)]),_:1},8,["isEdit"])}}},Uo=z(Eo,[["__scopeId","data-v-ba5c9280"]]),Oo={class:"library-checkbox-box"},Lo={class:"list-tools"},Ro={class:"list-box",ref:"scrollContainer"},Mo={class:"library-name"},Ao={class:"library-desc"},zo={__name:"library-select-alert",emits:["change"],setup(d,{expose:c,emit:u}){const _=u,o=A({indeterminate:!1,checkAll:!1,checkedList:[]}),i=w(!1),s=v=>{r(),o.checkedList=v,i.value=!0},b=()=>{i.value=!1,g()},a=w(""),y=()=>{r()},q=w([]),g=()=>{_("change",[...o.checkedList])},r=async()=>{const v=await Ae({library_name:a.value});if(v){let m=v.data||[];q.value=m}},f=w(!1),C=async()=>{f.value=!0,await r(),f.value=!1,ee.success("刷新完成")},I=()=>{window.open("/#/library/add")};return c({open:s}),(v,m)=>{const h=ct,k=ce,l=se,O=at,V=it,D=lt,Z=le;return p(),U(Z,{width:"746px",open:i.value,"onUpdate:open":m[2]||(m[2]=M=>i.value=M),title:"关联知识库",onOk:b},{default:n(()=>[e("div",Oo,[t(h,{message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"}),e("div",Lo,[e("div",null,[t(k,{style:{width:"282px"},value:a.value,"onUpdate:value":m[0]||(m[0]=M=>a.value=M),placeholder:"请输入知识库名称搜索",onChange:y},{suffix:n(()=>[t($(nt),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),e("div",null,[t(l,{style:{"margin-right":"8px"},onClick:C},{default:n(()=>[t($(yt)),L(" 刷新 ")]),_:1}),t(l,{type:"primary",ghost:"",onClick:I},{default:n(()=>[L("新建知识库")]),_:1})])]),t(D,{spinning:f.value,delay:100},{default:n(()=>[t(V,{value:o.checkedList,"onUpdate:value":m[1]||(m[1]=M=>o.checkedList=M),style:{width:"100%"}},{default:n(()=>[e("div",Ro,[(p(!0),S(B,null,T(q.value,M=>(p(),S("div",{class:"list-item-wraapper",key:M.id},[t(O,{class:"list-item",value:M.id},{default:n(()=>[e("div",Mo,R(M.library_name),1),e("div",Ao,R(M.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},Vo=z(zo,[["__scopeId","data-v-1c861116"]]),fe=d=>(H("data-v-68b1655f"),d=d(),W(),d),No={class:"recall-settings-box"},Bo={class:"form-box"},Po={class:"form-item is-required"},Qo=fe(()=>e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),Do={class:"form-item-body"},To={class:"retrieval-mode-items"},jo=["onClick"],Jo={class:"retrieval-mode-title"},Fo={class:"title-text"},Ko={class:"retrieval-mode-desc"},Ho={class:"form-item"},Wo={class:"form-item-label"},Go=fe(()=>e("span",null,"Top K ",-1)),Xo={class:"form-item-body"},Zo={class:"number-box"},Yo={class:"number-slider-box"},es={class:"number-input-box"},ts={class:"form-item"},os={class:"form-item-label"},ss=fe(()=>e("span",null,"相似度阈值 ",-1)),ns={class:"form-item-body"},as={class:"number-box"},is={class:"number-slider-box"},ls={class:"number-input-box"},cs={class:"form-item"},_s={class:"form-item-label"},rs=fe(()=>e("span",null,"Rerank模型",-1)),ds={class:"form-item-body"},us=["src"],ps={__name:"recall-settings-alert",emits:["change"],setup(d,{expose:c,emit:u}){const _=u,o=w([{iconName:"search",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行全文检索和向量检索，使用RRF算法进行排序，从两中查询结果中选择更匹配用户问题的结果"},{iconName:"file-search",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果"},{iconName:"comment-search",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),i=A({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),s=w(!1),b=I=>{C(),i.rerank_status=I.rerank_status||0,i.rerank_use_model=I.rerank_use_model||void 0,i.rerank_model_config_id=I.rerank_model_config_id||"",i.top_k=I.top_k,i.similarity=I.similarity,i.search_type=I.search_type,s.value=!0},a=(I,v)=>{i.rerank_model_config_id=v.rerank_model_config_id},y=I=>{i.search_type=I},q=()=>i.rerank_status==1&&!i.rerank_model_config_id,g=()=>{if(q())return ee.error("请选择Rerank模型");s.value=!1,r()},r=()=>{_("change",P(i))},f=w([]),C=()=>{Ue({model_type:"RERANK"}).then(I=>{let v=I.data||[];f.value=v.map(m=>({id:m.model_config.id,name:m.model_info.model_name,icon:m.model_info.model_icon_url,children:m.model_info.rerank_model_list}))})};return c({open:b}),(I,v)=>{const m=oe,h=ne,k=Me,l=ke,O=ae,V=Oe,D=Le,Z=Re,M=le;return p(),U(M,{width:"472px",open:s.value,"onUpdate:open":v[6]||(v[6]=E=>s.value=E),title:"召回设置",onOk:g},{default:n(()=>[e("div",No,[e("div",Bo,[e("div",Po,[Qo,e("div",Do,[e("div",To,[(p(!0),S(B,null,T(o.value,E=>(p(),S("div",{class:be(["retrieval-mode-item",{active:i.search_type==E.value}]),key:E.value,onClick:J=>y(E.value)},[i.search_type==E.value?(p(),U(m,{key:0,class:"check-arrow",name:"check-arrow-filled"})):j("",!0),e("div",Jo,[t(m,{name:E.iconName,class:"title-icon"},null,8,["name"]),e("span",Fo,R(E.title),1),E.isRecommendation?(p(),U(m,{key:0,class:"recommendation-icon",name:"recommendation"})):j("",!0)]),e("div",Ko,R(E.desc),1)],10,jo))),128))])])]),e("div",Ho,[e("div",Wo,[Go,t(h,null,{title:n(()=>[L("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:n(()=>[t($(X),{class:"question-icon"})]),_:1})]),e("div",Xo,[e("div",Zo,[e("div",Yo,[t(k,{class:"custom-slider",value:i.top_k,"onUpdate:value":v[0]||(v[0]=E=>i.top_k=E),min:1,max:10},null,8,["value"])]),e("div",es,[t(l,{value:i.top_k,"onUpdate:value":v[1]||(v[1]=E=>i.top_k=E),min:1,max:10},null,8,["value"])])])])]),e("div",ts,[e("div",os,[ss,t(h,null,{title:n(()=>[L("召回时，只会召回相似度大于阈值的文本分段。")]),default:n(()=>[t($(X),{class:"question-icon"})]),_:1})]),e("div",ns,[e("div",as,[e("div",is,[t(k,{class:"custom-slider",value:i.similarity,"onUpdate:value":v[2]||(v[2]=E=>i.similarity=E),min:0,max:1,step:.01},null,8,["value"])]),e("div",ls,[t(l,{value:i.similarity,"onUpdate:value":v[3]||(v[3]=E=>i.similarity=E),min:0,max:1,step:.01},null,8,["value"])])])])]),e("div",cs,[e("div",_s,[rs,L("   "),t(O,{checkedValue:1,unCheckedValue:0,checked:i.rerank_status,"onUpdate:checked":v[4]||(v[4]=E=>i.rerank_status=E)},null,8,["checked"])]),e("div",ds,[t(Z,{value:i.rerank_use_model,"onUpdate:value":v[5]||(v[5]=E=>i.rerank_use_model=E),placeholder:"请选择Rerank模型",onChange:a,style:{width:"320px"}},{default:n(()=>[(p(!0),S(B,null,T(f.value,E=>(p(),U(D,{key:E.id},{label:n(()=>[e("span",null,[e("img",{class:"model-icon",src:E.icon,alt:""},null,8,us)])]),default:n(()=>[(p(!0),S(B,null,T(E.children,J=>(p(),U(V,{value:J,rerank_model_config_id:E.id,key:J},{default:n(()=>[e("span",null,R(J),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])])])]),_:1},8,["open"])}}},ms=z(ps,[["__scopeId","data-v-68b1655f"]]),vs={class:"actions-box"},fs={key:0,class:"library-list"},hs=["onClick"],bs={class:"library-name"},ys={class:"library-intro"},gs={__name:"index",setup(d){const c=w(!1),{robotInfo:u,updateRobotInfo:_}=Q("robotInfo"),o=A({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),i=w([]),s=w(null),b=Ie(()=>i.value.filter(v=>o.library_ids.includes(v.id))),a=v=>{let m=o.library_ids.indexOf(v.id);o.library_ids.splice(m,1),C()},y=v=>{o.library_ids=[...v],C()},q=()=>{s.value.open([...o.library_ids])},g=w(null),r=()=>{g.value.open(P(o))},f=v=>{o.rerank_status=v.rerank_status,o.rerank_use_model=v.rerank_use_model,o.rerank_model_config_id=v.rerank_model_config_id,o.top_k=v.top_k,o.similarity=v.similarity,o.search_type=v.search_type,C()},C=()=>{let v={...P(o)};v.library_ids=v.library_ids.join(","),_({...v})};return(async()=>{const v=await Ae();v&&(i.value=v.data||[])})(),Te(()=>{o.library_ids=u.library_ids.split(","),o.rerank_status=u.rerank_status||0,o.rerank_use_model=u.rerank_use_model||void 0,o.rerank_model_config_id=u.rerank_model_config_id||"",o.top_k=u.top_k,o.similarity=u.similarity,o.search_type=u.search_type}),(v,m)=>{const h=se,k=ye;return p(),U(G,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:c.value,"onUpdate:isEdit":m[0]||(m[0]=l=>c.value=l),bodyStyle:{padding:0}},{extra:n(()=>[e("div",vs,[t(k,{gap:8},{default:n(()=>[t(h,{size:"small",onClick:r},{default:n(()=>[L("召回设置")]),_:1}),t(h,{size:"small",onClick:q},{default:n(()=>[L("关联知识库")]),_:1})]),_:1})])]),default:n(()=>[b.value.length>0?(p(),S("div",fs,[(p(!0),S(B,null,T(b.value,l=>(p(),S("div",{class:"library-item",key:l.id},[e("span",{class:"close-btn",onClick:O=>a(l)},[t($(pe))],8,hs),e("div",bs,R(l.library_name),1),e("div",ys,R(l.library_intro),1)]))),128))])):j("",!0),t(Vo,{ref_key:"librarySelectAlertRef",ref:s,onChange:y},null,512),t(ms,{ref_key:"recallSettingsAlertRef",ref:g,onChange:f},null,512)]),_:1},8,["isEdit"])}}},ks=z(gs,[["__scopeId","data-v-75c29a43"]]),xs={class:"form-box"},$s={class:"question-title"},ws={class:"question-options"},qs={class:"question-option"},Ss={class:"drag-btn"},Cs={class:"action-box"},Is={class:"robot-info-box"},Es={class:"robot-welcome-content"},Us={class:"robot-welcome-question"},Os={__name:"welcome-words",setup(d){const c=w(!1),u=w(!1),{robotInfo:_,updateRobotInfo:o,scrollBoxToBottom:i}=Q("robotInfo"),s=A({welcomes:{content:"",question:[]}}),b=()=>{let r=!1;if(s.welcomes.question.length>0){for(let f=0;f<s.welcomes.question.length;f++)if(!s.welcomes.question[f].content){r=f+1;break}}return r},a=()=>{s.welcomes.question.push({content:"",id:de(8)})},y=r=>{s.welcomes.question.splice(r,1)},q=()=>{if(!s.welcomes.content)return ee.error("请输入欢迎语");if(b())return ee.error("引导问题内容不能为空");o({...P(s)}),c.value=!1},g=()=>{let r={..._.welcomes},f=[];r.question.forEach(({content:C,id:I})=>{let v={id:I,content:C};v.id||(v.id=de(6)),f.push(v)}),s.welcomes.content=r.content,s.welcomes.question=f};return(r,f)=>{const C=me,I=oe,v=ce;return p(),U(G,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:c.value,"onUpdate:isEdit":f[4]||(f[4]=m=>c.value=m),onSave:q,onEdit:g},{default:n(()=>[F(e("div",xs,[e("div",$s,[t(C,{value:s.welcomes.content,"onUpdate:value":f[0]||(f[0]=m=>s.welcomes.content=m),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",ws,[t($(ge),{modelValue:s.welcomes.question,"onUpdate:modelValue":f[1]||(f[1]=m=>s.welcomes.question=m),"item-key":"id",handle:".drag-btn",onStart:f[2]||(f[2]=m=>u.value=!0),onEnd:f[3]||(f[3]=m=>u.value=!1)},{item:n(({element:m,index:h})=>[e("div",qs,[e("span",Ss,[t(I,{name:"drag"})]),t(v,{class:"question-option-content",value:m.content,"onUpdate:value":k=>m.content=k,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",Cs,[t($(pe),{class:"del-btn",onClick:k=>y(h)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:a},[t($(ze),{class:"add-btn-icon"}),L("添加引导问题 ")])])],512),[[K,c.value]]),F(e("div",Is,[e("div",Es,R($(_).welcomes.content),1),e("div",Us,[(p(!0),S(B,null,T($(_).welcomes.question,(m,h)=>(p(),S("div",{class:"question-item",key:h},R(m.content),1))),128))])],512),[[K,!c.value]])]),_:1},8,["isEdit"])}}},Ls=z(Os,[["__scopeId","data-v-9b840ded"]]),Rs=d=>(H("data-v-aca01d0e"),d=d(),W(),d),Ms=Rs(()=>e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)),As={class:"form-box"},zs={class:"question-title"},Vs={class:"question-options"},Ns={class:"question-option"},Bs={class:"drag-btn"},Ps={class:"action-box"},Qs={class:"robot-info-box"},Ds={class:"robot-unknown-content"},Ts={class:"robot-unknown-question"},js={__name:"unknown-problem-prompt",setup(d){const c=w(!1),u=w(!1),{robotInfo:_,updateRobotInfo:o,scrollBoxToBottom:i}=Q("robotInfo"),s=A({unknown_question_prompt:{content:"",question:[]}}),b=()=>{s.unknown_question_prompt.question.push({content:"",id:de(8)}),je(()=>{i()})},a=g=>{s.unknown_question_prompt.question.splice(g,1)},y=()=>{o({...P(s)}),c.value=!1},q=()=>{let g={..._.unknown_question_prompt},r=[];g.question&&g.question.forEach(({content:f,id:C})=>{let I={id:C,content:f};I.id||(I.id=de(6)),r.push(I)}),g.content&&(s.unknown_question_prompt.content=g.content),r&&(s.unknown_question_prompt.question=r)};return Ee(()=>{}),(g,r)=>{const f=ne,C=me,I=oe,v=ce;return p(),U(G,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:c.value,"onUpdate:isEdit":r[4]||(r[4]=m=>c.value=m),onSave:y,onEdit:q},{tip:n(()=>[t(f,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:n(()=>[Ms]),default:n(()=>[t($(X))]),_:1})]),default:n(()=>[F(e("div",As,[e("div",zs,[t(C,{value:s.unknown_question_prompt.content,"onUpdate:value":r[0]||(r[0]=m=>s.unknown_question_prompt.content=m),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",Vs,[t($(ge),{modelValue:s.unknown_question_prompt.question,"onUpdate:modelValue":r[1]||(r[1]=m=>s.unknown_question_prompt.question=m),"item-key":"id",handle:".drag-btn",onStart:r[2]||(r[2]=m=>u.value=!0),onEnd:r[3]||(r[3]=m=>u.value=!1)},{item:n(({element:m,index:h})=>[e("div",Ns,[e("span",Bs,[t(I,{name:"drag"})]),t(v,{class:"question-option-content",value:m.content,"onUpdate:value":k=>m.content=k,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",Ps,[t($(pe),{class:"del-btn",onClick:k=>a(h)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:b},[t($(ze),{class:"add-btn-icon"}),L("添加引导问题 ")])])],512),[[K,c.value]]),F(e("div",Qs,[e("div",Ds,R($(_).unknown_question_prompt.content),1),e("div",Ts,[(p(!0),S(B,null,T($(_).unknown_question_prompt.question,(m,h)=>(p(),S("div",{class:"question-item",key:h},R(m.content),1))),128))])],512),[[K,!c.value]])]),_:1},8,["isEdit"])}}},Js=z(js,[["__scopeId","data-v-aca01d0e"]]),Ne=d=>(H("data-v-8d50dfeb"),d=d(),W(),d),Fs=Ne(()=>e("span",null,null,-1)),Ks=Ne(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ")],-1)),Hs={__name:"problem-optimization",setup(d){w(!1);const{robotInfo:c,updateRobotInfo:u}=Q("robotInfo");A({prompt:""});const _=o=>{u({})};return(o,i)=>{const s=ae;return p(),U(G,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:n(()=>[Fs]),default:n(()=>[Ks,t(s,{onChange:_,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:$(c).enable_question_optimize,"onUpdate:checked":i[0]||(i[0]=b=>$(c).enable_question_optimize=b),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Ws=z(Hs,[["__scopeId","data-v-8d50dfeb"]]),Be=d=>(H("data-v-e2bb2e45"),d=d(),W(),d),Gs=Be(()=>e("span",null,null,-1)),Xs=Be(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"}," 开启后，机器人回答问题后，自动根据对话内容提供3条用户提问建议 ")],-1)),Zs={__name:"suggested-issues",setup(d){w(!1);const{robotInfo:c,updateRobotInfo:u}=Q("robotInfo"),_=o=>{u({})};return(o,i)=>{const s=ae;return p(),U(G,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:n(()=>[Gs]),default:n(()=>[Xs,t(s,{onChange:_,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:$(c).enable_question_guide,"onUpdate:checked":i[0]||(i[0]=b=>$(c).enable_question_guide=b),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Ys=z(Zs,[["__scopeId","data-v-e2bb2e45"]]),we=d=>(H("data-v-fc008010"),d=d(),W(),d),en={class:"direct-title"},tn={class:"direct-desc"},on={class:"qa"},sn={class:"prompt-form-item-label"},nn=we(()=>e("span",{class:"qa-title"},"QA文档直接回复答案",-1)),an={class:"direct-switch"},ln={class:"similarity"},cn=we(()=>e("span",null,"相似度超过",-1)),_n={class:"number-input-box"},rn=we(()=>e("span",null,"时直接回复答案",-1)),dn={__name:"chat-edit-alert",emits:["save"],setup(d,{expose:c,emit:u}){const _=u,o=w(1),i=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],s=A(i()),b=w(!1),a=A({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),y=()=>{a.chat_type=o.value.toString(),s.forEach(r=>{r.chat_type==o.value&&(a.chat_type=="3"?(a.mixture_qa_direct_reply_switch=r.mixture_qa_direct_reply_switch==1?"true":"false",a.mixture_qa_direct_reply_score=r.mixture_qa_direct_reply_score.toString()):a.chat_type=="1"&&(a.library_qa_direct_reply_switch=r.library_qa_direct_reply_switch==1?"true":"false",a.library_qa_direct_reply_score=r.library_qa_direct_reply_score.toString()))}),q(),Object.assign(s,i()),b.value=!1},q=()=>{_("save",P(a))};Ee(()=>{});const g=r=>{o.value=parseInt(r.chat_type),a.chat_type=r.chat_type,a.library_qa_direct_reply_score=r.library_qa_direct_reply_score,a.library_qa_direct_reply_switch=r.library_qa_direct_reply_switch,a.mixture_qa_direct_reply_score=r.mixture_qa_direct_reply_score,a.mixture_qa_direct_reply_switch=r.mixture_qa_direct_reply_switch,s.forEach(f=>{f.chat_type=="3"?(f.mixture_qa_direct_reply_score=r.mixture_qa_direct_reply_score,f.mixture_qa_direct_reply_switch=r.mixture_qa_direct_reply_switch=="true"?1:0):f.chat_type=="1"&&(f.library_qa_direct_reply_score=r.library_qa_direct_reply_score,f.library_qa_direct_reply_switch=r.library_qa_direct_reply_switch=="true"?1:0)}),b.value=!0};return ue(()=>b.value,r=>{r===!1&&Object.assign(s,i())},{immediate:!0}),c({open:g}),(r,f)=>{const C=ne,I=ae,v=ke,m=_t,h=rt,k=le;return p(),U(k,{width:"746px",open:b.value,"onUpdate:open":f[1]||(f[1]=l=>b.value=l),title:"聊天模式设置",onOk:y},{default:n(()=>[t(h,{class:"direct-box",value:o.value,"onUpdate:value":f[0]||(f[0]=l=>o.value=l)},{default:n(()=>[(p(!0),S(B,null,T(s,l=>(p(),U(m,{class:be(["direct-item",{active:o.value==l.direct_id}]),value:l.direct_id,key:l.direct_id},{default:n(()=>[e("div",en,R(l.direct_title),1),e("div",tn,R(l.direct_desc),1),F(e("div",on,[e("div",sn,[nn,t(C,null,Je({default:n(()=>[t($(X),{class:"question-icon"})]),_:2},[l.chat_type=="1"?{name:"title",fn:n(()=>[L("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"0"}:l.chat_type=="3"?{name:"title",fn:n(()=>[L("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"1"}:void 0]),1024),e("div",an,[l.chat_type=="1"?(p(),U(I,{key:0,checkedValue:1,unCheckedValue:0,checked:l.library_qa_direct_reply_switch,"onUpdate:checked":O=>l.library_qa_direct_reply_switch=O},null,8,["checked","onUpdate:checked"])):l.chat_type=="3"?(p(),U(I,{key:1,checkedValue:1,unCheckedValue:0,checked:l.mixture_qa_direct_reply_switch,"onUpdate:checked":O=>l.mixture_qa_direct_reply_switch=O},null,8,["checked","onUpdate:checked"])):j("",!0)])])],512),[[K,l.isQaDirectReply&&o.value==l.direct_id]]),F(e("div",ln,[cn,e("div",_n,[l.chat_type=="1"?(p(),U(v,{key:0,value:l.library_qa_direct_reply_score,"onUpdate:value":O=>l.library_qa_direct_reply_score=O,disabled:!l.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):l.chat_type=="3"?(p(),U(v,{key:1,value:l.mixture_qa_direct_reply_score,"onUpdate:value":O=>l.mixture_qa_direct_reply_score=O,disabled:!l.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):j("",!0)]),rn],512),[[K,l.isQaDirectReply&&o.value==l.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},un=z(dn,[["__scopeId","data-v-fc008010"]]),qe=d=>(H("data-v-2120501a"),d=d(),W(),d),pn=qe(()=>e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1)),mn=qe(()=>e("br",null,null,-1)),vn=qe(()=>e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)),fn={class:"actions-box"},hn={class:"model-name"},bn={class:"form-box"},yn={__name:"index",setup(d){const c=w(!1),u=w(null),{robotInfo:_,updateRobotInfo:o}=Q("robotInfo"),i=A({chat_type:_.chat_type,library_qa_direct_reply_score:_.library_qa_direct_reply_score,library_qa_direct_reply_switch:_.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:_.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:_.mixture_qa_direct_reply_switch}),s=y=>{i.chat_type=y.chat_type,i.library_qa_direct_reply_score=y.library_qa_direct_reply_score,i.library_qa_direct_reply_switch=y.library_qa_direct_reply_switch,i.mixture_qa_direct_reply_score=y.mixture_qa_direct_reply_score,i.mixture_qa_direct_reply_switch=y.mixture_qa_direct_reply_switch,b()},b=()=>{o({...P(i)}),c.value=!1},a=()=>{u.value.open(P(i)),c.value=!0};return(y,q)=>{const g=ne,r=xe,f=se;return p(),U(G,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:c.value,"onUpdate:isEdit":q[1]||(q[1]=C=>c.value=C),bodyStyle:{padding:0}},{tip:n(()=>[t(g,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:n(()=>[pn,mn,vn]),default:n(()=>[t($(X))]),_:1})]),extra:n(()=>[e("div",fn,[e("span",hn,R($(_).chat_type=="1"?"仅知识库":$(_).chat_type=="2"?"直连模式":"混合模式"),1),t(r,{type:"vertical"}),t(f,{size:"small",onClick:q[0]||(q[0]=C=>a(!0))},{default:n(()=>[L("修改")]),_:1})])]),default:n(()=>[e("div",bn,[t(un,{ref_key:"ChatEditAlertRef",ref:u,onSave:s},null,512)])]),_:1},8,["isEdit"])}}},gn=z(yn,[["__scopeId","data-v-2120501a"]]),kn=d=>(H("data-v-0548f52d"),d=d(),W(),d),xn={class:"switch-box"},$n={class:"switch-box-body"},wn={class:"switch-box-header"},qn={class:"left-box"},Sn={class:"switch-box-title"},Cn={key:0,class:"title-tip"},In={class:"right-box"},En={class:"extra-box"},Un=kn(()=>e("div",{class:"extra-box"},null,-1)),On={class:"switch-desc"},Ln={class:"switch-box-right"},Rn={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(d,{emit:c}){const u=c,_=d,o=w(_.value),i=s=>{u("update:value",s),u("change",s)};return(s,b)=>{const a=oe,y=ae;return p(),S("div",xn,[e("div",$n,[e("div",wn,[e("div",qn,[t(a,{class:"switch-box-icon",name:_.iconName},null,8,["name"]),e("span",Sn,R(_.title),1),s.$slots.tip?(p(),S("span",Cn,[Y(s.$slots,"tip",{},void 0,!0)])):j("",!0)]),e("div",In,[e("div",En,[Y(s.$slots,"extra",{},()=>[Un],!0)])])]),e("div",On,[Y(s.$slots,"default",{},void 0,!0)])]),e("div",Ln,[t(y,{checked:o.value,"onUpdate:checked":b[0]||(b[0]=q=>o.value=q),onChange:i,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},Pe=z(Rn,[["__scopeId","data-v-0548f52d"]]),Mn=e("span",null,null,-1),An=e("div",null,"开启后，在使用H5链接、Web、PC客户端时,可以要求机器人以Markdown格式输出回答",-1),zn={__name:"markdown-setting",setup(d){const{robotInfo:c,updateRobotInfo:u}=Q("robotInfo"),_=w(!1);ue(()=>c.show_type,i=>{_.value=i==1},{immediate:!0});const o=()=>{u({show_type:_.value?1:0})};return(i,s)=>(p(),U(Pe,{class:"markdown-setting",title:"Markdown格式输出","icon-name":"jibenpeizhi",value:_.value,"onUpdate:value":s[0]||(s[0]=b=>_.value=b),onChange:o},{extra:n(()=>[Mn]),default:n(()=>[An]),_:1},8,["value"]))}},Vn="/assets/img/empty-Bx9z1cwf.png",Nn="/assets/img/phone-head-COM4IpX2.png",Bn="/assets/img/phone-body-D1T2Ayr2.png",Pn="/assets/img/phone-footer-ClQtNpln.png",te=d=>(H("data-v-dce83f0d"),d=d(),W(),d),Qn={class:"common-problem-box"},Dn={class:"left-content-box"},Tn={key:0,class:"empty-box"},jn=te(()=>e("img",{src:Vn,alt:""},null,-1)),Jn=te(()=>e("div",{class:"title"},"暂无数据",-1)),Fn=te(()=>e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),Kn={key:1,class:"lists-box"},Hn={class:"drag-btn"},Wn={class:"title"},Gn={class:"opration-box"},Xn={class:"preview-box"},Zn=te(()=>e("div",{class:"phone-head"},[e("img",{class:"head-img",src:Nn,alt:""})],-1)),Yn={class:"phone-body"},ea=te(()=>e("div",null,[e("img",{class:"body-img",src:Bn,alt:""})],-1)),ta={key:0,class:"question-box"},oa=te(()=>e("div",{class:"name"},"常见问题",-1)),sa=te(()=>e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:Pn,alt:""})],-1)),na={__name:"common-problem",setup(d){w(!1);const{robotInfo:c,updateRobotInfo:u}=Q("robotInfo"),_=Ie(()=>c.common_question_list?JSON.parse(c.common_question_list):[]),o=w([]);o.value=_.value,ue(_,()=>{o.value=_.value});const i=Se.useForm,s=w(!1),b=w("添加问题"),a=A({question:"",index:-1}),y=A({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:q,validate:g,validateInfos:r}=i(a,y),f=()=>{if(_.value.length>=10)return ee.error("最多设置10条常用问题");s.value=!0,q(),a.question="",a.index=-1},C=(k,l)=>{s.value=!0,q(),a.question=k,a.index=l},I=k=>{let l=[];l=_.value.filter((O,V)=>k!=V),le.confirm({title:"提醒",icon:t(Ye),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){u({common_question_list:JSON.stringify(l)})},onCancel(){}})},v=()=>{g().then(()=>{let k=[];a.index>=0?k=_.value.map((l,O)=>O===a.index?a.question:l):k=[a.question,..._.value],u({common_question_list:JSON.stringify(k)}),s.value=!1})},m=k=>{u({})},h=k=>{u({common_question_list:JSON.stringify(o.value)})};return(k,l)=>{const O=ne,V=ae,D=xe,Z=se,M=oe,E=ce,J=dt,ie=Se,he=le;return p(),S("div",Qn,[e("div",Dn,[t(G,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:n(()=>[t(O,null,{title:n(()=>[L("最多10条。开启后，常见问题会显示在每条问答后面")]),default:n(()=>[t($(X),{class:"quess-icon"})]),_:1})]),extra:n(()=>[t(V,{onChange:m,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:$(c).enable_common_question,"onUpdate:checked":l[0]||(l[0]=x=>$(c).enable_common_question=x),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t(D,{type:"vertical"}),t(Z,{type:"primary",size:"small",onClick:f},{default:n(()=>[L("添加")]),_:1})]),default:n(()=>[_.value.length==0?(p(),S("div",Tn,[jn,Jn,Fn,t(Z,{onClick:f,type:"primary"},{default:n(()=>[L("立即添加")]),_:1})])):(p(),S("div",Kn,[t($(ge),{modelValue:o.value,"onUpdate:modelValue":l[1]||(l[1]=x=>o.value=x),handle:".drag-btn","item-key":"index",onEnd:h},{item:n(({element:x,index:N})=>[(p(),S("div",{class:"list-item",key:N},[e("span",Hn,[t(M,{name:"drag"})]),e("div",Wn,R(x),1),e("div",Gn,[t($(tt),{onClick:Qe=>C(x,N)},null,8,["onClick"]),t($(pe),{onClick:Qe=>I(N)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",Xn,[Zn,e("div",Yn,[ea,_.value.length&&$(c).enable_common_question=="true"?(p(),S("div",ta,[oa,(p(!0),S(B,null,T(_.value,x=>(p(),S("div",{class:"list-item",key:x},R(x),1))),128))])):j("",!0)]),sa]),t(he,{open:s.value,"onUpdate:open":l[3]||(l[3]=x=>s.value=x),title:b.value,onOk:v,width:"476px"},{default:n(()=>[t(ie,{class:"form-box",layout:"vertical"},{default:n(()=>[t(J,Fe({label:"问题名称"},$(r).question),{default:n(()=>[t(E,{maxLength:100,value:a.question,"onUpdate:value":l[2]||(l[2]=x=>a.question=x),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},aa=z(na,[["__scopeId","data-v-dce83f0d"]]),ia=e("span",null,null,-1),la=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1),ca={__name:"display-aitations",setup(d){const{robotInfo:c,updateRobotInfo:u}=Q("robotInfo"),_=w(!1);ue(()=>c.answer_source_switch,i=>{_.value=i=="true"},{immediate:!0});const o=()=>{u({answer_source_switch:_.value?"true":"false"})};return(i,s)=>(p(),U(Pe,{title:"显示引文","icon-name":"jibenpeizhi",value:_.value,"onUpdate:value":s[0]||(s[0]=b=>_.value=b),onChange:o},{extra:n(()=>[ia]),default:n(()=>[la]),_:1},8,["value"]))}},_a={key:0,class:"robot-config-page"},ra={class:"setting-box"},da={class:"setting-box"},ua={class:"setting-box"},pa={class:"setting-box"},ma={class:"setting-box"},va={class:"setting-box"},fa={class:"setting-box"},ha={class:"setting-box"},ba={class:"setting-box"},ya={class:"setting-box"},ga={class:"setting-box"},ka={key:1,class:"robot-config-page"},xa={__name:"index",setup(d){const c=pt(),u=w(null),{robotInfo:_}=Ke(c),{getRobot:o}=c,i=()=>{u.value.scrollTop=u.value.scrollHeight},s=w(1),b=w(!1),a=A(_.value);He("robotInfo",{robotInfo:a,updateRobotInfo:g=>{let r=JSON.parse(JSON.stringify(g));Object.assign(a,r),q()},scrollBoxToBottom:i});const q=()=>{let g=JSON.parse(JSON.stringify(P(a))),r=g.welcomes;r.question=r.question.map(C=>C.content),g.welcomes=JSON.stringify(r);let f=g.unknown_question_prompt;f.question=f.question.map(C=>C.content),g.unknown_question_prompt=JSON.stringify(f),delete g.robot_avatar_url,b.value=!0,ut(g).then(C=>{if(C.res!=0)return ee.error(C.msg);b.value=!1,ee.success("保存成功"),o(a.id)}).catch(()=>{b.value=!1})};return(g,r)=>{const f=vt,C=mt;return p(),S(B,null,[t(C,{activeKey:s.value,"onUpdate:activeKey":r[0]||(r[0]=I=>s.value=I)},{default:n(()=>[(p(),U(f,{key:1,tab:"基础配置"})),(p(),U(f,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),s.value==1?(p(),S("div",_a,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:u},[e("div",ra,[t(Jt)]),e("div",da,[t(Xt)]),e("div",ua,[t(Uo)]),e("div",pa,[t(ks)]),e("div",ma,[t(Ls)]),e("div",va,[t(gn)]),e("div",fa,[t(Js)]),e("div",ha,[t(zn)]),e("div",ba,[t(Ws)]),e("div",ya,[t(Ys)]),e("div",ga,[t(ca)])],512)])):(p(),S("div",ka,[t(aa)]))],64)}}},bi=z(xa,[["__scopeId","data-v-7d834ebc"]]);export{bi as default};
