function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/js/vue-pdf-embed-MPPbz7s1.js","assets/js/vue-chunks-C4JOcZXM.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{_ as H,B as ce,M as ue,E as ve,d as M,c as fe,f as me}from"../../index-CkphMBlH.js";import{M as r,N as f,W as t,k as u,S as E,u as Q,a4 as K,a5 as W,ag as he,Y,Z as D,F as R,a2 as ne,a8 as se,a9 as N,G as ge,a1 as de,e as v,b as U,a0 as ye,Q as z,ak as be,z as $e}from"./vue-chunks-C4JOcZXM.js";import{P as pe}from"./PlusOutlined-y-V1v04t.js";import{o as xe,p as Se,b as we,q as ke}from"./index-jRuNAItw.js";import{C as ae}from"./cu-scroll-Dq4iXk9e.js";import{U as Pe}from"./index-CxivVioH.js";import"./index-DV57irlB.js";import{I as Ie}from"./Password-C4pJDvMr.js";import{_ as Ee,T as Oe}from"./index-C99gGpRP.js";import{_ as De}from"./TextArea-dHwX4eR4.js";import{_ as Le}from"./index-CsVB5NkB.js";import{L as qe}from"./LeftOutlined-CIYqGUDc.js";import{S as Ae}from"./index-1ezya3aN.js";import"./dayjs-CNAygh1a.js";import"./axios-Cm0UX6qg.js";import"./qs-DjRPs0Fx.js";import"./crypto-js-WfkAukZn.js";import"./index-Cw5btzCW.js";import"./index-DjPSPmWl.js";import"./CheckOutlined-CxB3LAny.js";import"./useRefs-q3q6mNJg.js";import"./collapseMotion-B9mQKKQo.js";import"./FormItemContext-XVXjhsgH.js";import"./inputProps-Be_GFm9h.js";import"./index-D647WIsX.js";import"./slide-CwAboZ-L.js";import"./index-CJpLNZG1.js";import"./Dropdown-1l4fbfYC.js";import"./isMobile-D_4OiXLP.js";const Ce="/assets/img/empty-oK82-lgD.png",X=e=>(K("data-v-16e77398"),e=e(),W(),e),Te={class:"empty-box"},Fe=X(()=>t("img",{src:Ce,alt:""},null,-1)),Me=X(()=>t("div",{class:"title"},"知识库文档为空，请添加分段",-1)),Re=X(()=>t("span",null,"添加分段",-1)),He={__name:"empty",props:{detailsInfo:{type:Object}},emits:["openEditSubscription"],setup(e,{emit:l}){const o=l,c=()=>{o("openEditSubscription",{})};return(i,m)=>{const b=ce;return r(),f("div",Te,[Fe,Me,t("div",null,[u(b,{type:"primary",onClick:c},{icon:E(()=>[u(Q(pe))]),default:E(()=>[Re]),_:1})])])}}},le=H(He,[["__scopeId","data-v-16e77398"]]),Ve=e=>(K("data-v-7a8cc9af"),e=e(),W(),e),je={class:"subsection-box"},Be={class:"subsection-box-title"},ze=["onClick"],Qe={class:"top-block"},Ue={class:"title"},Ne={class:"right-opration"},Ke=["onClick"],We=Ve(()=>t("span",{class:"v-line"},null,-1)),Je=["onClick"],Ze={key:0,class:"content-box"},Ge={key:1,class:"content-box"},Ye=["innerHTML"],Xe={class:"fragment-img"},et=["src"],tt={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription"],setup(e,{expose:l,emit:o}){const c=o,i=e,m=$=>{c("openEditSubscription",$)},b=$=>{ue.confirm({title:"提示",icon:u(ve),content:"确认是否删除该分段?",onOk(){return new Promise((x,I)=>{xe({id:$}).then(s=>{M.success("删除成功"),c("handleDelParagraph",$),x()}).catch(()=>{x()})})},onCancel(){}})},h=$=>{c("handleScrollTargetPage",$)};return l({handleOpenEditModal:m}),($,x)=>{const I=he("viewer");return r(),f("div",je,[t("div",Be,[Y(" 分段预览 "),t("span",null,"共"+D(i.total)+"个分段",1)]),(r(!0),f(R,null,ne(i.paragraphLists,s=>(r(),f("div",{onClick:S=>h(s.page_num),class:"list-item",key:s.id},[t("div",Qe,[t("div",Ue,[Y(" id："+D(s.id)+" "+D(s.title)+" ",1),t("span",null,"共"+D(s.word_total)+"个字符",1),t("span",null,"状态："+D(s.status_text),1)]),t("div",Ne,[t("a",{onClick:se(S=>m(s),["stop"])},"编辑",8,Ke),We,t("a",{onClick:se(S=>b(s.id),["stop"])},"删除",8,Je)])]),s.question?(r(),f("div",Ze,"Q："+D(s.question),1)):N("",!0),s.answer?(r(),f("div",Ge,"A："+D(s.answer),1)):N("",!0),t("div",{class:"content-box",innerHTML:s.content},null,8,Ye),ge((r(),f("div",Xe,[(r(!0),f(R,null,ne(s.images,(S,g)=>(r(),f("img",{key:g,src:S,alt:""},null,8,et))),128))])),[[I]])],8,ze))),128))])}}},ie=H(tt,[["__scopeId","data-v-7a8cc9af"]]);var a={},ee;Object.defineProperty(a,"__esModule",{value:!0});a.controlDefaultValue=a.capitalize=a.camelize=a.cacheStringFunction=void 0;a.getDataAndAriaProps=dt;a.isSymbol=a.isString=a.isOn=a.isObject=a.isFunction=ee=a.isArray=a.hyphenate=void 0;a.renderHelper=_t;a.resolvePropValue=ut;a.toPx=pt;a.wrapPromiseFn=vt;const _e=e=>typeof e=="function";a.isFunction=_e;a.controlDefaultValue=Symbol("controlDefaultValue");ee=a.isArray=Array.isArray;const ot=e=>typeof e=="string";a.isString=ot;const nt=e=>typeof e=="symbol";a.isSymbol=nt;const st=e=>e!==null&&typeof e=="object";a.isObject=st;const at=/^on[^a-z]/,lt=e=>at.test(e);a.isOn=lt;const J=e=>{const l=Object.create(null);return o=>l[o]||(l[o]=e(o))};a.cacheStringFunction=J;const it=/-(\w)/g;a.camelize=J(e=>e.replace(it,(l,o)=>o?o.toUpperCase():""));const rt=/\B([A-Z])/g;a.hyphenate=J(e=>e.replace(rt,"-$1").toLowerCase());a.capitalize=J(e=>e.charAt(0).toUpperCase()+e.slice(1));const ct=Object.prototype.hasOwnProperty,re=(e,l)=>ct.call(e,l);function ut(e,l,o,c){const i=e[o];if(i!=null){const m=re(i,"default");if(m&&c===void 0){const b=i.default;c=i.type!==Function&&_e(b)?b():b}i.type===Boolean&&(!re(l,o)&&!m?c=!1:c===""&&(c=!0))}return c}function dt(e){return Object.keys(e).reduce((l,o)=>((o.startsWith("data-")||o.startsWith("aria-"))&&(l[o]=e[o]),l),{})}function pt(e){return typeof e=="number"?`${e}px`:e}function _t(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return typeof e=="function"?e(l):e??o}function vt(e){let l;const o=new Promise(i=>{l=e(()=>{i(!0)})}),c=()=>{l==null||l()};return c.then=(i,m)=>o.then(i,m),c.promise=o,c}const V=e=>(K("data-v-a8652d86"),e=e(),W(),e),ft={class:"form-box-wrapper"},mt={class:"form-item"},ht=V(()=>t("div",{class:"form-label"},"分段标题：",-1)),gt={class:"form-content"},yt={class:"form-item"},bt=V(()=>t("div",{class:"form-label required"},"分段问题：",-1)),$t={class:"form-content"},xt={class:"form-item"},St=V(()=>t("div",{class:"form-label required"},"分段答案：",-1)),wt={class:"form-content"},kt={key:1,class:"form-item"},Pt=V(()=>t("div",{class:"form-label required"},"分段内容：",-1)),It={class:"form-content"},Et={class:"form-item"},Ot=V(()=>t("div",{class:"form-label"},"附件",-1)),Dt={class:"form-content"},Lt={class:"upload-box-wrapper"},qt={key:0},At={__name:"edit-subsection",props:{detailsInfo:{type:Object}},emits:["handleEdit"],setup(e,{expose:l,emit:o}){const c=de(),i=e,m=o,b=v("1"),h=v(!1),$=v(""),x=v(""),I=v(""),s=v(""),S=v([]),g=v(""),k=v(!1),A=p=>{$.value=p.title||"",x.value=p.content||"",g.value=p.id||"",I.value=p.answer||"",S.value=p.images||[],s.value=p.question||"",k.value=i.detailsInfo.is_qa_doc=="1",h.value=!0},q=()=>{if(!x.value&&!k.value)return M.error("请输入分段内容");if(!s.value&&k.value)return M.error("请输入分段问题");if(!I.value&&k.value)return M.error("请输入分段答案");let p={title:$.value,content:x.value,question:s.value,answer:I.value,images:S.value};g.value?p.id=g.value:p.file_id=c.query.id;let _=new FormData;for(let O in p)ee(p[O])?p[O].forEach(L=>{_.append(O,L)}):_.append(O,p[O]);Se(_).then(O=>{M.success(p.id?"修改成功":"添加成功"),h.value=!1,m("handleEdit",{...p})})};return l({showModal:A}),(p,_)=>{const O=Ie,L=De,j=fe,Z=Ee,C=Oe,B=ue;return r(),f("div",null,[u(B,{open:h.value,"onUpdate:open":_[6]||(_[6]=w=>h.value=w),title:"编辑分段",onOk:q,width:"746px"},{default:E(()=>[t("div",ft,[t("div",mt,[ht,t("div",gt,[u(O,{value:$.value,"onUpdate:value":_[0]||(_[0]=w=>$.value=w),placeholder:"请输入分段标题"},null,8,["value"])])]),k.value?(r(),f(R,{key:0},[t("div",yt,[bt,t("div",$t,[u(L,{placeholder:"请输入分段问题",value:s.value,"onUpdate:value":_[1]||(_[1]=w=>s.value=w),style:{height:"100px"}},null,8,["value"])])]),t("div",xt,[St,t("div",wt,[u(L,{placeholder:"请输入分段答案",value:I.value,"onUpdate:value":_[2]||(_[2]=w=>I.value=w),style:{height:"150px"}},null,8,["value"])])])],64)):(r(),f("div",kt,[Pt,t("div",It,[u(L,{style:{height:"150px"},value:x.value,"onUpdate:value":_[3]||(_[3]=w=>x.value=w),placeholder:"请输入分段内容"},null,8,["value"])])])),t("div",Et,[Ot,t("div",Dt,[t("div",Lt,[u(C,{activeKey:b.value,"onUpdate:activeKey":_[4]||(_[4]=w=>b.value=w),size:"small"},{default:E(()=>[u(Z,{key:"1"},{tab:E(()=>[t("span",null,[u(j,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),Y(" 图片 "),S.value.length?(r(),f("span",qt,"("+D(S.value.length)+")",1)):N("",!0)])]),_:1})]),_:1},8,["activeKey"]),u(Pe,{value:S.value,"onUpdate:value":_[5]||(_[5]=w=>S.value=w)},null,8,["value"])])])])])]),_:1},8,["open"])])}}},Ct=H(At,[["__scopeId","data-v-a8652d86"]]),Tt={class:"mode-box"},Ft=["innerHTML"],Mt={class:"tag-item"},Rt={__name:"segmentation-mode",props:{detailsInfo:{type:Object}},setup(e){const l=e,o=v(""),c=U(()=>{const{is_table_file:i,is_qa_doc:m,is_diy_split:b,question_lable:h,answer_lable:$,separators:x,chunk_size:I,chunk_overlap:s,question_column:S,answer_column:g,qa_index_type:k,doc_type:A}=l.detailsInfo;if(i!=1&&m!=1&&b!=1)return A==3?(o.value=`分段模式：手动分段
文档类型：普通文档`,"自定义：普通文档"):(o.value=`分段模式：智能分段
文档类型：普通文档`,"智能分段：普通文档");if(i!=1&&m==1)return A==3?(o.value=`分段模式：手动分段
文档类型：QA文档`,"自定义：QA文档"):(o.value=`分段模式：智能分段
文档类型：QA文档
问题开始标识符："${h}"
答案开始标识符："${$}"`,"智能分段：QA文档");if(i!=1&&m!=1&&b==1)return o.value=`分段模式：自定义分段
文档标识符：${x}
分段最大长度：${I}字符
文段重叠长度：${s}字符`,"自定义分段";if(i==1&&m!=1)return o.value=`分段模式：智能分段
文档类型：普通表格`,"智能分段：普通表格";if(i==1&&m==1){let q=k==1?"问题与答案一起生成索引":"仅对问题生成索引";return o.value=`分段模式：智能分段
文档类型：QA文档
问题所在列："${S}"
答案所在列："${g}"
索引方式：${q}`,"智能分段：QA文档"}});return(i,m)=>{const b=Le;return r(),f("div",Tt,[u(b,null,{title:E(()=>[t("div",{class:"tooltip-text-box",innerHTML:o.value},null,8,Ft)]),default:E(()=>[t("div",Mt,D(c.value),1)]),_:1})])}}},Ht=H(Rt,[["__scopeId","data-v-6ee0b31f"]]),Vt=e=>(K("data-v-89521947"),e=e(),W(),e),jt={class:"library-preview-page"},Bt={class:"document-title-block"},zt={class:"title"},Qt=Vt(()=>t("span",null,"添加分段",-1)),Ut={key:0,class:"page-loading-box"},Nt={class:"content-block"},Kt={key:1,class:"pdf-view-box"},Wt={class:"view-content-wrap"},Jt={key:0,class:"loading-box"},Zt={class:"view-content"},Gt={class:"right-contnt-box"},Yt={class:"content-block"},Xt={__name:"library-preview",setup(e){const l=be(()=>me(()=>import("./vue-pdf-embed-MPPbz7s1.js").then(n=>n.v),__vite__mapDeps([0,1]))),o=de(),c=ye(),i=U(()=>h.value.is_qa_doc=="1"),m=U(()=>h.value.doc_type),b=U(()=>{let n=h.value.status;return!(n=="1"||n=="2")||g.value.length==0}),h=v({pdf_url:""}),$=()=>{c.back()},x=v(!0);(async()=>{we({id:o.query.id}).then(n=>{h.value=n.data;let d=n.data.status;d==1||d==2?p():x.value=!1})})();const s=v({page:1,size:10}),S=v({}),g=v([]),k=v(0),A={0:"未转换",1:"已转换",2:"转换异常"};let q=!0;const p=()=>{q=!0,ke({file_id:o.query.id,...s.value}).then(n=>{var F,oe;x.value=!1,q=!1;let d=n.data,P=d.list||[],y=((F=d.info)==null?void 0:F.is_qa_doc)=="1"&&((oe=d.info)==null?void 0:oe.is_table_file)=="1";P.forEach(G=>{G.status_text=A[G.status],G.isExcelQa=y}),S.value=d.info,s.value.page==1&&(g.value=[]),g.value=[...g.value,...P],k.value=d.total})},_=()=>{q||g.value.length>=k.value||(s.value.page++,p())},O=n=>{if(!n.id){s.value.page=1,p();return}let d=g.value,P=d.findIndex(y=>y.id==n.id);if(P>-1){let y=d[P];y.title=n.title,y.content=n.content,y.question=n.question,y.answer=n.answer,y.answer=n.answer,y.images=n.images,y.word_total=n.question.length+n.answer.length+n.content.length,d.splice(P,1,y),g.value=d}},L=n=>{let d=g.value,P=d.findIndex(y=>y.id==n);P>-1&&(d.splice(P,1),g.value=d,k.value=k.value--)},j=v(!0),Z=n=>{j.value=!1},C=v(null),B=v(null),w=async n=>{await $e();let d=C.value.pageCount,y=C.value.$el.offsetHeight/d,F=(n-1)*y;B.value.scrollTop=F},te=v(null),T=n=>{te.value.showModal(JSON.parse(JSON.stringify(n)))};return(n,d)=>{const P=ce,y=Ae;return r(),f("div",jt,[t("div",Bt,[u(Q(qe),{onClick:$}),t("span",zt,D(h.value.file_name),1),u(Ht,{detailsInfo:h.value},null,8,["detailsInfo"]),u(P,{onClick:d[0]||(d[0]=F=>T({})),style:{"margin-left":"auto"},type:"primary"},{icon:E(()=>[u(Q(pe))]),default:E(()=>[Qt]),_:1})]),x.value?(r(),f("div",Ut,[u(y)])):(r(),f(R,{key:1},[i.value||m.value==3?(r(),f(R,{key:0},[b.value?(r(),z(le,{key:0,onOpenEditSubscription:T})):(r(),z(ae,{key:1,onOnScrollEnd:_},{default:E(()=>[t("div",Nt,[u(ie,{ref:"subsectionBoxRef",total:k.value,paragraphLists:g.value,detailsInfo:h.value,onOpenEditSubscription:T,onHandleDelParagraph:L},null,8,["total","paragraphLists","detailsInfo"])])]),_:1}))],64)):(r(),f("div",Kt,[t("div",Wt,[t("div",{class:"view-gray-bg",ref_key:"scollDivRef",ref:B},[j.value?(r(),f("div",Jt,[u(y)])):N("",!0),t("div",Zt,[u(Q(l),{ref_key:"vuePdfRef",ref:C,onLoaded:Z,source:h.value.pdf_url},null,8,["source"])])],512)]),t("div",Gt,[b.value?(r(),z(le,{key:0,onOpenEditSubscription:T})):(r(),z(ae,{key:1,onOnScrollEnd:_},{default:E(()=>[t("div",Yt,[u(ie,{ref:"subsectionBoxRef",total:k.value,detailsInfo:h.value,paragraphLists:g.value,onOpenEditSubscription:T,onHandleDelParagraph:L,onHandleScrollTargetPage:w},null,8,["total","detailsInfo","paragraphLists"])])]),_:1}))])]))],64)),u(Ct,{detailsInfo:h.value,onHandleEdit:O,ref_key:"editSubscriptionRef",ref:te},null,8,["detailsInfo"])])}}},Do=H(Xt,[["__scopeId","data-v-89521947"]]);export{Do as default};
